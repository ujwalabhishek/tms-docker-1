<?phpif (!defined('BASEPATH'))    exit('No direct script access allowed');function generate_feedback_pdf($tenant_details) {        if($tenant_details->tenant_id == 'T20' || $tenant_details->tenant_id == 'T17'){         $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->model('Meta_Values', 'meta');    $meta_map = $ci->meta->get_param_map();    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetCreator(PDF_CREATOR);    $pdf->SetPrintHeader(false);    $pdf->SetPrintFooter(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 10);    $pdf->Image(FCPATH . 'logos/' . $tenant_details->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $pdf->writeHTML('<br>', true, false, false, false, '');    $tbl = '<table style="font-size:8px;">        <tr><td>' . $tenant_details->tenant_address . '</td></tr>        <tr><td>' . $tenant_details->tenant_city . '</td></tr>        <tr><td>Tel: ' . $tenant_details->tenant_contact_num . '</td></tr>        <tr><td>' . $tenant_details->tenant_email_id . '</td></tr>    </table>';    $pdf->writeHTML($tbl, true, false, false, false, 'R');    $pdf->SetFont('helvetica', 'B', 12);    $pdf->Write(0, 'EVALUATION SUMMARY', '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 10);        $tbl = '<table cellspacing="0" cellpadding="1" border="1" align="left">                <tr>                   <td colspan="2"> Title of Course: </td>                 </tr>                 <tr>                   <td colspan="2"> Course Date(s): </td>                 </tr>                <tr>                   <td> Name of Trainer: </td>                     <td> </td>                 </tr>                 <tr>                   <td> Name of Participant : </td>                     <td> Organization: </td>                 </tr>                            </table>';    $pdf->writeHTML($tbl, true, false, false, false, 'R');    //    $tbl = '<br><div>Please fill in the evaluation score according to the following <b>Rating Guide</b> based on scale of 1 to 5 where:</div>//    $tbl = '<table style="font-size:9px;"><tr><td>1 - Very Poor</td><td>2 - Poor</td><td>3 - Average</td><td>4 - Good</td><td>5 - Excellent</td></tr></table>';//    $pdf->writeHTML($tbl, true, false, false, false, 'C');    $tbl = '<table cellspacing="0" cellpadding="1" border="1">    <tr>        <th width="25px" align="center"> <b>A.</b> </th>        <th width="360px"> <b>' . $meta_map['FDBCK01'] . '</b></th>        <th width="57px" align="center"><b>Strongly agree<br/>5</b></th>        <th width="50px" align="center"><b>Agree<br/>4</b></th>        <th width="50px" align="center"><b>Neutral<br/>3</b></th>        <th width="57px" align="center"><b>Disagree<br/>2</b></th>        <th width="57px" align="center"><b>Strongly disagree<br/>1</b></th>    </tr>    <tr>        <td align="center">1.</td>        <td>' . $meta_map['Q01'] . '</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">2.</td>        <td>' . $meta_map['Q02'] . '.</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">3.</td>        <td>' . $meta_map['Q03'] . '. </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">4.</td>        <td>' . $meta_map['Q04'] . '.   </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>       <tr> <td colspan="7"></td></tr>    <tr>                <th width="25px" align="center"> <b>B.</b> </th>        <th width="360px"> <b>' . $meta_map['FDBCK02'] . '</b></th>        <th width="57px" align="center"><b>Strongly agree<br/>5</b></th>        <th width="50px" align="center"><b>Agree<br/>4</b></th>        <th width="50px" align="center"><b>Neutral<br/>3</b></th>        <th width="57px" align="center"><b>Disagree<br/>2</b></th>        <th width="57px" align="center"><b>Strongly disagree<br/>1</b></th>    </tr>     <tr>        <td align="center">5.</td>        <td>' . $meta_map['Q05'] . '. </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">6.</td>        <td>' . $meta_map['Q06'] . '.</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>     <tr>        <td align="center">7.</td>        <td>' . $meta_map['Q07'] . '.</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">8.</td>        <td>' . $meta_map['Q08'] . '.  </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>           <tr> <td colspan="7"></td></tr>    <tr>                <th width="25px" align="center"> <b>C.</b> </th>        <th width="360px"> <b>' . $meta_map['FDBCK03'] . '</b></th>       <th width="57px" align="center"><b>Strongly agree<br/>5</b></th>        <th width="50px" align="center"><b>Agree<br/>4</b></th>        <th width="50px" align="center"><b>Neutral<br/>3</b></th>        <th width="57px" align="center"><b>Disagree<br/>2</b></th>        <th width="57px" align="center"><b>Strongly disagree<br/>1</b></th>    </tr>    <tr>        <td align="center">9.</td>        <td>' . $meta_map['Q09'] . '.  </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">10.</td>        <td>' . $meta_map['Q10'] . '. </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>       </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $html = <<<EOF        <div>11. Other comments that you feel will help improve the course.<br/>            _________________________________________________________________________________________            _________________________________________________________________________________________</div>               EOF;    $pdf->writeHTML($html, true, false, true, false, '');    $pdf->Output('feedback.pdf', 'D');    }else{                    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->model('meta_values', 'meta');    $meta_map = $ci->meta->get_param_map();    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetCreator(PDF_CREATOR);    $pdf->SetPrintHeader(false);    $pdf->SetPrintFooter(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 10);    $pdf->Image(FCPATH . 'logos/' . $tenant_details->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $pdf->writeHTML('<br>', true, false, false, false, '');    $tbl = '<table style="font-size:8px;">        <tr><td>' . $tenant_details->tenant_address . '</td></tr>        <tr><td>' . $tenant_details->tenant_city . '</td></tr>        <tr><td>Tel: ' . $tenant_details->tenant_contact_num . '</td></tr>        <tr><td>' . $tenant_details->tenant_email_id . '</td></tr>    </table>';    $pdf->writeHTML($tbl, true, false, false, false, 'R');    $pdf->SetFont('helvetica', 'B', 12);    $pdf->Write(0, 'Post-Course Evaluation', '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 10);    $tbl = '<br><div>Please fill in the evaluation score according to the following <b>Rating Guide</b> based on scale of 1 to 5 where:</div>    <table style="font-size:9px;"><tr><td>1 - Strongly disagree</td><td>2 - Disagree</td><td>3 - Neutral</td><td>4 - Agree</td><td>5 - Strongly agree</td></tr></table>';    $pdf->writeHTML($tbl, true, false, false, false, 'C');    $tbl = '<table cellspacing="0" cellpadding="1" border="1">    <tr>        <th width="50px" align="center"> <b>A.</b> </th>        <th width="450px"> <b>' . $meta_map['FDBCK01'] . '</b></th>        <th width="30px" align="center"><b>1</b></th>        <th width="30px" align="center"><b>2</b></th>        <th width="30px" align="center"><b>3</b></th>        <th width="30px" align="center"><b>4</b></th>        <th width="30px" align="center"><b>5</b></th>    </tr>    <tr>        <td align="center">1.</td>        <td>' . $meta_map['Q01'] . '</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">2.</td>        <td>' . $meta_map['Q02'] . '.</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">3.</td>        <td>' . $meta_map['Q03'] . '. </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">4.</td>        <td>' . $meta_map['Q04'] . '.   </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">5.</td>        <td>' . $meta_map['Q05'] . '. </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">6.</td>        <td>' . $meta_map['Q06'] . '.</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr> <td colspan="7"></td></tr>    <tr>        <th width="50px" align="center"> <b>B.</b> </th>        <th width="450px"> <b>' . $meta_map['FDBCK02'] . '</b></th>        <th width="30px" align="center"><b>1</b></th>        <th width="30px" align="center"><b>2</b></th>        <th width="30px" align="center"><b>3</b></th>        <th width="30px" align="center"><b>4</b></th>        <th width="30px" align="center"><b>5</b></th>    </tr>    <tr>        <td align="center">1.</td>        <td>' . $meta_map['Q07'] . '.</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">2.</td>        <td>' . $meta_map['Q08'] . '.  </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">3.</td>        <td>' . $meta_map['Q09'] . '.  </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">4.</td>        <td>' . $meta_map['Q10'] . '. </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">5.</td>        <td>' . $meta_map['Q11'] . '.  </td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr> <td colspan="7"></td></tr>    <tr>        <th width="50px" align="center"> <b>C.</b> </th>        <th width="450px"> <b>' . $meta_map['FDBCK03'] . '</b></th>        <th width="30px" align="center"><b>1</b></th>        <th width="30px" align="center"><b>2</b></th>        <th width="30px" align="center"><b>3</b></th>        <th width="30px" align="center"><b>4</b></th>        <th width="30px" align="center"><b>5</b></th>    </tr>    <tr>        <td align="center">1.</td>        <td>' . $meta_map['Q12'] . '.</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">2.</td>        <td>' . $meta_map['Q13'] . '.</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">3.</td>        <td>' . $meta_map['Q14'] . '.</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr>    <tr>        <td align="center">4.</td>        <td>' . $meta_map['Q15'] . '.</td>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>    </tr></table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $html = <<<EOF        <div>Name: ________________________________</div>        <div>NRIC or Work Pass No.: __________________________________</div>        <div>Course Title: __________________________________</div>        <div>Course Date: __________________________________</div>EOF;    $pdf->writeHTML($html, true, false, true, false, '');    $pdf->Output('feedback.pdf', 'D');    }}/** * Generate class attendance * @param type $results * @param type $class_details * @param type $tenant * @param type $class_schedule_data */function generate_class_attendance_pdf($results, $class_details, $tenant, $class_schedule_data=null) {  // print_r($class_schedule_data);   // echo count($class_schedule_data);    if(count($class_schedule_data)>0)    {        $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);        $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);        if (empty($start_date))            $start_date = new DateTime();        if (empty($end_date))            $end_date = clone $start_date;        $ci = & get_instance();        $ci->load->library('TMS_TCPDF');        $ci->load->helper('common');        $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);        $pdf->SetPrintHeader(false);        $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));        $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));        $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);        $pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);        $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);        $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);        $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);        $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $ci = & get_instance();         $ci->load->model('class_trainee_model', 'classtraineemodel');        $className = $class_details->class_name;        $courseName = $class_details->crse_name;        $course_id= $class_details->course_id;        $class_id= $class_details->class_id;        $tenant_id = $class_details->tenant_id; // skm2        $check_attendance=$ci->classtraineemodel->check_attendance_row($tenant_id,$course_id,$class_id);                $is_two_sessions = $class_details->class_session_day == 2;        $current_date = $start_date;        $weeks = create_week_days_array($start_date, $end_date , $class_schedule_data);                foreach ($weeks as $days) {            $pdf->SetFont('helvetica', '', 8);            $pdf->AddPage();            $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);            $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);            $tbl = '<br><br><table cellspacing="0" cellpadding="1" width="100%">                    <tr>                        <td width="65%">';            $class_start_date_formatted = date_format_singapore($class_details->class_start_datetime) . " " . time_format_singapore($class_details->class_start_datetime);            $class_end_date_formatted = date_format_singapore($class_details->class_end_datetime) . " " . time_format_singapore($class_details->class_end_datetime);            $tbl .= '<table width="70%" border="0">                <tr><td width="30%">Course Title:</td><td width="70%"><u>' . $courseName . '</u></td></tr>                <tr><td>Name of Training:</td><td><u>' . $className . '</u></td></tr>                <tr><td>Training Duration:</td><td><u>' . $class_start_date_formatted . ' To ' . $class_end_date_formatted . '</u></td></tr>                <tr><td>Trainer:</td><td><u>' . $class_details->classroom_trainer . '</u></td></tr>                <tr><td>Assessor:</td><td><u>' . $class_details->assessor . '</u></td></tr>                <tr><td>Company:</td><td><u>' . $class_details->company_name . '</u></td></tr>                <tr><td>Class ID:</td><td><u>' . $class_details->class_id . '</u></td></tr>                </table>                <br>';            $tbl .='</td>                        <td width="35%">                            <table align="right">                                <tr>                                    <td>' . $tenant->tenant_name . '</td>                                </tr>                                <tr>                                    <td>' . $tenant->tenant_address . '<br>'                                    . $tenant->tenant_country . '</td>                                </tr>                                <tr>                                    <td>Tel :' . $tenant->tenant_contact_num . '</td>                                </tr>                                <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';                $pdf->writeHTML($tbl, true, false, false, false, '');        $pdf->SetFont('helvetica', 'B', 11);        $period = ($start_date->format("d M Y") == $end_date->format("d M Y"))?$start_date->format("d M Y") :$start_date->format("d M Y") . " - " . $end_date->format("d M Y");        $pdf->Write(0, "Attendance Report for '$courseName-$className'. Period: " .$period, '', 0, 'L', true, 0, false, false, 0);        $pdf->SetFont('helvetica', '', 8);        $pdf->writeHTML('<br>', true, false, false, false, '');        $days_count = count($days);        $days_period = ($days[0]->format('d M Y') == $days[$days_count - 1]->format("d M Y")) ? $days[0]->format('d M Y') : $days[0]->format('d M Y') . ' - ' . $days[$days_count - 1]->format("d M Y");        $tbl = '<table cellspacing="0" cellpadding="1" border="1">                <tr>                    <th width="30px" align="center"><b>Sl #</b> </th>                    <th width="100px" align="center"><b>NRIC/FIN No.</b></th>                    <th width="130px" align="center"><b>Trainee Name</b></th>                    <th width="45px" align="center"></th>                    <th align="center" colspan="' . $days_count . '" width="320px"><b>Attendance  for the period ' . $days_period . '</b></th>                    <th width="50px" align="center"><b>Assmnt. Sign.</b></th>                </tr>                <tr>                <td colspan="3"></td><td align="center">Session</td>';        for ($i = 0; $i < $days_count; $i++) {            $date = isset($days[$i]) ? $days[$i] : null;            $session_time = '';            if ($date != null) {                $session_time = " <br/>" . $class_schedule_data[$date->format('d/m/y')][1];            }            if ($is_two_sessions && $date != null) {                $session_time2 = $class_schedule_data[$date->format('d/m/y')][2];                if ($session_time2) {                    $session_time .= " | " . $session_time2;                }            }                         $tbl .= '<td align="center">' . ($date == null ? '' : $date->format('d/m/y')) . $session_time . '</td>';        }        $tbl .= '<td></td></tr>';        $counter = 1;        foreach ($results as $data)         {            $tbl .= '<tr><td ' . ($is_two_sessions ? ' rowspan="2" ' : '') . ' align="center">' . $counter . '</td>';	    if($tenant_id == 'T02' || $tenant_id == 'T12') {            	$tbl .= '<td ' . ($is_two_sessions ? ' rowspan="2" ' : '') . '>' . mask_format($data['record']['tax_code']) . '</td>'; 	    } else {		$tbl .= '<td ' . ($is_two_sessions ? ' rowspan="2" ' : '') . '>' . mask_format($data['record']['tax_code']) . '</td>';		}            	    $tbl .= '<td ' . ($is_two_sessions ? ' rowspan="2" ' : '') . '>' . $data['record']['name'] . '</td>';            $tbl .= '<td>Session1</td>';            for ($i = 0; $i < $days_count; $i++)             {                $date = isset($days[$i]) ? $days[$i] : null;                $res = '';                if ($date != null) {                    $date_formated = $date->format('Y-m-d');                    $record = $data[$date_formated];                    if (!empty($record)) {                        $res = $record['session_01'] == '1' ? 'P' : '';                    }                    if ($res == '' && strtotime($date_formated) <= strtotime(date('Y-m-d')))                     {                        $res = 'AB';                                            }                }                if($check_attendance<=0){                                $res='P';                        }                $tbl .= '<td align="center">' . $res . '</td>';            }            $tbl .= '<td></td></tr>';            if ($is_two_sessions) {                $tbl .= '<tr>';                $tbl .= '<td>Session2</td>';                for ($i = 0; $i < $days_count; $i++) {                    $date = isset($days[$i]) ? $days[$i] : null;                    $res = '';                    if ($date != null) {                        $date_formated = $date->format('Y-m-d');                        $record = $data[$date_formated];                        if (!empty($record)) {                            $res = $record['session_02'] == '1' ? 'P' : '';                        }                        if ($res == '' && strtotime($date_formated) <= strtotime(date('Y-m-d'))) {                            $res = 'AB';                        }                    }                    if($check_attendance<=0){                                $res='P';                    }                    $tbl .= '<td align="center">' . $res . '</td>';                }                $tbl .= '<td></td></tr>';            }            $counter++;        }        $tbl .= '</table>';        $tbl .= '<br><p style="color:red;"><i>This is a computer generated report. No signature is required - ' . $tenant->tenant_name . ' Administrator.</i></p>';        $pdf->writeHTML($tbl, true, false, false, false, '');    }    $pdf->Output('attendance.pdf', 'D');     } else {      $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);    $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);    if (empty($start_date))        $start_date = new DateTime();    if (empty($end_date))        $end_date = clone $start_date;    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->helper('common');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);         $ci->load->model('class_trainee_model', 'classtraineemodel');        $className = $class_details->class_name;        $courseName = $class_details->crse_name;        $course_id= $class_details->course_id;        $class_id= $class_details->class_id;        $tenant_id = $class_details->tenant_id; // skm2        $check_attendance=$ci->classtraineemodel->check_attendance_row($tenant_id,$course_id,$class_id);        $is_two_sessions = $class_details->class_session_day == 2;    $current_date = $start_date;    $weeks = create_week_days_array($start_date, $end_date);    foreach ($weeks as $days) {        $pdf->SetFont('helvetica', '', 8);        $pdf->AddPage();        $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);        $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);        $tbl = '<br><br><table cellspacing="0" cellpadding="1" width="100%">                <tr>                    <td width="65%">';        $class_start_date_formatted = date_format_singapore($class_details->class_start_datetime) . " " . time_format_singapore($class_details->class_start_datetime);        $class_end_date_formatted = date_format_singapore($class_details->class_end_datetime) . " " . time_format_singapore($class_details->class_end_datetime);        $tbl .= '<table width="70%" border="0">            <tr><td width="30%">Course Title:</td><td width="70%"><u>' . $courseName . '</u></td></tr>            <tr><td>Name of Training:</td><td><u>' . $className . '</u></td></tr>            <tr><td>Training Duration:</td><td><u>' . $class_start_date_formatted . ' To ' . $class_end_date_formatted . '</u></td></tr>            <tr><td>Trainer:</td><td><u>' . $class_details->classroom_trainer . '</u></td></tr>            <tr><td>Assessor:</td><td><u>' . $class_details->assessor . '</u></td></tr>            <tr><td>Company:</td><td><u>' . $class_details->company_name . '</u></td></tr>            <tr><td>Class ID:</td><td><u>' . $class_details->class_id . '</u></td></tr>            </table>            <br>';        $tbl .='</td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                . $tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';                $pdf->writeHTML($tbl, true, false, false, false, '');        $pdf->SetFont('helvetica', 'B', 11);        $period = ($start_date->format("d M Y") == $end_date->format("d M Y"))?$start_date->format("d M Y") :$start_date->format("d M Y") . " - " . $end_date->format("d M Y");        $pdf->Write(0, "Attendance Report for '$courseName-$className'. Period: " .$period, '', 0, 'L', true, 0, false, false, 0);        $pdf->SetFont('helvetica', '', 8);        $pdf->writeHTML('<br>', true, false, false, false, '');        $days_count = count($days);        $days_period = ($days[0]->format('d M Y') == $days[$days_count - 1]->format("d M Y")) ? $days[0]->format('d M Y') : $days[0]->format('d M Y') . ' - ' . $days[$days_count - 1]->format("d M Y");        $tbl = '<table cellspacing="0" cellpadding="1" border="1">                <tr>                    <th width="30px" align="center"><b>Sl #</b> </th>                    <th width="100px" align="center"><b>NRIC/FIN No.</b></th>                    <th width="130px" align="center"><b>Trainee Name</b></th>                    <th width="45px" align="center"></th>                    <th align="center" colspan="' . $days_count . '" width="320px"><b>Attendance  for the period ' . $days_period . '</b></th>                    <th width="50px" align="center"><b>Assmnt. Sign.</b></th>                </tr>                <tr>                <td colspan="3"></td><td align="center">Session</td>';        for ($i = 0; $i < $days_count; $i++) {            $date = isset($days[$i]) ? $days[$i] : null;            $session_time = '';            if ($date != null) {                $session_time = " <br/>" . $class_schedule_data[$date->format('d/m/y')][1];            }            if ($is_two_sessions && $date != null) {                $session_time2 = $class_schedule_data[$date->format('d/m/y')][2];                if ($session_time2) {                    $session_time .= " | " . $session_time2;                }            }            $tbl .= '<td align="center">' . ($date == null ? '' : $date->format('d/m/y')) . $session_time . '</td>';        }        $tbl .= '<td></td></tr>';        $counter = 1;        foreach ($results as $data) {            $tbl .= '<tr><td ' . ($is_two_sessions ? ' rowspan="2" ' : '') . ' align="center">' . $counter . '</td>';	if($tenant_id == 'T02' || $tenant_id == 'T12') {            $tbl .= '<td ' . ($is_two_sessions ? ' rowspan="2" ' : '') . '>' . mask_format($data['record']['tax_code']) . '</td>';	} else {		$tbl .= '<td ' . ($is_two_sessions ? ' rowspan="2" ' : '') . '>' . mask_format($data['record']['tax_code']) . '</td>';	}            $tbl .= '<td ' . ($is_two_sessions ? ' rowspan="2" ' : '') . '>' . $data['record']['name'] . '</td>';            $tbl .= '<td>Session1</td>';            for ($i = 0; $i < $days_count; $i++) {                $date = isset($days[$i]) ? $days[$i] : null;                $res = '';                if ($date != null) {                    $date_formated = $date->format('Y-m-d');                    $record = $data[$date_formated];                    if (!empty($record)) {                        $res = $record['session_01'] == '1' ? 'P' : '';                    }                    if ($res == '' && strtotime($date_formated) <= strtotime(date('Y-m-d'))) {                        $res = 'AB';                    }                } if($check_attendance<=0){                                $res='P';                    }                                $tbl .= '<td align="center">' . $res . '</td>';            }            $tbl .= '<td></td></tr>';            if ($is_two_sessions) {                $tbl .= '<tr>';                $tbl .= '<td>Session2</td>';                for ($i = 0; $i < $days_count; $i++) {                    $date = isset($days[$i]) ? $days[$i] : null;                    $res = '';                    if ($date != null) {                        $date_formated = $date->format('Y-m-d');                        $record = $data[$date_formated];                        if (!empty($record)) {                            $res = $record['session_02'] == '1' ? 'P' : '';                        }                        if ($res == '' && strtotime($date_formated) <= strtotime(date('Y-m-d'))) {                            $res = 'AB';                        }                    } if($check_attendance<=0){                                $res='P';                    }                    $tbl .= '<td align="center">' . $res . '</td>';                }                $tbl .= '<td></td></tr>';            }            $counter++;        }        $tbl .= '</table>';        $tbl .= '<br><p style="color:red;"><i>This is a computer generated report. No signature is required - ' . $tenant->tenant_name . ' Administrator.</i></p>';        $pdf->writeHTML($tbl, true, false, false, false, '');    }    $pdf->Output('attendance.pdf', 'D');      }       //exit;}function generate_class_attendance_sheet_pdf($results, $class_details, $tenant, $class_schedule_data) {    $statment = 'I understand that the training provider will not be held responsible to resubmit the results should the Name and ID number was found incorrect after the course date.';    $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);    $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);    $interval = date_diff($start_date, $end_date);    $total_days = $interval->format('%a');    $className = $class_details->class_name;    if ((strpos($className, 'RFHC') !== false) && (($tenant->tenant_id == 'T02') || ($tenant->tenant_id == 'T12'))) {// else condition is at line no 1202 added by shubhranshu for refresher one session        if (count($class_schedule_data) > 0 or $total_days == 0) { // else condition is at line no 924            $ci = & get_instance();            $ci->load->library('TMS_TCPDF');            $ci->load->helper('common');            $ci->load->model('meta_values', 'meta');            $ci->load->model('trainee_model', 'traineemodel');            $meta_map = $ci->meta->get_param_map();            $orientation = $ci->input->post('orientation');            if ($orientation == 'P') {                $width1 = 330;                $width2 = 310;            } else {                $width1 = 500;                $width2 = 500;            }            $pdf = new TCPDF($orientation, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);            $pdf->SetPrintHeader(false);            $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));            $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));            $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);            $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);            $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);            $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);            $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);            $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);            $className = $class_details->class_name;            $courseName = $class_details->crse_name;            $class_start_date_formatted = date_format_singapore($class_details->class_start_datetime) . " " . time_format_singapore($class_details->class_start_datetime);            $class_end_date_formatted = date_format_singapore($class_details->class_end_datetime) . " " . time_format_singapore($class_details->class_end_datetime);            $is_two_sessions = $class_details->class_session_day == 2;            $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);            $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);            if (empty($start_date))                $start_date = new DateTime();            if (empty($end_date))                $end_date = clone $start_date;            $interval = date_diff($start_date, $end_date);            $total_days = $interval->format('%a');            $weeks = create_week_days_array($start_date, $end_date, $class_schedule_data);            //echo "<pre>"; print_r($weeks); die;            foreach ($weeks as $days) {                //print_r($days);                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "  Attendance List", 15, 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 9);                $tbl = '<br><br><table cellspacing="0" cellpadding="0">                <tr>                    <td >                       <table>                            <tr><td width="25%">Course Title:</td><td width="75%">' . $courseName . '</td></tr>                            <tr><td>Name of Training:</td><td>' . $className . '</td></tr>                            <tr><td>Training Duration:</td><td>' . $class_start_date_formatted . ' To ' . $class_end_date_formatted . '</td></tr>                            <tr><td>Trainer:</td><td>' . $class_details->classroom_trainer . '</td></tr>                            <tr><td>Assessor:</td><td>' . $class_details->assessor . '</td></tr>                            <tr><td>Company:</td><td>' . $class_details->company_name . '</td></tr>                            <tr><td>Class ID:</td><td>' . $class_details->class_id . '</td></tr>                            <tr><td>Training Hrs:</td><td>' . ($class_details->total_classroom_duration + $class_details->total_lab_duration) . '</td></tr>                            <tr><td> Assessment Hrs:</td><td>' . $class_details->assmnt_duration . '</td></tr>                        </table>                    </td>                    <td align="right">                        <table>                            <tr> <td align="right">' . $tenant->tenant_name . '</td> </tr>                            <tr><td align="right">' . $tenant->tenant_address . '<br>'                        . $tenant->tenant_country . '</td>                            </tr>                                                        <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';                $top_tbl = $tbl;                $pdf->writeHTML($tbl, true, false, false, false, '');                $day_schudle = $days;                $schudule_counts = array();                foreach ($day_schudle as $dayschedule) {                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][1])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][1];                    }                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][2])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][2];                    }                }                $schudule_counts = sizeof($schudule_counts);                if ($total_days != 0)                    $date_columns_count = $schudule_counts;                else                    $date_columns_count = 2;                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                                    $tbl = '<table cellspacing="0" cellpadding="1" border="1">                    <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="275px" rowspan="2" align="center"><b>Name</b></th>                        <th width="67px" rowspan="2" align="center"><b>NRIC</b></th>                        <th width="38px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="55px" rowspan="2" align="center"><b>Country</b></th>                        <th width="65px" rowspan="2" align="center"><b>Course Date</b></th>                        <th width="65px" rowspan="2" align="center"><b>Assessment. Date</b></th>                        <th width="25px" rowspan="2" align="center"><b>A/P</b></th>                        <th colspan="" width="300px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                         <th width="110px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>                    <tr>';                                                $date_str .= $start_date->format('d/m/y') . '(1)';                $tbl .= '<td width="300px" align="center">' . $date_str . '</td>';                                 $tbl .= '</tr>';                $counter = 1;                $footer_text = array();                foreach ($results as $data) {                    $tbl .= '<tr nobr="true"><td align="center">' . $counter . '</td>';                    $name = (strlen($data['record']['name']) > 40) ? substr($data['record']['name'], 0, 37) . '...' : $data['record']['name'];                    $tbl .= '<td align="center" style="height:51px;">' . $name . '</td>';                    if ($tenant->tenant_id == 'T02' || $tenant->tenant_id == 'T12') {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    } else {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    }                    $data['record']['company_id'] = ($data['record']['company_id'] == 0) ? '' : $data['record']['company_id'];                    $tbl .= '<td align="center">' . $data['record']['company_id'] . '</td>';                    if (!empty($data['record']['company_id'])) {                        if ($data['record']['company_id'][0] == 'T') {                            $footer_text[$data['record']['company_id']] = $tenant->tenant_name;                        } else {                            $footer_text[$data['record']['company_id']] = $data['record']['company_name'];                        }                    }                    $tbl .= '<td align="center">' . $data['record']['nationality'] . '</td>';                    $assmnt_date = $ci->traineemodel->get_assessment_date($data['record']['class_id'], $data['record']['user_id']);                    $formatd_assmnt_date = empty($assmnt_date) ? '' : date('d/m/Y', strtotime($assmnt_date));                    $tbl .= '<td align="center">' . date('d/m/Y', strtotime($class_details->class_start_datetime)) . '</td>';                    $tbl .= '<td align="center">' . $formatd_assmnt_date . '</td>';                    if ($data['record']['att'] == 1) {                        $att = "P";                    } else {                        $att = "A";                    }                    $tbl .= '<td align="center">    ' . $att . '    </td>';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $tbl .= '<td></td>';                    }                    $tbl .= '</tr>';                    $counter++;                }                //exit;                $date_columns_count = $date_columns_count + 1;                $class_total_users = $counter - 1;                $tbl .= '<tr><td colspan="6"></td><td>Absent</td>';                for ($i = 0; $i < $date_columns_count-1; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Present</td>';                for ($i = 0; $i < $date_columns_count-1; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Total</td>';                for ($i = 0; $i < $date_columns_count-1; $i++) {                    $tbl .= '<td align="center">' . $class_total_users . '</td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                for ($i = 0; $i < $date_columns_count-1; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '<td></td></tr></table>';                $footer_data = '';                foreach ($footer_text as $k => $v) {                    $footer_data .= '<div>** ' . $k . ' - ' . $v . '</div>';                }                $tbl .= $foot_tbl = '<br><br><table width="50%" border="0">        <tr><td width="40%">Name of Company:</td><td width="60%">' . $class_details->company_name . '</td></tr>        <tr><td>Full Name & Designation of Director:</td><td>' . ucfirst($tenant->director_name) . '</td></tr>        </table>        <p><i>' . $statment . '</i></p>        <p style="color:red;"><i>This is a computer generated form. No signature is required - ' . $tenant->tenant_name . ' Administrator.</i></p>        ';                $pdf->writeHTML($tbl . $footer_data, true, false, false, false, '');            }            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->writeHTML($top_tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $pdf->writeHTML($details, true, false, false, false, '');                // $date_columns_count = $class_details->class_session_day * count($days);                $day_schudle = $days;                $schudule_counts = array();                foreach ($day_schudle as $dayschedule) {                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][1])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][1];                    }                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][2])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][2];                    }                }                $schudule_counts = sizeof($schudule_counts);                if ($total_days != 0)                    $date_columns_count = $schudule_counts;                else                    $date_columns_count = 2;                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                                    $tbl = '<table cellspacing="0" cellpadding="1" border="1">                    <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="275px" rowspan="2" align="center"><b>Name</b></th>                        <th width="65px" rowspan="2" align="center"><b>NRIC</b></th>                        <th width="38px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="35px" rowspan="2" align="center"><b>Country</b></th>                        <th width="65px" rowspan="2" align="center"><b>Course Date</b></th>                        <th width="65px" rowspan="2" align="center"><b>Assessment Date</b></th>                        <th width="25px" rowspan="2" align="center"><b>A/P</b></th>                        <th colspan="" width="300px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                         <th width="110px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>                <tr>';                                                $tbl .= '<td width="300px" align="center">' . $date_str . '</td>';                                 $tbl .= '</tr>';                for ($f = 0; $f < 12; $f++) {                    $tbl .= '<tr><td align="center">' . ($counter + $f) . '</td>';                    $tbl .= '<td align="center" style="height:51px;"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $extra_td = '';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $extra_td .= '<td></td>';                    }                    $tbl .=$extra_td;                    $tbl .= '<td></td></tr>';                }                $tbl .= '<tr><td colspan="6"></td><td>Absent<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Present<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Total<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                $tbl .=$extra_td;                $tbl .= '<td></td></tr></table>';                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->writeHTML($foot_tbl, true, false, false, false, '');            }            $pdf->Output('attendance_sheet.pdf', 'D');        } else {   // if condtion is on line no: 620            $ci = & get_instance();            $ci->load->library('TMS_TCPDF');            $ci->load->helper('common');            $ci->load->model('meta_values', 'meta');            $ci->load->model('trainee_model', 'traineemodel');            $meta_map = $ci->meta->get_param_map();            $orientation = $ci->input->post('orientation');            if ($orientation == 'P') {                $width1 = 330;                $width2 = 310;            } else {                /* previous code pdf width decide from here                  $width1=630;                  $width2=610 ;                 */                $width1 = 530;                $width2 = 510;            }            $pdf = new TCPDF($orientation, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);            $pdf->SetPrintHeader(false);            $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));            $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));            $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);            $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);            $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);            $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);            $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);            $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);            $className = $class_details->class_name;            $courseName = $class_details->crse_name;            $class_start_date_formatted = date_format_singapore($class_details->class_start_datetime) . " " . time_format_singapore($class_details->class_start_datetime);            $class_end_date_formatted = date_format_singapore($class_details->class_end_datetime) . " " . time_format_singapore($class_details->class_end_datetime);            $is_two_sessions = $class_details->class_session_day == 2;            $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);            $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);            if (empty($start_date))                $start_date = new DateTime();            if (empty($end_date))                $end_date = clone $start_date;            $weeks = create_week_days_array($start_date, $end_date);            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="75%">                        &nbsp;                    </td>                    <td width="25%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                        . $tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';                $top_tbl = $tbl;                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $details = '<br><br><br><table width="50%" border="0">            <tr><td width="25%">Course Title:</td><td width="75%"><u>' . $courseName . '</u></td></tr>            <tr><td>Name of Training:</td><td><u>' . $className . '</u></td></tr>            <tr><td>Training Duration:</td><td><u>' . $class_start_date_formatted . ' To ' . $class_end_date_formatted . '</u></td></tr>            <tr><td>Trainer:</td><td><u>' . $class_details->classroom_trainer . '</u></td></tr>            <tr><td>Assessor:</td><td><u>' . $class_details->assessor . '</u></td></tr>            <tr><td>Company:</td><td><u>' . $class_details->company_name . '</u></td></tr>            <tr><td>Class ID:</td><td><u>' . $class_details->class_id . '</u></td></tr>            <tr><td>Training Hrs:</td><td><u>' . ($class_details->total_classroom_duration + $class_details->total_lab_duration) . '</u></td></tr>            <tr><td> Assessment Hrs:</td><td><u>' . $class_details->assmnt_duration . '</u></td></tr>            </table>            <br>';                $pdf->writeHTML($details, true, false, false, false, '');                /*                  echo "date_columns_count";echo $date_columns_count = $class_details->class_session_day * count($days); echo "<br/>";                  echo "column_width"; echo $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count); echo "<br/>";                  echo "total_column_width";echo $total_column_width = $column_width * $date_columns_count;                  //exit();                 */                $date_columns_count = $class_details->class_session_day * count($days);                $column_width1 = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $column_width = ($column_width1 - 60);                $total_column_width = $column_width * $date_columns_count;//$total_column_width =($total_column_width1-20);                $tbl = '<table cellspacing="0" cellpadding="1" border="1">                    <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="80px" rowspan="2" align="center"><b>Name</b></th>                        <th width="65px" rowspan="2" align="center"><b>NRIC/FIN No.</b></th>                        <th width="32px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="38px" rowspan="2" align="center"><b>Cntry</b></th>                        <th width="55px" rowspan="2" align="center"><b>Class Start Date</b></th>                        <th width="55px" rowspan="2" align="center"><b>Assmnt. Dt.</b></th>                        <th width="20px" rowspan="2" align="center"><b>A/P</b></th>                        <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                        <th width="85px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>                    <tr>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array($days, $is_two_sessions, $i);                    $date_str = $date_check = $cur_date->format('d/m/y');                    if ($is_two_sessions) {                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                    } else {                        $date_str .= " (1) " . $class_schedule_data[$date_check][1];                    }                    $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                }                $tbl .= '</tr>';                $counter = 1;                $footer_text = array();                foreach ($results as $data) {                    $tbl .= '<tr><td align="center">' . $counter . '</td>';                    $name = (strlen($data['record']['name']) > 40) ? substr($data['record']['name'], 0, 37) . '...' : $data['record']['name'];                    $tbl .= '<td align="center" style="height:51px;">' . $name . '</td>';                    if ($tenant->tenant_id == 'T02' || $tenant->tenant_id == 'T12') {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    } else {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    }                    $data['record']['company_id'] = ($data['record']['company_id'] == 0) ? '' : $data['record']['company_id'];                    $tbl .= '<td align="center">' . $data['record']['company_id'] . '</td>';                    if (!empty($data['record']['company_id'])) {                        if ($data['record']['company_id'][0] == 'T') {                            $footer_text[$data['record']['company_id']] = $tenant->tenant_name;                        } else {                            $footer_text[$data['record']['company_id']] = $data['record']['company_name'];                        }                    }                    $tbl .= '<td align="center">' . $data['record']['nationality'] . '</td>';                    $assmnt_date = $ci->traineemodel->get_assessment_date($data['record']['class_id'], $data['record']['user_id']);                    $formatd_assmnt_date = empty($assmnt_date) ? '' : date('d/m/Y', strtotime($assmnt_date));                    $tbl .= '<td align="center">' . date('d/m/Y', strtotime($class_details->class_start_datetime)) . '</td>';                    $tbl .= '<td align="center">' . $formatd_assmnt_date . '</td>';                    if ($data['record']['att'] == 1) {                        $att = "P";                    } else {                        $att = "A";                    }                    $tbl .= '<td align="center">    ' . $att . '    </td>';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $tbl .= '<td></td>';                    }                    $tbl .= '<td></td></tr>';                    $counter++;                }                $class_total_users = $counter - 1;                $tbl .= '<tr><td colspan="6"></td><td>Absent</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Present</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Total</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td align="center">' . $class_total_users . '</td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr></table>';                $footer_data = '';                foreach ($footer_text as $k => $v) {                    $footer_data .= '<div>** ' . $k . ' - ' . $v . '</div>';                }                $tbl .= $foot_tbl = '<br><br><table width="50%" border="0">        <tr><td width="40%">Name of Company:</td><td width="60%">' . $class_details->company_name . '</td></tr>        <tr><td>Full Name & Designation of Director:</td><td>' . ucfirst($tenant->director_name) . '</td></tr>        </table>        <p><i>' . $statment . '</i></p>        <p style="color:red;"><i>This is a computer generated form. No signature is required - ' . $tenant->tenant_name . ' Administrator.</i></p>        ';                $pdf->writeHTML($tbl . $footer_data, true, false, false, false, '');            }            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->writeHTML($top_tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $pdf->writeHTML($details, true, false, false, false, '');                $date_columns_count = $class_details->class_session_day * count($days);                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                $tbl = '<table cellspacing="0" cellpadding="1" border="1">            <tr>                <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                <th width="80px" rowspan="2" align="center"><b>Name</b></th>                <th width="65px" rowspan="2" align="center"><b>NRIC/FIN No.</b></th>                <th width="32px" rowspan="2" align="center"><b>Comp Id</b></th>                <th width="38px" rowspan="2" align="center"><b>Cntry</b></th>                <th width="55px" rowspan="2" align="center"><b>Class Start Date</b></th>                <th width="55px" rowspan="2" align="center"><b>Assmnt. Dt.</b></th>                <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                <th width="55px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>            </tr>            <tr>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array($days, $is_two_sessions, $i);                    $date_str = $date_check = $cur_date->format('d/m/y');                    if ($is_two_sessions) {                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                    } else {                        $date_str .= " (1) " . $class_schedule_data[$date_check][1];                    }                    $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                }                $tbl .= '</tr>';                for ($f = 0; $f < 12; $f++) {                    $tbl .= '<tr><td align="center">' . ($counter + $f) . '</td>';                    $tbl .= '<td align="center" style="height:51px;"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $extra_td = '';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $extra_td .= '<td></td>';                    }                    $tbl .=$extra_td;                    $tbl .= '<td></td></tr>';                }                $tbl .= '<tr><td colspan="6"></td><td>Absent<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Present<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Total<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                $tbl .=$extra_td;                $tbl .= '</tr></table>';                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->writeHTML($foot_tbl, true, false, false, false, '');            }            $pdf->Output('attendance_sheet.pdf', 'D');        }    } else { // if conditioon is line no : 619        if (count($class_schedule_data) > 0 or $total_days == 0) { //else condition is at line 1553            $ci = & get_instance();            $ci->load->library('TMS_TCPDF');            $ci->load->helper('common');            $ci->load->model('meta_values', 'meta');            $ci->load->model('trainee_model', 'traineemodel');            $meta_map = $ci->meta->get_param_map();            $orientation = $ci->input->post('orientation');            if ($orientation == 'P') {                $width1 = 330;                $width2 = 310;            } else {                $width1 = 400;                $width2 = 400;            }            $pdf = new TCPDF($orientation, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);            $pdf->SetPrintHeader(false);            $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));            $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));            $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);            $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);            $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);            $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);            $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);            $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);            $className = $class_details->class_name;            $courseName = $class_details->crse_name;            $class_start_date_formatted = date_format_singapore($class_details->class_start_datetime) . " " . time_format_singapore($class_details->class_start_datetime);            $class_end_date_formatted = date_format_singapore($class_details->class_end_datetime) . " " . time_format_singapore($class_details->class_end_datetime);            $is_two_sessions = $class_details->class_session_day == 2;            $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);            $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);            if (empty($start_date))                $start_date = new DateTime();            if (empty($end_date))                $end_date = clone $start_date;            $interval = date_diff($start_date, $end_date);            $total_days = $interval->format('%a');            $weeks = create_week_days_array($start_date, $end_date, $class_schedule_data);            // echo "<pre>"; print_r($results); die;            foreach ($weeks as $days) {                //print_r($days);                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "  Attendance List", 15, 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 9);                $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td >                       <table>                            <tr><td width="25%">Course Title:</td><td width="75%">' . $courseName . '</td></tr>                            <tr><td>Name of Training:</td><td>' . $className . '</td></tr>                            <tr><td>Training Duration:</td><td>' . $class_start_date_formatted . ' To ' . $class_end_date_formatted . '</td></tr>                            <tr><td>Trainer:</td><td>' . $class_details->classroom_trainer . '</td></tr>                            <tr><td>Assessor:</td><td>' . $class_details->assessor . '</td></tr>                            <tr><td>Company:</td><td>' . $class_details->company_name . '</td></tr>                            <tr><td>Class ID:</td><td>' . $class_details->class_id . '</td></tr>                            <tr><td>Training Hrs:</td><td>' . ($class_details->total_classroom_duration + $class_details->total_lab_duration) . '</td></tr>                            <tr><td> Assessment Hrs:</td><td>' . $class_details->assmnt_duration . '</td></tr>                        </table>                    </td>                    <td align="right">                        <table>                            <tr> <td align="right">' . $tenant->tenant_name . '</td> </tr>                            <tr><td align="right">' . $tenant->tenant_address . '<br>'                        . $tenant->tenant_country . '</td>                            </tr>                                                        <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';                $top_tbl = $tbl;                $pdf->writeHTML($tbl, true, false, false, false, '');                $day_schudle = $days;                $schudule_counts = array();                foreach ($day_schudle as $dayschedule) {                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][1])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][1];                    }                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][2])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][2];                    }                }                $schudule_counts = sizeof($schudule_counts);                if ($total_days != 0)                    $date_columns_count = $schudule_counts;                else                    $date_columns_count = 2;                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                $tbl = '<table cellspacing="0" cellpadding="1" border="1">                    <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="175px" rowspan="2" align="center"><b>Name</b></th>                        <th width="68px" rowspan="2" align="center"><b>NRIC</b></th>                        <th width="38px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="30px" rowspan="2" align="center"><b>Country</b></th>                        <th width="65px" rowspan="2" align="center"><b>Course Date</b></th>                        <th width="65px" rowspan="2" align="center"><b>Assessment. Date</b></th>                        <th width="25px" rowspan="2" align="center"><b>A/P</b></th>                        <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                         <th width="110px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>                    <tr>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array1($days, $class_schedule_data, $i);                    $explode_curdates = explode("-", $cur_date[$i]);                    $date_str = $date_check = $explode_curdates[0];                    $date_sessions = $explode_curdates[1];                    if (!empty($class_schedule_data[$date_check])) {                        if ($date_sessions == 'S1') {                            $date_str .= " (1) " . $class_schedule_data[$date_check][1];                        } else {                            $date_str .= " (2) " . $class_schedule_data[$date_check][2];                        }                        $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                    } elseif ($total_days == 0) {                        $date_str .= $start_date->format('d/m/y');                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                        $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                    }                    //echo '<pre>'; print_r($date_str);                }                $tbl .= '</tr>';                $counter = 1;                $footer_text = array();                foreach ($results as $data) {                    $tbl .= '<tr nobr="true"><td align="center">' . $counter . '</td>';                    $name = (strlen($data['record']['name']) > 40) ? substr($data['record']['name'], 0, 37) . '...' : $data['record']['name'];                    $tbl .= '<td align="center" style="height:51px;">' . $name . '</td>';                    if ($tenant->tenant_id == 'T02' || $tenant->tenant_id == 'T12') {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    } else {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    }                    $data['record']['company_id'] = ($data['record']['company_id'] == 0) ? '' : $data['record']['company_id'];                    $tbl .= '<td align="center">' . $data['record']['company_id'] . '</td>';                    if (!empty($data['record']['company_id'])) {                        if ($data['record']['company_id'][0] == 'T') {                            $footer_text[$data['record']['company_id']] = $tenant->tenant_name;                        } else {                            $footer_text[$data['record']['company_id']] = $data['record']['company_name'];                        }                    }                    $tbl .= '<td align="center">' . $data['record']['nationality'] . '</td>';                    $assmnt_date = $ci->traineemodel->get_assessment_date($data['record']['class_id'], $data['record']['user_id']);                    $formatd_assmnt_date = empty($assmnt_date) ? '' : date('d/m/Y', strtotime($assmnt_date));                    $tbl .= '<td align="center">' . date('d/m/Y', strtotime($class_details->class_start_datetime)) . '</td>';                    $tbl .= '<td align="center">' . $formatd_assmnt_date . '</td>';                    if ($data['record']['att'] == 1) {                        $att = "P";                    } else {                        $att = "A";                    }                    $tbl .= '<td align="center">    ' . $att . '    </td>';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $tbl .= '<td></td>';                    }                    $tbl .= '<td></td></tr>';                    $counter++;                }                //exit;                $date_columns_count = $date_columns_count + 1;                $class_total_users = $counter - 1;                $tbl .= '<tr><td colspan="6"></td><td>Absent</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Present</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Total</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td align="center">' . $class_total_users . '</td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                for ($i = 0; $i < $date_columns_count + 1; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr></table>';                $footer_data = '';                foreach ($footer_text as $k => $v) {                    $footer_data .= '<div>** ' . $k . ' - ' . $v . '</div>';                }                $tbl .= $foot_tbl = '<br><br><table width="50%" border="0">        <tr><td width="40%">Name of Company:</td><td width="60%">' . $class_details->company_name . '</td></tr>        <tr><td>Full Name & Designation of Director:</td><td>' . ucfirst($tenant->director_name) . '</td></tr>        </table>        <p><i>' . $statment . '</i></p>        <p style="color:red;"><i>This is a computer generated form. No signature is required - ' . $tenant->tenant_name . ' Administrator.</i></p>        ';                $pdf->writeHTML($tbl . $footer_data, true, false, false, false, '');            }            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->writeHTML($top_tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $pdf->writeHTML($details, true, false, false, false, '');                // $date_columns_count = $class_details->class_session_day * count($days);                $day_schudle = $days;                $schudule_counts = array();                foreach ($day_schudle as $dayschedule) {                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][1])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][1];                    }                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][2])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][2];                    }                }                $schudule_counts = sizeof($schudule_counts);                if ($total_days != 0)                    $date_columns_count = $schudule_counts;                else                    $date_columns_count = 2;                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                $tbl = '<table cellspacing="0" cellpadding="1" border="1">             <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="175px" rowspan="2" align="center"><b>Name</b></th>                        <th width="65px" rowspan="2" align="center"><b>NRIC</b></th>                        <th width="38px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="55px" rowspan="2" align="center"><b>Country</b></th>                        <th width="55px" rowspan="2" align="center"><b>Course Date</b></th>                        <th width="75px" rowspan="2" align="center"><b>Assessment Date</b></th>                        <th width="25px" rowspan="2" align="center"><b>A/P</b></th>                        <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                         <th width="110px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>            <tr>';                /*  for ($i = 0; $i < $date_columns_count; $i++) {                              $cur_date = get_date_from_week_array($days, $class_schedule_data, $i);                  $date_str = $date_check = $cur_date[$i];                  if(!empty($class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)]))                  {                  if ($is_two_sessions) {                  $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                  }else {                  $date_str .= " (1) " . $class_schedule_data[$date_check][1];                  }                  $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                  }                  elseif($total_days == 0)                  {                  $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                  $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                  }                  } */                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array1($days, $class_schedule_data, $i);                    $explode_curdates = explode("-", $cur_date[$i]);                    $date_str = $date_check = $explode_curdates[0];                    $date_sessions = $explode_curdates[1];                    if (!empty($class_schedule_data[$date_check])) {                        if ($date_sessions == 'S1') {                            $date_str .= " (1) " . $class_schedule_data[$date_check][1];                        } else {                            $date_str .= " (2) " . $class_schedule_data[$date_check][2];                        }                        $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                    } elseif ($total_days == 0) {                        $date_str .= $start_date->format('d/m/y');                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                        $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                    }                    //echo '<pre>'; print_r($date_str);                }                $tbl .= '</tr>';                for ($f = 0; $f < 12; $f++) {                    $tbl .= '<tr><td align="center">' . ($counter + $f) . '</td>';                    $tbl .= '<td align="center" style="height:51px;"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $extra_td = '';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $extra_td .= '<td></td>';                    }                    $tbl .=$extra_td;                    $tbl .= '<td></td><td></td></tr>';                }                $tbl .= '<tr><td colspan="6"></td><td>Absent<br/></td><td></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Present<br/></td><td></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Total<br/></td><td></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td><td></td><td></td>';                $tbl .=$extra_td;                $tbl .= '</tr></table>';                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->writeHTML($foot_tbl, true, false, false, false, '');            }            $pdf->Output('attendance_sheet.pdf', 'D');        } else {   // if condtion is on line no: 619            $ci = & get_instance();            $ci->load->library('TMS_TCPDF');            $ci->load->helper('common');            $ci->load->model('meta_values', 'meta');            $ci->load->model('trainee_model', 'traineemodel');            $meta_map = $ci->meta->get_param_map();            $orientation = $ci->input->post('orientation');            if ($orientation == 'P') {                $width1 = 330;                $width2 = 310;            } else {                /* previous code pdf width decide from here                  $width1=630;                  $width2=610 ;                 */                $width1 = 430;                $width2 = 410;            }            $pdf = new TCPDF($orientation, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);            $pdf->SetPrintHeader(false);            $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));            $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));            $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);            $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);            $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);            $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);            $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);            $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);            $className = $class_details->class_name;            $courseName = $class_details->crse_name;            $class_start_date_formatted = date_format_singapore($class_details->class_start_datetime) . " " . time_format_singapore($class_details->class_start_datetime);            $class_end_date_formatted = date_format_singapore($class_details->class_end_datetime) . " " . time_format_singapore($class_details->class_end_datetime);            $is_two_sessions = $class_details->class_session_day == 2;            $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);            $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);            if (empty($start_date))                $start_date = new DateTime();            if (empty($end_date))                $end_date = clone $start_date;            $weeks = create_week_days_array($start_date, $end_date);            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="75%">                        &nbsp;                    </td>                    <td width="25%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                        . $tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';                $top_tbl = $tbl;                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $details = '<br><br><br><table width="50%" border="0">            <tr><td width="25%">Course Title:</td><td width="75%"><u>' . $courseName . '</u></td></tr>            <tr><td>Name of Training:</td><td><u>' . $className . '</u></td></tr>            <tr><td>Training Duration:</td><td><u>' . $class_start_date_formatted . ' To ' . $class_end_date_formatted . '</u></td></tr>            <tr><td>Trainer:</td><td><u>' . $class_details->classroom_trainer . '</u></td></tr>            <tr><td>Assessor:</td><td><u>' . $class_details->assessor . '</u></td></tr>            <tr><td>Company:</td><td><u>' . $class_details->company_name . '</u></td></tr>            <tr><td>Class ID:</td><td><u>' . $class_details->class_id . '</u></td></tr>            <tr><td>Training Hrs:</td><td><u>' . ($class_details->total_classroom_duration + $class_details->total_lab_duration) . '</u></td></tr>            <tr><td> Assessment Hrs:</td><td><u>' . $class_details->assmnt_duration . '</u></td></tr>            </table>            <br>';                $pdf->writeHTML($details, true, false, false, false, '');                /*                  echo "date_columns_count";echo $date_columns_count = $class_details->class_session_day * count($days); echo "<br/>";                  echo "column_width"; echo $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count); echo "<br/>";                  echo "total_column_width";echo $total_column_width = $column_width * $date_columns_count;                  //exit();                 */                $date_columns_count = $class_details->class_session_day * count($days);                $column_width1 = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $column_width = ($column_width1 - 60);                $total_column_width = $column_width * $date_columns_count;//$total_column_width =($total_column_width1-20);                $tbl = '<table cellspacing="0" cellpadding="1" border="1">                    <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="80px" rowspan="2" align="center"><b>Name</b></th>                        <th width="65px" rowspan="2" align="center"><b>NRIC/FIN No.</b></th>                        <th width="32px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="38px" rowspan="2" align="center"><b>Cntry</b></th>                        <th width="55px" rowspan="2" align="center"><b>Class Start Date</b></th>                        <th width="55px" rowspan="2" align="center"><b>Assmnt. Dt.</b></th>                        <th width="20px" rowspan="2" align="center"><b>A/P</b></th>                        <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                        <th width="85px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>                    <tr>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array($days, $is_two_sessions, $i);                    $date_str = $date_check = $cur_date->format('d/m/y');                    if ($is_two_sessions) {                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                    } else {                        $date_str .= " (1) " . $class_schedule_data[$date_check][1];                    }                    $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                }                $tbl .= '</tr>';                $counter = 1;                $footer_text = array();                foreach ($results as $data) {                    $tbl .= '<tr><td align="center">' . $counter . '</td>';                    $name = (strlen($data['record']['name']) > 40) ? substr($data['record']['name'], 0, 37) . '...' : $data['record']['name'];                    $tbl .= '<td align="center" style="height:51px;">' . $name . '</td>';                    if ($tenant->tenant_id == 'T02' || $tenant->tenant_id == 'T12') {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    } else {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    }                    $data['record']['company_id'] = ($data['record']['company_id'] == 0) ? '' : $data['record']['company_id'];                    $tbl .= '<td align="center">' . $data['record']['company_id'] . '</td>';                    if (!empty($data['record']['company_id'])) {                        if ($data['record']['company_id'][0] == 'T') {                            $footer_text[$data['record']['company_id']] = $tenant->tenant_name;                        } else {                            $footer_text[$data['record']['company_id']] = $data['record']['company_name'];                        }                    }                    $tbl .= '<td align="center">' . $data['record']['nationality'] . '</td>';                    $assmnt_date = $ci->traineemodel->get_assessment_date($data['record']['class_id'], $data['record']['user_id']);                    $formatd_assmnt_date = empty($assmnt_date) ? '' : date('d/m/Y', strtotime($assmnt_date));                    $tbl .= '<td align="center">' . date('d/m/Y', strtotime($class_details->class_start_datetime)) . '</td>';                    $tbl .= '<td align="center">' . $formatd_assmnt_date . '</td>';                    if ($data['record']['att'] == 1) {                        $att = "P";                    } else {                        $att = "A";                    }                    $tbl .= '<td align="center">    ' . $att . '    </td>';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $tbl .= '<td></td>';                    }                    $tbl .= '<td></td></tr>';                    $counter++;                }                $class_total_users = $counter - 1;                $tbl .= '<tr><td colspan="6"></td><td>Absent</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Present</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Total</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td align="center">' . $class_total_users . '</td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr></table>';                $footer_data = '';                foreach ($footer_text as $k => $v) {                    $footer_data .= '<div>** ' . $k . ' - ' . $v . '</div>';                }                $tbl .= $foot_tbl = '<br><br><table width="50%" border="0">        <tr><td width="40%">Name of Company:</td><td width="60%">' . $class_details->company_name . '</td></tr>        <tr><td>Full Name & Designation of Director:</td><td>' . ucfirst($tenant->director_name) . '</td></tr>        </table>        <p><i>' . $statment . '</i></p>        <p style="color:red;"><i>This is a computer generated form. No signature is required - ' . $tenant->tenant_name . ' Administrator.</i></p>        ';                $pdf->writeHTML($tbl . $footer_data, true, false, false, false, '');            }            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->writeHTML($top_tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $pdf->writeHTML($details, true, false, false, false, '');                $date_columns_count = $class_details->class_session_day * count($days);                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                $tbl = '<table cellspacing="0" cellpadding="1" border="1">            <tr>                <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                <th width="180px" rowspan="2" align="center"><b>Name</b></th>                <th width="65px" rowspan="2" align="center"><b>NRIC/FIN No.</b></th>                <th width="32px" rowspan="2" align="center"><b>Comp Id</b></th>                <th width="38px" rowspan="2" align="center"><b>Cntry</b></th>                <th width="55px" rowspan="2" align="center"><b>Class Start Date</b></th>                <th width="55px" rowspan="2" align="center"><b>Assmnt. Dt.</b></th>                <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                <th width="55px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>            </tr>            <tr>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array($days, $is_two_sessions, $i);                    $date_str = $date_check = $cur_date->format('d/m/y');                    if ($is_two_sessions) {                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                    } else {                        $date_str .= " (1) " . $class_schedule_data[$date_check][1];                    }                    $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                }                $tbl .= '</tr>';                for ($f = 0; $f < 12; $f++) {                    $tbl .= '<tr><td align="center">' . ($counter + $f) . '</td>';                    $tbl .= '<td align="center" style="height:51px;"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $extra_td = '';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $extra_td .= '<td></td>';                    }                    $tbl .=$extra_td;                    $tbl .= '<td></td></tr>';                }                $tbl .= '<tr><td colspan="6"></td><td>Absent<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Present<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Total<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                $tbl .=$extra_td;                $tbl .= '</tr></table>';                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->writeHTML($foot_tbl, true, false, false, false, '');            }            $pdf->Output('attendance_sheet.pdf', 'D');        }    }}function generate_class_attendance_sheet_pdf_xp($results, $class_details, $tenant, $class_schedule_data) {    $statment = 'I understand that the training provider will not be held responsible to resubmit the results should the Name and ID number was found incorrect after the course date.';    $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);    $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);    $interval = date_diff($start_date, $end_date);    $total_days = $interval->format('%a');    $className = $class_details->class_name;    if ((strpos($className, 'RFHC') !== false) && (($tenant->tenant_id == 'T02') || ($tenant->tenant_id == 'T12'))) {// else condition is at line no 1202 added by shubhranshu for refresher one session        if (count($class_schedule_data) > 0 or $total_days == 0) { // else condition is at line no 924            $ci = & get_instance();            $ci->load->library('TMS_TCPDF');            $ci->load->helper('common');            $ci->load->model('meta_values', 'meta');            $ci->load->model('trainee_model', 'traineemodel');            $meta_map = $ci->meta->get_param_map();            $orientation = $ci->input->post('orientation');            if ($orientation == 'P') {                $width1 = 330;                $width2 = 310;            } else {                $width1 = 500;                $width2 = 500;            }            $pdf = new TCPDF($orientation, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);            $pdf->SetPrintHeader(false);            $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));            $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));            $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);            $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);            $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);            $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);            $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);            $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);            $className = $class_details->class_name;            $courseName = $class_details->crse_name;            $class_start_date_formatted = date_format_singapore($class_details->class_start_datetime) . " " . time_format_singapore($class_details->class_start_datetime);            $class_end_date_formatted = date_format_singapore($class_details->class_end_datetime) . " " . time_format_singapore($class_details->class_end_datetime);            $is_two_sessions = $class_details->class_session_day == 2;            $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);            $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);            if (empty($start_date))                $start_date = new DateTime();            if (empty($end_date))                $end_date = clone $start_date;            $interval = date_diff($start_date, $end_date);            $total_days = $interval->format('%a');            $weeks = create_week_days_array($start_date, $end_date, $class_schedule_data);            //echo "<pre>"; print_r($weeks); die;            foreach ($weeks as $days) {                //print_r($days);                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "  Attendance List", 15, 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 9);                $tbl = '<br><br><table cellspacing="0" cellpadding="0">                <tr>                    <td >                       <table>                            <tr><td width="25%">Course Title:</td><td width="75%">' . $courseName . '</td></tr>                            <tr><td>Name of Training:</td><td>' . $className . '</td></tr>                            <tr><td>Training Duration:</td><td>' . $class_start_date_formatted . ' To ' . $class_end_date_formatted . '</td></tr>                            <tr><td>Trainer:</td><td>' . $class_details->classroom_trainer . '</td></tr>                            <tr><td>Assessor:</td><td>' . $class_details->assessor . '</td></tr>                            <tr><td>Company:</td><td>' . $class_details->company_name . '</td></tr>                            <tr><td>Class ID:</td><td>' . $class_details->class_id . '</td></tr>                            <tr><td>Training Hrs:</td><td>' . ($class_details->total_classroom_duration + $class_details->total_lab_duration) . '</td></tr>                            <tr><td> Assessment Hrs:</td><td>' . $class_details->assmnt_duration . '</td></tr>                        </table>                    </td>                    <td align="right">                        <table>                            <tr> <td align="right">' . $tenant->tenant_name . '</td> </tr>                            <tr><td align="right">' . $tenant->tenant_address . '<br>'                        . $tenant->tenant_country . '</td>                            </tr>                                                        <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';                $top_tbl = $tbl;                $pdf->writeHTML($tbl, true, false, false, false, '');                $day_schudle = $days;                $schudule_counts = array();                foreach ($day_schudle as $dayschedule) {                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][1])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][1];                    }                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][2])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][2];                    }                }                $schudule_counts = sizeof($schudule_counts);                if ($total_days != 0)                    $date_columns_count = $schudule_counts;                else                    $date_columns_count = 2;                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                                    $tbl = '<table cellspacing="0" cellpadding="1" border="1">                    <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="275px" rowspan="2" align="center"><b>Name</b></th>                        <th width="67px" rowspan="2" align="center"><b>NRIC</b></th>                        <th width="38px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="55px" rowspan="2" align="center"><b>Country</b></th>                        <th width="65px" rowspan="2" align="center"><b>Course Date</b></th>                        <th width="65px" rowspan="2" align="center"><b>Assessment. Date</b></th>                        <!--<th width="25px" rowspan="2" align="center"><b>A/P</b></th>-->                        <th colspan="" width="300px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                         <th width="110px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>                    <tr>';                                                $date_str .= $start_date->format('d/m/y') . '(1)';                $tbl .= '<td width="300px" align="center">' . $date_str . '</td>';                                 $tbl .= '</tr>';                $counter = 1;                $footer_text = array();                foreach ($results as $data) {                    $tbl .= '<tr nobr="true"><td align="center">' . $counter . '</td>';                    $name = (strlen($data['record']['name']) > 40) ? substr($data['record']['name'], 0, 37) . '...' : $data['record']['name'];                    $tbl .= '<td align="center" style="height:51px;">' . $name . '</td>';                    if ($tenant->tenant_id == 'T02' || $tenant->tenant_id == 'T12') {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    } else {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    }                    $data['record']['company_id'] = ($data['record']['company_id'] == 0) ? '' : $data['record']['company_id'];                    $tbl .= '<td align="center">' . $data['record']['company_id'] . '</td>';                    if (!empty($data['record']['company_id'])) {                        if ($data['record']['company_id'][0] == 'T') {                            $footer_text[$data['record']['company_id']] = $tenant->tenant_name;                        } else {                            $footer_text[$data['record']['company_id']] = $data['record']['company_name'];                        }                    }                    $tbl .= '<td align="center">' . $data['record']['nationality'] . '</td>';                    $assmnt_date = $ci->traineemodel->get_assessment_date($data['record']['class_id'], $data['record']['user_id']);                    $formatd_assmnt_date = empty($assmnt_date) ? '' : date('d/m/Y', strtotime($assmnt_date));                    $tbl .= '<td align="center">' . date('d/m/Y', strtotime($class_details->class_start_datetime)) . '</td>';                    $tbl .= '<td align="center">' . $formatd_assmnt_date . '</td>';                    if ($data['record']['att'] == 1) {                        $att = "P";                    } else {                        $att = "A";                    }                    //$tbl .= '<td align="center">    ' . $att . '    </td>';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $tbl .= '<td></td>';                    }                    $tbl .= '</tr>';                    $counter++;                }                //exit;                $date_columns_count = $date_columns_count;                $class_total_users = $counter - 1;                $tbl .= '<tr><td colspan="6"></td><td>Absent</td>';                for ($i = 0; $i < $date_columns_count-1; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Present</td>';                for ($i = 0; $i < $date_columns_count-1; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Total</td>';                for ($i = 0; $i < $date_columns_count-1; $i++) {                    $tbl .= '<td align="center">' . $class_total_users . '</td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                for ($i = 0; $i < $date_columns_count-1; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '<td></td></tr></table>';                $footer_data = '';                foreach ($footer_text as $k => $v) {                    $footer_data .= '<div>** ' . $k . ' - ' . $v . '</div>';                }                $tbl .= $foot_tbl = '<br><br><table width="50%" border="0">        <tr><td width="40%">Name of Company:</td><td width="60%">' . $class_details->company_name . '</td></tr>        <tr><td>Full Name & Designation of Director:</td><td>' . ucfirst($tenant->director_name) . '</td></tr>        </table>        <p><i>' . $statment . '</i></p>        <p style="color:red;"><i>This is a computer generated form. No signature is required - ' . $tenant->tenant_name . ' Administrator.</i></p>        ';                $pdf->writeHTML($tbl . $footer_data, true, false, false, false, '');            }            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->writeHTML($top_tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $pdf->writeHTML($details, true, false, false, false, '');                // $date_columns_count = $class_details->class_session_day * count($days);                $day_schudle = $days;                $schudule_counts = array();                foreach ($day_schudle as $dayschedule) {                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][1])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][1];                    }                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][2])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][2];                    }                }                $schudule_counts = sizeof($schudule_counts);                if ($total_days != 0)                    $date_columns_count = $schudule_counts;                else                    $date_columns_count = 2;                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                                    $tbl = '<table cellspacing="0" cellpadding="1" border="1">                    <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="275px" rowspan="2" align="center"><b>Name</b></th>                        <th width="65px" rowspan="2" align="center"><b>NRIC</b></th>                        <th width="38px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="35px" rowspan="2" align="center"><b>Country</b></th>                        <th width="65px" rowspan="2" align="center"><b>Course Date</b></th>                        <th width="65px" rowspan="2" align="center"><b>Assessment Date</b></th>                        <!--<th width="25px" rowspan="2" align="center"><b>A/P</b></th>-->                        <th colspan="" width="300px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                         <th width="110px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>                <tr>';                                                $tbl .= '<td width="300px" align="center">' . $date_str . '</td>';                                 $tbl .= '</tr>';                for ($f = 0; $f < 12; $f++) {                    $tbl .= '<tr><td align="center">' . ($counter + $f) . '</td>';                    $tbl .= '<td align="center" style="height:51px;"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $extra_td = '';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $extra_td .= '<td></td>';                    }                    $tbl .=$extra_td;                    $tbl .= '<td></td></tr>';                }                $tbl .= '<tr><td colspan="6"></td><td>Absent<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Present<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Total<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                $tbl .=$extra_td;                $tbl .= '<td></td></tr></table>';                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->writeHTML($foot_tbl, true, false, false, false, '');            }            $pdf->Output('attendance_sheet.pdf', 'D');        } else {   // if condtion is on line no: 620            $ci = & get_instance();            $ci->load->library('TMS_TCPDF');            $ci->load->helper('common');            $ci->load->model('meta_values', 'meta');            $ci->load->model('trainee_model', 'traineemodel');            $meta_map = $ci->meta->get_param_map();            $orientation = $ci->input->post('orientation');            if ($orientation == 'P') {                $width1 = 330;                $width2 = 310;            } else {                /* previous code pdf width decide from here                  $width1=630;                  $width2=610 ;                 */                $width1 = 530;                $width2 = 510;            }            $pdf = new TCPDF($orientation, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);            $pdf->SetPrintHeader(false);            $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));            $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));            $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);            $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);            $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);            $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);            $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);            $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);            $className = $class_details->class_name;            $courseName = $class_details->crse_name;            $class_start_date_formatted = date_format_singapore($class_details->class_start_datetime) . " " . time_format_singapore($class_details->class_start_datetime);            $class_end_date_formatted = date_format_singapore($class_details->class_end_datetime) . " " . time_format_singapore($class_details->class_end_datetime);            $is_two_sessions = $class_details->class_session_day == 2;            $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);            $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);            if (empty($start_date))                $start_date = new DateTime();            if (empty($end_date))                $end_date = clone $start_date;            $weeks = create_week_days_array($start_date, $end_date);            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="75%">                        &nbsp;                    </td>                    <td width="25%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                        . $tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';                $top_tbl = $tbl;                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $details = '<br><br><br><table width="50%" border="0">            <tr><td width="25%">Course Title:</td><td width="75%"><u>' . $courseName . '</u></td></tr>            <tr><td>Name of Training:</td><td><u>' . $className . '</u></td></tr>            <tr><td>Training Duration:</td><td><u>' . $class_start_date_formatted . ' To ' . $class_end_date_formatted . '</u></td></tr>            <tr><td>Trainer:</td><td><u>' . $class_details->classroom_trainer . '</u></td></tr>            <tr><td>Assessor:</td><td><u>' . $class_details->assessor . '</u></td></tr>            <tr><td>Company:</td><td><u>' . $class_details->company_name . '</u></td></tr>            <tr><td>Class ID:</td><td><u>' . $class_details->class_id . '</u></td></tr>            <tr><td>Training Hrs:</td><td><u>' . ($class_details->total_classroom_duration + $class_details->total_lab_duration) . '</u></td></tr>            <tr><td> Assessment Hrs:</td><td><u>' . $class_details->assmnt_duration . '</u></td></tr>            </table>            <br>';                $pdf->writeHTML($details, true, false, false, false, '');                /*                  echo "date_columns_count";echo $date_columns_count = $class_details->class_session_day * count($days); echo "<br/>";                  echo "column_width"; echo $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count); echo "<br/>";                  echo "total_column_width";echo $total_column_width = $column_width * $date_columns_count;                  //exit();                 */                $date_columns_count = $class_details->class_session_day * count($days);                $column_width1 = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $column_width = ($column_width1 - 60);                $total_column_width = $column_width * $date_columns_count;//$total_column_width =($total_column_width1-20);                $tbl = '<table cellspacing="0" cellpadding="1" border="1">                    <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="80px" rowspan="2" align="center"><b>Name</b></th>                        <th width="65px" rowspan="2" align="center"><b>NRIC/FIN No.</b></th>                        <th width="32px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="38px" rowspan="2" align="center"><b>Cntry</b></th>                        <th width="55px" rowspan="2" align="center"><b>Class Start Date</b></th>                        <th width="55px" rowspan="2" align="center"><b>Assmnt. Dt.</b></th>                        <!--<th width="25px" rowspan="2" align="center"><b>A/P</b></th>-->                        <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                        <th width="85px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>                    <tr>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array($days, $is_two_sessions, $i);                    $date_str = $date_check = $cur_date->format('d/m/y');                    if ($is_two_sessions) {                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                    } else {                        $date_str .= " (1) " . $class_schedule_data[$date_check][1];                    }                    $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                }                $tbl .= '</tr>';                $counter = 1;                $footer_text = array();                foreach ($results as $data) {                    $tbl .= '<tr><td align="center">' . $counter . '</td>';                    $name = (strlen($data['record']['name']) > 40) ? substr($data['record']['name'], 0, 37) . '...' : $data['record']['name'];                    $tbl .= '<td align="center" style="height:51px;">' . $name . '</td>';                    if ($tenant->tenant_id == 'T02' || $tenant->tenant_id == 'T12') {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    } else {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    }                    $data['record']['company_id'] = ($data['record']['company_id'] == 0) ? '' : $data['record']['company_id'];                    $tbl .= '<td align="center">' . $data['record']['company_id'] . '</td>';                    if (!empty($data['record']['company_id'])) {                        if ($data['record']['company_id'][0] == 'T') {                            $footer_text[$data['record']['company_id']] = $tenant->tenant_name;                        } else {                            $footer_text[$data['record']['company_id']] = $data['record']['company_name'];                        }                    }                    $tbl .= '<td align="center">' . $data['record']['nationality'] . '</td>';                    $assmnt_date = $ci->traineemodel->get_assessment_date($data['record']['class_id'], $data['record']['user_id']);                    $formatd_assmnt_date = empty($assmnt_date) ? '' : date('d/m/Y', strtotime($assmnt_date));                    $tbl .= '<td align="center">' . date('d/m/Y', strtotime($class_details->class_start_datetime)) . '</td>';                    $tbl .= '<td align="center">' . $formatd_assmnt_date . '</td>';                    if ($data['record']['att'] == 1) {                        $att = "P";                    } else {                        $att = "A";                    }                    //$tbl .= '<td align="center">    ' . $att . '    </td>';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $tbl .= '<td></td>';                    }                    $tbl .= '<td></td></tr>';                    $counter++;                }                $class_total_users = $counter - 1;                $tbl .= '<tr><td colspan="6"></td><td>Absent</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Present</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Total</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td align="center">' . $class_total_users . '</td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                for ($i = 0; $i < $date_columns_count-1; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr></table>';                $footer_data = '';                foreach ($footer_text as $k => $v) {                    $footer_data .= '<div>** ' . $k . ' - ' . $v . '</div>';                }                $tbl .= $foot_tbl = '<br><br><table width="50%" border="0">        <tr><td width="40%">Name of Company:</td><td width="60%">' . $class_details->company_name . '</td></tr>        <tr><td>Full Name & Designation of Director:</td><td>' . ucfirst($tenant->director_name) . '</td></tr>        </table>        <p><i>' . $statment . '</i></p>        <p style="color:red;"><i>This is a computer generated form. No signature is required - ' . $tenant->tenant_name . ' Administrator.</i></p>        ';                $pdf->writeHTML($tbl . $footer_data, true, false, false, false, '');            }            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->writeHTML($top_tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $pdf->writeHTML($details, true, false, false, false, '');                $date_columns_count = $class_details->class_session_day * count($days);                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                $tbl = '<table cellspacing="0" cellpadding="1" border="1">            <tr>                <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                <th width="80px" rowspan="2" align="center"><b>Name</b></th>                <th width="65px" rowspan="2" align="center"><b>NRIC/FIN No.</b></th>                <th width="32px" rowspan="2" align="center"><b>Comp Id</b></th>                <th width="38px" rowspan="2" align="center"><b>Cntry</b></th>                <th width="55px" rowspan="2" align="center"><b>Class Start Date</b></th>                <th width="55px" rowspan="2" align="center"><b>Assmnt. Dt.</b></th>                <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                <th width="55px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>            </tr>            <tr>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array($days, $is_two_sessions, $i);                    $date_str = $date_check = $cur_date->format('d/m/y');                    if ($is_two_sessions) {                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                    } else {                        $date_str .= " (1) " . $class_schedule_data[$date_check][1];                    }                    $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                }                $tbl .= '</tr>';                for ($f = 0; $f < 12; $f++) {                    $tbl .= '<tr><td align="center">' . ($counter + $f) . '</td>';                    $tbl .= '<td align="center" style="height:51px;"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $extra_td = '';                    for ($i = 0; $i < $date_columns_count-1; $i++) {                        $extra_td .= '<td></td>';                    }                    $tbl .=$extra_td;                    $tbl .= '<td></td></tr>';                }                $tbl .= '<tr><td colspan="6"></td><td>Absent<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Present<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Total<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                $tbl .=$extra_td;                $tbl .= '</tr></table>';                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->writeHTML($foot_tbl, true, false, false, false, '');            }            $pdf->Output('attendance_sheet.pdf', 'D');        }    } else { // if conditioon is line no : 619        if (count($class_schedule_data) > 0 or $total_days == 0) { //else condition is at line 1553            $ci = & get_instance();            $ci->load->library('TMS_TCPDF');            $ci->load->helper('common');            $ci->load->model('meta_values', 'meta');            $ci->load->model('trainee_model', 'traineemodel');            $meta_map = $ci->meta->get_param_map();            $orientation = $ci->input->post('orientation');            if ($orientation == 'P') {                $width1 = 330;                $width2 = 310;            } else {                $width1 = 400;                $width2 = 400;            }            $pdf = new TCPDF($orientation, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);            $pdf->SetPrintHeader(false);            $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));            $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));            $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);            $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);            $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);            $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);            $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);            $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);            $className = $class_details->class_name;            $courseName = $class_details->crse_name;            $class_start_date_formatted = date_format_singapore($class_details->class_start_datetime) . " " . time_format_singapore($class_details->class_start_datetime);            $class_end_date_formatted = date_format_singapore($class_details->class_end_datetime) . " " . time_format_singapore($class_details->class_end_datetime);            $is_two_sessions = $class_details->class_session_day == 2;            $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);            $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);            if (empty($start_date))                $start_date = new DateTime();            if (empty($end_date))                $end_date = clone $start_date;            $interval = date_diff($start_date, $end_date);            $total_days = $interval->format('%a');            $weeks = create_week_days_array($start_date, $end_date, $class_schedule_data);            // echo "<pre>"; print_r($results); die;            foreach ($weeks as $days) {                //print_r($days);                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "  Attendance List", 15, 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 9);                $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td >                       <table>                            <tr><td width="25%">Course Title:</td><td width="75%">' . $courseName . '</td></tr>                            <tr><td>Name of Training:</td><td>' . $className . '</td></tr>                            <tr><td>Training Duration:</td><td>' . $class_start_date_formatted . ' To ' . $class_end_date_formatted . '</td></tr>                            <tr><td>Trainer:</td><td>' . $class_details->classroom_trainer . '</td></tr>                            <tr><td>Assessor:</td><td>' . $class_details->assessor . '</td></tr>                            <tr><td>Company:</td><td>' . $class_details->company_name . '</td></tr>                            <tr><td>Class ID:</td><td>' . $class_details->class_id . '</td></tr>                            <tr><td>Training Hrs:</td><td>' . ($class_details->total_classroom_duration + $class_details->total_lab_duration) . '</td></tr>                            <tr><td> Assessment Hrs:</td><td>' . $class_details->assmnt_duration . '</td></tr>                        </table>                    </td>                    <td align="right">                        <table>                            <tr> <td align="right">' . $tenant->tenant_name . '</td> </tr>                            <tr><td align="right">' . $tenant->tenant_address . '<br>'                        . $tenant->tenant_country . '</td>                            </tr>                                                        <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';                $top_tbl = $tbl;                $pdf->writeHTML($tbl, true, false, false, false, '');                $day_schudle = $days;                $schudule_counts = array();                foreach ($day_schudle as $dayschedule) {                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][1])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][1];                    }                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][2])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][2];                    }                }                $schudule_counts = sizeof($schudule_counts);                if ($total_days != 0)                    $date_columns_count = $schudule_counts;                else                    $date_columns_count = 2;                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                $tbl = '<table cellspacing="0" cellpadding="1" border="1">                    <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="175px" rowspan="2" align="center"><b>Name</b></th>                        <th width="68px" rowspan="2" align="center"><b>NRIC</b></th>                        <th width="38px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="30px" rowspan="2" align="center"><b>Country</b></th>                        <th width="65px" rowspan="2" align="center"><b>Course Date</b></th>                        <th width="65px" rowspan="2" align="center"><b>Assessment. Date</b></th>                        <!--<th width="25px" rowspan="2" align="center"><b>A/P</b></th>-->                        <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                         <th width="110px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>                    <tr>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array1($days, $class_schedule_data, $i);                    $explode_curdates = explode("-", $cur_date[$i]);                    $date_str = $date_check = $explode_curdates[0];                    $date_sessions = $explode_curdates[1];                    if (!empty($class_schedule_data[$date_check])) {                        if ($date_sessions == 'S1') {                            $date_str .= " (1) " . $class_schedule_data[$date_check][1];                        } else {                            $date_str .= " (2) " . $class_schedule_data[$date_check][2];                        }                        $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                    } elseif ($total_days == 0) {                        $date_str .= $start_date->format('d/m/y');                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                        $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                    }                    //echo '<pre>'; print_r($date_str);                }                $tbl .= '</tr>';                $counter = 1;                $footer_text = array();                foreach ($results as $data) {                    $tbl .= '<tr nobr="true"><td align="center">' . $counter . '</td>';                    $name = (strlen($data['record']['name']) > 40) ? substr($data['record']['name'], 0, 37) . '...' : $data['record']['name'];                    $tbl .= '<td align="center" style="height:51px;">' . $name . '</td>';                    if ($tenant->tenant_id == 'T02' || $tenant->tenant_id == 'T12') {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    } else {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    }                    $data['record']['company_id'] = ($data['record']['company_id'] == 0) ? '' : $data['record']['company_id'];                    $tbl .= '<td align="center">' . $data['record']['company_id'] . '</td>';                    if (!empty($data['record']['company_id'])) {                        if ($data['record']['company_id'][0] == 'T') {                            $footer_text[$data['record']['company_id']] = $tenant->tenant_name;                        } else {                            $footer_text[$data['record']['company_id']] = $data['record']['company_name'];                        }                    }                    $tbl .= '<td align="center">' . $data['record']['nationality'] . '</td>';                    $assmnt_date = $ci->traineemodel->get_assessment_date($data['record']['class_id'], $data['record']['user_id']);                    $formatd_assmnt_date = empty($assmnt_date) ? '' : date('d/m/Y', strtotime($assmnt_date));                    $tbl .= '<td align="center">' . date('d/m/Y', strtotime($class_details->class_start_datetime)) . '</td>';                    $tbl .= '<td align="center">' . $formatd_assmnt_date . '</td>';                    if ($data['record']['att'] == 1) {                        $att = "P";                    } else {                        $att = "A";                    }                    //$tbl .= '<td align="center">    ' . $att . '    </td>';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $tbl .= '<td></td>';                    }                    $tbl .= '<td></td></tr>';                    $counter++;                }                //exit;                $date_columns_count = $date_columns_count + 1;                $class_total_users = $counter - 1;                $tbl .= '<tr><td colspan="6"></td><td>Absent</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Present</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Total</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td align="center">' . $class_total_users . '</td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                for ($i = 0; $i < $date_columns_count - 1; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr></table>';                $footer_data = '';                foreach ($footer_text as $k => $v) {                    $footer_data .= '<div>** ' . $k . ' - ' . $v . '</div>';                }                $tbl .= $foot_tbl = '<br><br><table width="50%" border="0">        <tr><td width="40%">Name of Company:</td><td width="60%">' . $class_details->company_name . '</td></tr>        <tr><td>Full Name & Designation of Director:</td><td>' . ucfirst($tenant->director_name) . '</td></tr>        </table>        <p><i>' . $statment . '</i></p>        <p style="color:red;"><i>This is a computer generated form. No signature is required - ' . $tenant->tenant_name . ' Administrator.</i></p>        ';                $pdf->writeHTML($tbl . $footer_data, true, false, false, false, '');            }            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->writeHTML($top_tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $pdf->writeHTML($details, true, false, false, false, '');                // $date_columns_count = $class_details->class_session_day * count($days);                $day_schudle = $days;                $schudule_counts = array();                foreach ($day_schudle as $dayschedule) {                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][1])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][1];                    }                    if (!empty($class_schedule_data[$dayschedule->format('d/m/y')][2])) {                        $schudule_counts[] = $class_schedule_data[$dayschedule->format('d/m/y')][2];                    }                }                $schudule_counts = sizeof($schudule_counts);                if ($total_days != 0)                    $date_columns_count = $schudule_counts;                else                    $date_columns_count = 2;                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                $tbl = '<table cellspacing="0" cellpadding="1" border="1">             <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="175px" rowspan="2" align="center"><b>Name</b></th>                        <th width="65px" rowspan="2" align="center"><b>NRIC</b></th>                        <th width="38px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="55px" rowspan="2" align="center"><b>Country</b></th>                        <th width="55px" rowspan="2" align="center"><b>Course Date</b></th>                        <th width="75px" rowspan="2" align="center"><b>Assessment Date</b></th>                        <!--<th width="25px" rowspan="2" align="center"><b>A/P</b></th>-->                        <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                         <th width="110px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>            <tr>';                /*  for ($i = 0; $i < $date_columns_count; $i++) {                              $cur_date = get_date_from_week_array($days, $class_schedule_data, $i);                  $date_str = $date_check = $cur_date[$i];                  if(!empty($class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)]))                  {                  if ($is_two_sessions) {                  $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                  }else {                  $date_str .= " (1) " . $class_schedule_data[$date_check][1];                  }                  $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                  }                  elseif($total_days == 0)                  {                  $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                  $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                  }                  } */                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array1($days, $class_schedule_data, $i);                    $explode_curdates = explode("-", $cur_date[$i]);                    $date_str = $date_check = $explode_curdates[0];                    $date_sessions = $explode_curdates[1];                    if (!empty($class_schedule_data[$date_check])) {                        if ($date_sessions == 'S1') {                            $date_str .= " (1) " . $class_schedule_data[$date_check][1];                        } else {                            $date_str .= " (2) " . $class_schedule_data[$date_check][2];                        }                        $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                    } elseif ($total_days == 0) {                        $date_str .= $start_date->format('d/m/y');                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                        $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                    }                    //echo '<pre>'; print_r($date_str);                }                $tbl .= '</tr>';                for ($f = 0; $f < 12; $f++) {                    $tbl .= '<tr><td align="center">' . ($counter + $f) . '</td>';                    $tbl .= '<td align="center" style="height:51px;"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $extra_td = '';                    for ($i = 0; $i < $date_columns_count-1; $i++) {                        $extra_td .= '<td></td>';                    }                    $tbl .=$extra_td;                    $tbl .= '<td></td><td></td></tr>';                }                $tbl .= '<tr><td colspan="6"></td><td>Absent<br/></td><td></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Present<br/></td><td></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Total<br/></td><td></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td><td></td><td></td>';                $tbl .=$extra_td;                $tbl .= '</tr></table>';                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->writeHTML($foot_tbl, true, false, false, false, '');            }            $pdf->Output('attendance_sheet.pdf', 'D');        } else {   // if condtion is on line no: 619            $ci = & get_instance();            $ci->load->library('TMS_TCPDF');            $ci->load->helper('common');            $ci->load->model('meta_values', 'meta');            $ci->load->model('trainee_model', 'traineemodel');            $meta_map = $ci->meta->get_param_map();            $orientation = $ci->input->post('orientation');            if ($orientation == 'P') {                $width1 = 330;                $width2 = 310;            } else {                /* previous code pdf width decide from here                  $width1=630;                  $width2=610 ;                 */                $width1 = 430;                $width2 = 410;            }            $pdf = new TCPDF($orientation, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);            $pdf->SetPrintHeader(false);            $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));            $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));            $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);            $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);            $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);            $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);            $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);            $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);            $className = $class_details->class_name;            $courseName = $class_details->crse_name;            $class_start_date_formatted = date_format_singapore($class_details->class_start_datetime) . " " . time_format_singapore($class_details->class_start_datetime);            $class_end_date_formatted = date_format_singapore($class_details->class_end_datetime) . " " . time_format_singapore($class_details->class_end_datetime);            $is_two_sessions = $class_details->class_session_day == 2;            $start_date = parse_date($class_details->class_start_datetime, SERVER_DATE_TIME_FORMAT);            $end_date = parse_date($class_details->class_end_datetime, SERVER_DATE_TIME_FORMAT);            if (empty($start_date))                $start_date = new DateTime();            if (empty($end_date))                $end_date = clone $start_date;            $weeks = create_week_days_array($start_date, $end_date);            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="75%">                        &nbsp;                    </td>                    <td width="25%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                        . $tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';                $top_tbl = $tbl;                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $details = '<br><br><br><table width="50%" border="0">            <tr><td width="25%">Course Title:</td><td width="75%"><u>' . $courseName . '</u></td></tr>            <tr><td>Name of Training:</td><td><u>' . $className . '</u></td></tr>            <tr><td>Training Duration:</td><td><u>' . $class_start_date_formatted . ' To ' . $class_end_date_formatted . '</u></td></tr>            <tr><td>Trainer:</td><td><u>' . $class_details->classroom_trainer . '</u></td></tr>            <tr><td>Assessor:</td><td><u>' . $class_details->assessor . '</u></td></tr>            <tr><td>Company:</td><td><u>' . $class_details->company_name . '</u></td></tr>            <tr><td>Class ID:</td><td><u>' . $class_details->class_id . '</u></td></tr>            <tr><td>Training Hrs:</td><td><u>' . ($class_details->total_classroom_duration + $class_details->total_lab_duration) . '</u></td></tr>            <tr><td> Assessment Hrs:</td><td><u>' . $class_details->assmnt_duration . '</u></td></tr>            </table>            <br>';                $pdf->writeHTML($details, true, false, false, false, '');                /*                  echo "date_columns_count";echo $date_columns_count = $class_details->class_session_day * count($days); echo "<br/>";                  echo "column_width"; echo $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count); echo "<br/>";                  echo "total_column_width";echo $total_column_width = $column_width * $date_columns_count;                  //exit();                 */                $date_columns_count = $class_details->class_session_day * count($days);                $column_width1 = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $column_width = ($column_width1 - 60);                $total_column_width = $column_width * $date_columns_count;//$total_column_width =($total_column_width1-20);                $tbl = '<table cellspacing="0" cellpadding="1" border="1">                    <tr>                        <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                        <th width="80px" rowspan="2" align="center"><b>Name</b></th>                        <th width="65px" rowspan="2" align="center"><b>NRIC/FIN No.</b></th>                        <th width="32px" rowspan="2" align="center"><b>Comp Id</b></th>                        <th width="38px" rowspan="2" align="center"><b>Cntry</b></th>                        <th width="55px" rowspan="2" align="center"><b>Class Start Date</b></th>                        <th width="55px" rowspan="2" align="center"><b>Assmnt. Dt.</b></th>                        <!--<th width="25px" rowspan="2" align="center"><b>A/P</b></th>-->                        <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                        <th width="85px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>                    </tr>                    <tr>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array($days, $is_two_sessions, $i);                    $date_str = $date_check = $cur_date->format('d/m/y');                    if ($is_two_sessions) {                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                    } else {                        $date_str .= " (1) " . $class_schedule_data[$date_check][1];                    }                    $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                }                $tbl .= '</tr>';                $counter = 1;                $footer_text = array();                foreach ($results as $data) {                    $tbl .= '<tr><td align="center">' . $counter . '</td>';                    $name = (strlen($data['record']['name']) > 40) ? substr($data['record']['name'], 0, 37) . '...' : $data['record']['name'];                    $tbl .= '<td align="center" style="height:51px;">' . $name . '</td>';                    if ($tenant->tenant_id == 'T02' || $tenant->tenant_id == 'T12') {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    } else {                        $tbl .= '<td align="center">' . mask_format($data['record']['tax_code']) . '</td>';                    }                    $data['record']['company_id'] = ($data['record']['company_id'] == 0) ? '' : $data['record']['company_id'];                    $tbl .= '<td align="center">' . $data['record']['company_id'] . '</td>';                    if (!empty($data['record']['company_id'])) {                        if ($data['record']['company_id'][0] == 'T') {                            $footer_text[$data['record']['company_id']] = $tenant->tenant_name;                        } else {                            $footer_text[$data['record']['company_id']] = $data['record']['company_name'];                        }                    }                    $tbl .= '<td align="center">' . $data['record']['nationality'] . '</td>';                    $assmnt_date = $ci->traineemodel->get_assessment_date($data['record']['class_id'], $data['record']['user_id']);                    $formatd_assmnt_date = empty($assmnt_date) ? '' : date('d/m/Y', strtotime($assmnt_date));                    $tbl .= '<td align="center">' . date('d/m/Y', strtotime($class_details->class_start_datetime)) . '</td>';                    $tbl .= '<td align="center">' . $formatd_assmnt_date . '</td>';                    if ($data['record']['att'] == 1) {                        $att = "P";                    } else {                        $att = "A";                    }                    //$tbl .= '<td align="center">    ' . $att . '    </td>';                    for ($i = 0; $i < $date_columns_count; $i++) {                        $tbl .= '<td></td>';                    }                    $tbl .= '<td></td></tr>';                    $counter++;                }                $class_total_users = $counter - 1;                $tbl .= '<tr><td colspan="6"></td><td>Absent</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Present</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Total</td>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $tbl .= '<td align="center">' . $class_total_users . '</td>';                }                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                for ($i = 0; $i < $date_columns_count-1; $i++) {                    $tbl .= '<td></td>';                }                $tbl .= '</tr></table>';                $footer_data = '';                foreach ($footer_text as $k => $v) {                    $footer_data .= '<div>** ' . $k . ' - ' . $v . '</div>';                }                $tbl .= $foot_tbl = '<br><br><table width="50%" border="0">        <tr><td width="40%">Name of Company:</td><td width="60%">' . $class_details->company_name . '</td></tr>        <tr><td>Full Name & Designation of Director:</td><td>' . ucfirst($tenant->director_name) . '</td></tr>        </table>        <p><i>' . $statment . '</i></p>        <p style="color:red;"><i>This is a computer generated form. No signature is required - ' . $tenant->tenant_name . ' Administrator.</i></p>        ';                $pdf->writeHTML($tbl . $footer_data, true, false, false, false, '');            }            foreach ($weeks as $days) {                $pdf->AddPage();                $pdf->SetFont('helvetica', '', 9);                $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);                $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);                $pdf->writeHTML($top_tbl, true, false, false, false, '');                $pdf->SetFont('helvetica', 'B', 12);                $pdf->Write(0, "Attendance List", '', 0, 'L', true, 0, false, false, 0);                $pdf->SetFont('helvetica', '', 8);                $pdf->writeHTML($details, true, false, false, false, '');                $date_columns_count = $class_details->class_session_day * count($days);                $column_width = $is_two_sessions ? $width1 / ($date_columns_count) : $width2 / ($date_columns_count);                $total_column_width = $column_width * $date_columns_count;                $tbl = '<table cellspacing="0" cellpadding="1" border="1">            <tr>                <th width="17px" rowspan="2" align="center"><b>S/N</b></th>                <th width="180px" rowspan="2" align="center"><b>Name</b></th>                <th width="65px" rowspan="2" align="center"><b>NRIC/FIN No.</b></th>                <th width="32px" rowspan="2" align="center"><b>Comp Id</b></th>                <th width="38px" rowspan="2" align="center"><b>Cntry</b></th>                <th width="55px" rowspan="2" align="center"><b>Class Start Date</b></th>                <th width="55px" rowspan="2" align="center"><b>Assmnt. Dt.</b></th>                <th colspan="' . $date_columns_count . '" width="' . $total_column_width . 'px" align="center"><b>Trainees\' Attendance Sign-in</b></th>                <th width="55px" rowspan="2" align="center"><b>Assmnt. Sign.</b></th>            </tr>            <tr>';                for ($i = 0; $i < $date_columns_count; $i++) {                    $cur_date = get_date_from_week_array($days, $is_two_sessions, $i);                    $date_str = $date_check = $cur_date->format('d/m/y');                    if ($is_two_sessions) {                        $date_str .= " (" . ($i % 2 == 0 ? 1 : 2) . ") " . $class_schedule_data[$date_check][($i % 2 == 0 ? 1 : 2)];                    } else {                        $date_str .= " (1) " . $class_schedule_data[$date_check][1];                    }                    $tbl .= '<td width="' . $column_width . 'px" align="center">' . $date_str . '</td>';                }                $tbl .= '</tr>';                for ($f = 0; $f < 12; $f++) {                    $tbl .= '<tr><td align="center">' . ($counter + $f) . '</td>';                    $tbl .= '<td align="center" style="height:51px;"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $tbl .= '<td align="center"></td>';                    $extra_td = '';                    for ($i = 0; $i < $date_columns_count-1; $i++) {                        $extra_td .= '<td></td>';                    }                    $tbl .=$extra_td;                    $tbl .= '<td></td></tr>';                }                $tbl .= '<tr><td colspan="6"></td><td>Absent<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Present<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Total<br/></td>';                $tbl .=$extra_td;                $tbl .= '</tr><tr><td colspan="6"></td><td>Trainer<br>Sign-in</td>';                $tbl .=$extra_td;                $tbl .= '</tr></table>';                $pdf->writeHTML($tbl, true, false, false, false, '');                $pdf->writeHTML($foot_tbl, true, false, false, false, '');            }            $pdf->Output('attendance_sheet.pdf', 'D');        }    }}function generate_report_enrol_pdf($results, $sales_details, $tenant) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->helper('common');    $ci->load->model('meta_values', 'meta');    $meta_map = $ci->meta->get_param_map();    $start_date = $ci->input->post('from_date');    $end_date = $ci->input->post('to_date');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="75%">                        &nbsp;                    </td>                    <td width="25%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                     . $tenant->tenant_country .  '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Enrollment Report for Sales Executive \'' . $sales_details->first_name . ' ' . $sales_details->last_name .            ' (' . $sales_details->tax_code . ')\'';    if (empty($start_date) && empty($end_date)) {        $info .= ' for ' . date('F d Y, l');    } else {        $info .= 'for the period';        if (!empty($start_date))            $info .= ' from ' . date('F d Y', DateTime::createFromFormat('d/m/Y', $start_date)->getTimestamp());        if (!empty($end_date))            $info .= ' to ' . date('F d Y', DateTime::createFromFormat('d/m/Y', $end_date)->getTimestamp());    }    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $info = 'Contact Detail:' . $sales_details->contact_number . ', ' . $sales_details->off_email_id;    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Course Name</b></th>            <th width="100px" align="center"><b>Class Name</b></th>            <th width="55px" align="center"><b>NRIC/FIN No.</b></th>            <th align="center"><b>Trainee Name</b></th>            <th width="65px" align="center"><b>Enrollment Date</b></th>            <th width="45px" align="center"><b>Country</b></th>            <th width="150px" align="center"><b>Trainee Contact Details</b></th>        </tr>';    if (empty($results)) {        $tbl .= '<tr><td colspan="7" align="center">There are enrollments done during this period by the sales executive</td></tr>';    } else {        foreach ($results as $data) {            $tbl .= '<tr>';            $tbl .= '<td>' . $data['crse_name'] . '</td>';            $tbl .= '<td>' . $data['class_name'] . '</td>';            $tbl .= '<td>' . mask_format($data['tax_code']) . '</td>';            $tbl .= '<td>' . $data['name'] . '</td>';            $tbl .= '<td>' . $data['enrolment_date'] . '</td>';            $tbl .= '<td>' . $meta_map[$data['country']] . '</td>';            $tbl .= '<td>' . rtrim($data['contact'], ', ') . '</td>';            $tbl .= '</tr>';        }    }    $tbl .= '</table>';    $pdf->writeHTML($tbl, TRUE, FALSE, FALSE, FALSE, '');    $tbl = '<p style="color:red;"><i>This is a computer generated Enrollment report. No signature is required - ' . $tenant->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('enrollment_report.pdf', 'D');}function create_week_days_array($start_date, $end_date, $class_schedule_data=null) {    $weeks = array();    $days = array();    $current_date = clone $start_date;    do {        if(count($class_schedule_data)>0)        {            //echo "scheduled";            if($class_schedule_data[$current_date->format('d/m/y')][1] || $class_schedule_data[$current_date->format('d/m/y')][2])            {                    $days[] = clone $current_date;             }            elseif($start_date == $end_date)            {               $days[] = clone $current_date;             }            if ($current_date->format('N') == 7 || compare_dates_without_time($current_date, $end_date)) { //sunday                               $weeks[] = $days;                $days = array();            }            $current_date->add(new DateInterval('P1D'));         }            else{             //echo "not scheduled";                $days[] = clone $current_date;                if ($current_date->format('N') == 7 || compare_dates_without_time($current_date, $end_date)) { //sunday                    $weeks[] = $days;                    $days = array();                }                $current_date->add(new DateInterval('P1D'));            }               } while ($current_date->format('Y-m-d') <= $end_date->format('Y-m-d'));    return $weeks;}function get_date_from_week_array1($array, $class_schedule_data, $i) {    $arrays = array();       foreach($array as $dayschedule)       {           if(!empty($class_schedule_data[$dayschedule->format('d/m/y')][1]))           {               $arrays[] = $dayschedule->format('d/m/y')."-S1";           }           if(!empty($class_schedule_data[$dayschedule->format('d/m/y')][2]))           {               $arrays[] = $dayschedule->format('d/m/y')."-S2";           }       }            return $arrays;}   function get_date_from_week_array($array, $is_two_sessions, $i) {    if ($is_two_sessions) {        if ($i % 2 == 1) {            $index = intval(($i - 1) / 2);        } else {            $index = intval($i / 2);        }    } else {        $index = $i;    }    return $array[$index];}/** * function to create PDF for enrollment payment report  */function generate_enrollment_reports_pdf($heading, $result, $tenant) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                    . $tenant->tenant_country .  '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = $heading;    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Sl #</b></th>            <th align="center"><b>Course Name</b></th>            <th align="center"><b>Class Name</b></th>            <th align="center"><b>NRIC/FIN No.</b></th>            <th align="center"><b>Trainee Name</b></th>            <th align="center"><b>Enrollment Date</b></th>            <th align="center"><b>Nationality</b></th>            <th align="center"><b>Trainee Contact Details</b></th>        </tr>';    $i = 1;    foreach ($result as $k => $v) {        $tbl .= '<tr>                    <td align="center">' . $i . '</td>                    <td align="center">' . $v['crse_name'] . '</td>                    <td align="center">' . $v['class_name'] . '</td>                    <td align="center">' . mask_format($v['tax_code']) . '</td>                    <td align="center">' . $v['name'] . '</td>                    <td align="center">' . $v['enrolment_date'] . '</td>                    <td align="center">' . $v['country'] . '</td>                    <td align="center">' . $v['contact'] . '</td>                </tr>';        $i++;    }    $tbl .= '</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<p style="color:red;"><i>This is a computer generated enrollment report. No signature is required - ' . $invoice->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('Enrollment_Report.pdf', 'D');}/** * function to create PDF for credits notes */function pdf_credit_note($result, $tenant) {       $ci = & get_instance();    $ci->load->library('TMS_TCPDF');        $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                    . $tenant->tenant_country .  '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Credit Note List as on '.date('M j Y, l');    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Sl #</b></th>            <th align="center"><b>Credit Note Number</b></th>            <th align="center"><b>Credit Note Date</b></th>            <th align="center"><b>Ori. Invoice Number</b></th>            <th align="center"><b>Ori. Invoice Date</b></th>            <th align="center"><b>Amount</b></th>            <th align="center"><b>Credit Note Issued By</b></th>            <th align="center"><b>Credit Note Issue Reason</b></th>            <th align="center"><b>Tg.Ref Number</b></th>        </tr>';    $i = 1;    foreach ($result as  $v) {               $tbl .= '<tr>                    <td align="center">' . $i . '</td>                    <td align="center">' . $v->credit_note_number. '</td>                    <td align="center">' . $v->credit_note_date . '</td>                    <td align="center">' . $v->ori_invoice_number . '</td>                    <td align="center">' . $v->ori_invoice_date . '</td>                    <td align="center">' . $v->credit_note_amount. '</td>                    <td align="center">' . $v->credit_note_issued_by. '</td>                    <td align="center">' . $v->credit_note_issue_reason . '</td>                        <td align="center">' . $v->tg_ref_number. '</td>                </tr>';        $i++;    }    $tbl .= '</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<p style="color:red;"><i>This is a computer generated enrollment report. No signature is required - ' . $invoice->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('Credit_notes.pdf', 'D');}/** * function to create PDF for payment received in booked seats */function generate_report_payment_received($result) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = 'Payment Received Details from ' . $result['first_name'] . ' ' . $result['last_name'] . ' for ' . $result['class_name'];    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <td align="center"><b>Payment Made On</b></td>            <td align="center"><b>' . $result['recd_on'] . '</b></td>        </tr>        <tr>            <td align="center"><b>Mode of Payment</b></td>            <td align="center"><b>' . $result['mode_of_pymnt'] . '</b></td>        </tr>        <tr>            <td align="center"><b>Class Fees</b></td>            <td align="center"><b>$ ' . $result['class_fees'] . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>Class Discount @ ' . $result['class_discount'] . '%</b></td>            <td align="center"><b>$ ' . $result['total_inv_discnt'] . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>Subsidy</b></td>            <td align="center"><b>$ ' . $result['total_inv_subsdy'] . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>Amount Due</b></td>            <td align="center"><b>$ ' . $result['total_inv_amount'] . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>GST @ ' . $result['gst_rate'] . '%</b></td>            <td align="center"><b>$ ' . $result['total_gst'] . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>Net Due</b></td>            <td align="center"><b>$ ' . $result['amount_recd'] . ' SGD</b></td>        </tr>        </table>        ';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('payment_received.pdf', 'D');}/** * function to create PDF for Sales payment received */function generate_sales_payment_received($result, $sales_name, $invoice) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="75%">                        &nbsp;                    </td>                    <td width="25%" align="right">                        <table>                        <tr>                            <td>' .            $pdf->Image(FCPATH . 'logos/' . $invoice->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false)            . '</td>                        </tr>                            <tr>                                <td>' . $invoice->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $invoice->tenant_address . '<br>' .                            $invoice->tenant_country .'</td>                            </tr>                            <tr>                                <td>Tel :' . $invoice->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $invoice->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Commission Paid Details for \'' . $sales_name . '\' as on ' . date('d M, Y');    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Course</b></th>            <th align="center"><b>Due Month</b></th>            <th align="center"><b>Paid on</b></th>            <th align="center"><b>Mode</b></th>            <th align="center"><b>Amount Paid</b></th>        </tr>';    if (!empty($result)) {        $total_paid = 0;        $year_arr = array(1 => 'January', 2 => 'February', 3 => 'March', 4 => 'April',            5 => 'May', 6 => 'June', 7 => 'July', 8 => 'August', 9 => 'September',            10 => 'October', 11 => 'November', 12 => 'December');        foreach ($result as $k => $v) {            $cheque_details = ($v->mode_of_payment == 'CHQ') ? 'Chq:' . $v->cheque_number . ', Chq Dt:' . date('d/m/Y', strtotime($v->cheque_date)) : '';            $mode = ($v->category_name == 'Cash') ? $v->category_name : '';            $tbl .= '<tr>                        <td align="center"><b>' . $v->course . '</b></td>                        <td align="center"><b>' . $year_arr[$v->comm_period_mth] . ' ' . $v->comm_period_yr . '</b></td>                        <td align="center"><b>' . date('d/m/Y', strtotime($v->paid_on)) . '</b></td>                        <td align="center"><b>' . $mode . ' ' . $cheque_details . '</b></td>                        <td align="center"><b>$' . number_format($v->amount_paid, 2, '.', '') . ' SGD</b></td>                    </tr>';            $total_paid +=$v->amount_paid;        }        $tbl .='<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td align="right"><b>Total:</b></td><td align="center"><b>$ ' . number_format($total_paid, 2, '.', '') . ' SGD</b></td></tr>';    }    $tbl .='</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<p style="color:red;"><i>This is a computer generated sales commission report. No signature is required - ' . $invoice->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('sales_commission.pdf', 'D');}/** * function to create PDF for class */function generate_class($data, $def_assessment) {    $invoice = $data['tenant_details'];    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $session = ($data['class']->class_session_day == 1) ? 'One Session' : 'Two Sessions';    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="75%">                        &nbsp;                    </td>                    <td width="25%">                        <table align="right">                        <tr>                            <td>' .            $pdf->Image(FCPATH . 'logos/' . $invoice->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false)            . '</td>                        </tr>                            <tr>                                <td>' . $invoice->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $invoice->tenant_address . '<br>' .                                    $invoice->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $invoice->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $invoice->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Class Details for the course - \'' . $data['course_name']->crse_name . '\'';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $display = ($data['class']->display_class_public == '1') ? 'Yes' : 'No';    $cls_dur = empty($data['class']->total_classroom_duration) ? '' : $data['class']->total_classroom_duration . ' hrs';    $lab_dur = empty($data['class']->total_lab_duration) ? '' : $data['class']->total_lab_duration . ' hrs';    $ass_dur = empty($data['class']->assmnt_duration) ? '' : $data['class']->assmnt_duration . ' hrs';    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <td align="center"><b>Class Status</b></td>            <td align="center"><b>' . $data['class_status'] . '</b></td>        </tr>        <tr>            <td align="center"><b>Display class for public registration</b></td>            <td align="center"><b>' . $display . '</b></td>        </tr>        <tr>            <td align="center"><b>Class Name</b></td>            <td align="center"><b>' . $data['class']->class_name . '</b></td>        </tr>        <tr>            <td align="center"><b>Start Date & Time</b></td>            <td align="center"><b>' . date('d/m/Y h:i A', strtotime($data['class']->class_start_datetime)) . '</b></td>        </tr>        <tr>            <td align="center"><b>End Date & Time</b></td>            <td align="center"><b>' . date('d/m/Y h:i A', strtotime($data['class']->class_end_datetime)) . '</b></td>        </tr>        <tr>            <td align="center"><b>Total Seats</b></td>            <td align="center"><b>' . $data['class']->total_seats . '</b></td>        </tr>        <tr>            <td align="center"><b>Classroom Duration</b></td>            <td align="center"><b>' . $cls_dur . '</b></td>        </tr>        <tr>            <td align="center"><b>Lab Duration</b></td>            <td align="center"><b>' . $lab_dur . '</b></td>        </tr>        <tr>            <td align="center"><b>Assmnt. Duration</b></td>            <td align="center"><b>' . $ass_dur . '</b></td>        </tr>        <tr>            <td align="center"><b>Payment Details</b></td>            <td align="center"><b>' . rtrim($data['ClassPay'], ', ') . '</b></td>        </tr>        <tr>            <td align="center"><b>Classroom Location</b></td>            <td align="center"><b>' . rtrim($data['ClassLoc'], ', ') . '</b></td>        </tr>        <tr>            <td align="center"><b>Lab Location</b></td>            <td align="center"><b>' . rtrim($data['LabLoc'], ', ') . '</b></td>        </tr>        <tr>            <td align="center"><b>Classroom Trainer</b></td>            <td align="center"><b>' . rtrim($data['ClassTrainer'], ', ') . '</b></td>        </tr>        <tr>            <td align="center"><b>Lab Trainer</b></td>            <td align="center"><b>' . rtrim($data['LabTrainer'], ', ') . '</b></td>        </tr>        <tr>            <td align="center"><b>Assessor</b></td>            <td align="center"><b>' . rtrim($data['Assessor'], ', ') . '</b></td>        </tr>        <tr>            <td align="center"><b>Training Aide</b></td>            <td align="center"><b>' . rtrim($data['TrainingAide'], ', ') . '</b></td>        </tr>        <tr>            <td align="center"><b>Minimum Students</b></td>            <td align="center"><b>' . $data['class']->min_reqd_students . '</b></td>        </tr>        <tr>            <td align="center"><b>Fees</b></td>            <td align="center"><b>$' . number_format($data['class']->class_fees, 2, '.', '') . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>No. of sessions per day</b></td>            <td align="center"><b>' . $session . '</b></td>        </tr>        <tr>            <td align="center"><b>Class Description</b></td>            <td align="center"><b>' . $data['class']->description . '</b></td>        </tr>        </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Sales Executive and Commission Payable';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">            <tr>                <th align="center"><b>Sales Executive</b></th>                <th align="center"><b>Commission Rate</b></th>            </tr>';    if (!empty($data['SalesExec'])) {        foreach ($data['SalesExec'] as $row) {            $tbl .='<tr>                    <td align="center"><b>' . $row['first_name'] . ' ' . $row['last_name'] . '</b></td>                    <td align="center"><b>' . number_format($row['commission_rate'], 2, '.', '') . '%</b></td>                </tr>';        }    } else {        $tbl .='<tr><td colspan="2" color="red" align="center"><b>There is no sales executive available.</b></td></tr>';    }    $tbl .='</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Class / Lab Schedule';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">         <tr>            <th align="center"><b>Class Date</b></th>            <th align="center"><b>Session Type</b></th>            <th align="center"><b>Start Time</b></th>            <th align="center"><b>End Time</b></th>        </tr>';    $date = '';    $data_arr = array();    $session_arr = array('S1' => 'Session 1', 'BRK' => 'Break', 'S2' => 'Session 2');    if (!empty($data['class_schedule'])) {        foreach ($data['class_schedule'] as $row) {            $data_arr[$row['class_date']][] = array(                'session' => $row['session_type_id'],                'start' => $row['session_start_time'],                'end' => $row['session_end_time']            );        }        foreach ($data_arr as $k => $v):            $rowspan = count($v);            $rowspan_td = '<td rowspan="' . $rowspan . '" align="center"><b>' . date('F d Y', strtotime($k)) . '</b></td>';            foreach ($v as $r) {                $tbl .= '<tr>                        ' . $rowspan_td . '                        <td align="center"><b>' . $session_arr[$r['session']] . '</b></td>                        <td align="center"><b>' . date('h:i A', strtotime($r['start'])) . '</b></td>                        <td align="center"><b>' . date('h:i A', strtotime($r['end'])) . '</b></td>                    </tr>';                $rowspan_td = '';            }        endforeach;    } else {        $tbl .='<tr color="red"><td colspan="4" align="center"><b>There is no class/lab schedule available.</b></td></tr>';    }    $tbl .='</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Assessment Schedule';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Assmnt. Date</b></th>            <th align="center"><b>Trainee Name</b></th>            <th align="center"><b>Assessor</b></th>            <th align="center"><b>Assmnt. Time</b></th>            <th align="center"><b>Assmnt. Venue</b></th>        </tr>';    if (!empty($def_assessment)) {        if ($def_assessment->assmnt_type == 'DEFAULT') {            $detail = ($def_assessment->assmnt_type == 'DEFAULT') ? 'ALL' : '';            $tbl .='<tr>                <td align="center"><b>' . date('F d Y', strtotime($def_assessment->assmnt_date)) . '</b></td>                <td align="center"><b>' . $detail . '</b></td>                <td align="center"><b>' . $def_assessment->DefAssId . '</b></td>                <td align="center"><b>' . date('h:i A', strtotime($def_assessment->assmnt_start_time)) . ' - ' . date('h:i A', strtotime($def_assessment->assmnt_end_time)) . '</b></td>                    <td align="center"><b>' . $def_assessment->DefAssLoc . '</b></td>            </tr>';        } else {            foreach ($def_assessment as $row) {                $assess_date = date('d-m-Y', strtotime($row['assmnt_date']));                $start_time = date('H:i', strtotime($row['assmnt_start_time']));                $end_date = date('H:i', strtotime($row['assmnt_end_time']));                $tbl .='<tr>                    <td align="center"><b>' . $assess_date . '</b></td>                    <td align="center"><b>' . implode(', ', $row['trainee']) . '</b></td>                    <td align="center"><b>' . $row['DefAssId'] . '</b></td>                    <td align="center"><b>' . $start_time . ' - ' . $end_date . '</b></td>                        <td align="center"><b>' . $row['DefAssLoc'] . '</b></td>                </tr>';            }        }    } else {        $tbl .='<tr color="red"><td colspan="5" align="center"><b>There is no assessment schedule available.</b></td></tr>';    }    $tbl .='</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<p style="color:red;"><i>This is a computer generated course-class report. No signature is required - ' . $invoice->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('class.pdf', 'D');}function WDA_report_PDF($query) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->helper('common');    $ci->load->model('meta_values', 'meta');    $meta_map = $ci->meta->get_param_map();    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = 'WDA Report as on ' . date('M j Y, l');    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>NRIC/FIN No.</b></th>            <th width="60px" align="center"><b>Trainee Name</b></th>            <th width="45px" align="center"><b>Account Type</b></th>            <th align="center"><b>Home Address</b></th>            <th width="100px" align="center"><b>Contact Details</b></th>            <th width="90px" align="center"><b>Class Start Date</b></th>            <th width="60px" align="center"><b>Assessment Date</b></th>            <th align="center"><b>Amount Paid</b></th>        </tr>';    foreach ($query['query']->result() as $row) {        $tbl .= '<tr>';        $tbl .= '<td>' . mask_format($row->tax_code) . '</td>';        $tbl .= '<td>' . $row->name . '</td>';        $tbl .= '<td>' . get_param_values_from_map($meta_map, $row->account_type) . '</td>';        $tbl .= '<td>' . $row->address . '</td>';        $tbl .= '<td>' . $row->contact_details . '</td>';        $tbl .= '<td>' . date_format_singapore($row->class_start_datetime) . '</td>';        $tbl .= '<td>' . date_format_singapore($row->assmnt_date) . '</td>';        $tbl .= '<td>' . $row->amount_recd . '</td>';        $tbl .= '</tr>';    }    $tbl .= '</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('WDA_report.pdf', 'D');}function pymnt_report_PDF($query) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->helper('common');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, TRUE, 'UTF-8', FALSE);    $pdf->SetPrintHeader(FALSE);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = 'Payment Recevied Report as on ' . date('M j Y, l');    $pdf->Write(0, $info, '', 0, 'C', TRUE, 0, FALSE, FALSE, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Company Name</b></th>            <th align="center"><b>Course Name</b></th>            <th align="center"><b>Class Name</b></th>            <th align="center" width="12%"><b>NRIC/FIN No.</b></th>            <th align="center"><b>Name</b></th>            <th align="center" width="12%"><b>Received on</b></th>            <th align="center" width="7%"><b>Amount Received</b></th>        </tr>';    foreach ($query['query']->result() as $row) {        $tbl .= '<tr>';        $tbl .= '<td>' . $row->companyName . '</td>';        $tbl .= '<td>' . $row->crse_name . '</td>';        $tbl .= '<td>' . $row->class_name . '</td>';        $tbl .= '<td>' . mask_format($row->tax_code) . '</td>';        $tbl .= '<td>' . $row->name . '</td>';        $tbl .= '<td align="center">' . date_format_singapore($row->recd_on) . ' ' . time_format_singapore($row->recd_on) . '</td>';        $tbl .= '<td align="right">' . $row->amount_recd . '</td>';        $tbl .= '</tr>';    }    $tbl .= '</table>';    $pdf->writeHTML($tbl, TRUE, FALSE, FALSE, FALSE, '');    $pdf->Output('Payment-Recevied.pdf', 'D');}function refund_report_PDF($query) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->helper('common');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, TRUE, 'UTF-8', FALSE);    $pdf->SetPrintHeader(FALSE);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = 'Refunds Report as on ' . date('M j Y, l');    $pdf->Write(0, $info, '', 0, 'C', TRUE, 0, FALSE, FALSE, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Invoice/Receipt #</b></th>            <th align="center"><b>NRIC/FIN No.</b></th>            <th align="center"><b>Name</b></th>            <th align="center"><b>Refund Date</b></th>            <th align="center"><b>Refund Amount</b></th>            <th align="center"><b>Reason</b></th>            <th align="center"><b>Refunded By</b></th>        </tr>';    foreach ($query['query']->result() as $row) {        $tbl .= '<tr>';        $tbl .= '<td>' . $row->invoice_id . '</td>';        $tbl .= '<td>' . mask_format($row->tax_code) . '</td>';        $tbl .= '<td>' . $row->name . '</td>';        $tbl .= '<td>' . date_format_singapore($row->refund_on) . '</td>';        $tbl .= '<td>' . $row->amount_refund . '</td>';        $tbl .= '<td align="center">' . $row->reason . '</td>';        $tbl .= '<td align="right">' . $row->refund_by . '</td>';        $tbl .= '</tr>';    }    $tbl .= '</table>';    $pdf->writeHTML($tbl, TRUE, FALSE, FALSE, FALSE, '');    $pdf->Output('Refunds.pdf', 'D');}/** * created to get trainee payment received */function generate_trainee_payment_recieved($invoice, $recieved, $trainee) {    $invoice = $invoice['data'];    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                        <tr>                            <td>' .            $pdf->Image(FCPATH . 'logos/' . $invoice->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false)            . '</td>                        </tr>                            <tr>                                <td>' . $invoice->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $invoice->tenant_address . '<br>' .                                    $invoice->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $invoice->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $invoice->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Payment Received Details for \'' . $trainee . '\' for the class \' ' . $invoice->crse_name . ' - ' . $invoice->class_name . ' \'';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);     /*skm code start */    if($invoice->tenant_id == 'T02' || $invoice->tenant_id == 'T12' || $invoice->tenant_id == 'T01')    {        $subsidy_amount = 'Skills Future Funding Subsidy Amount';    }else{         $subsidy_amount = 'Toatl Subsidy Amount';    }        $addon='';    if($invoice->tenant_id != 'T17'){        $addon = '<tr>            <td align="center"><b>Total Discount @ ' . $invoice->discount_rate . '%</b></td>            <td align="center"><b>$ ' . $invoice->total_inv_discnt . ' SGD</b></td>        </tr>';    }        /*skm code end */    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <td align="center"><b>Invoice Id</b></td>            <td align="center"><b>' . $invoice->invoice_id . '</b></td>        </tr>        <tr>            <td align="center"><b>Invoice Date</b></td>            <td align="center"><b>' . $invoice->inv_date . '</b></td>        </tr>        <tr>            <td align="center"><b>Total Class Fees</b></td>            <td align="center"><b>$ ' . $invoice->total_unit_fees . ' SGD</b></td>        </tr>        '.$addon.'        <tr>            <td align="center"><b>'.$subsidy_amount.'</b></td>            <td align="center"><b>$ ' . $invoice->total_inv_subsdy . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>Total GST @ ' . $invoice->gst_rate . '%</b></td>            <td align="center"><b>$ ' . $invoice->total_gst . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>Total Invoice Amount</b></td>            <td align="center"><b>$ ' . $invoice->total_inv_amount . ' SGD</b></td>        </tr>        </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Received Details';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Payment Received On</b></th>';    if ($invoice->enrolment_mode == 'COMPSPON') {        $tbl .='<th align="center"><b>Trainee Name</b></th>';    }    $tbl .='<th align="center"><b>Amt. Recd.</b></th>        </tr>';    if (!empty($recieved)) {        foreach ($recieved as $row) {            $tbl .= '<tr>';            $tbl .= '<td align="center"><b>' . $row['recd_on'] . '('.$row['mode'].')</b></td>';            if ($invoice->enrolment_mode == 'COMPSPON') {                $tbl .='<th align="center"><b>' . $row['name'] . '</b></th>';            }            $tbl .= '<td align="center"><b>' . $row['amount'] . '</b></td>';            $tbl .= '</tr>';        }        $tbl .= '<tr>';        if ($invoice->enrolment_mode == 'COMPSPON') {            $tbl .= '<td align="center"><b></b></td>';        }        $tbl .= '<td align="center"><b>Total: </b></td>';        $tbl .= '<td align="center"><b>' . $invoice->total_paid . '</b></td>';        $tbl .= '</tr>';    } else {        $tbl .='<tr><td color="red" colspan="3"><b>There is no payment received.</b></td></tr>';    }    $tbl .= '</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<p style="color:red;"><i>This is a computer generated payment received report. No signature is required - ' . $invoice->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('payment_received.pdf', 'D');}/** * created to get trainee payment refund */function generate_trainee_payment_refund($invoice, $recieved, $trainee) {    $invoice = $invoice['data'];    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="75%">                        &nbsp;                    </td>                    <td width="25%">                        <table align="right">                        <tr>                            <td>' .            $pdf->Image(FCPATH . 'logos/' . $invoice->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false)            . '</td>                        </tr>                            <tr>                                <td>' . $invoice->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $invoice->tenant_address . '<br>' .            $invoice->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $invoice->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $invoice->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Refund Details for \'' . $trainee . '\' for the class \' ' . $invoice->crse_name . ' - ' . $invoice->class_name . ' \'';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);     /*skm code start */        if($invoice->tenant_id == 'T02' || $invoice->tenant_id == 'T12' || $invoice->tenant_id == 'T01')        {            $subsidy_amount = 'SkillsFuture Funding Subsidy Amount';        }else{             $subsidy_amount = 'Subsidy Amount';        }        /*skm code end */    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <td align="center"><b>Invoice Id</b></td>            <td align="center"><b>' . $invoice->invoice_id . '</b></td>        </tr>        <tr>            <td align="center"><b>Invoice Dated</b></td>            <td align="center"><b>' . $invoice->inv_date . '</b></td>        </tr>        <tr>            <td align="center"><b>Class Fees</b></td>            <td align="center"><b>$ ' . $invoice->total_unit_fees . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>Discount @ ' . $invoice->total_inv_discnt . '%</b></td>            <td align="center"><b>$ ' . $invoice->total_inv_discnt . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>'.$subsidy_amount.'</b></td>            <td align="center"><b>$ ' . $invoice->total_inv_subsdy . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>GST @ ' . $invoice->gst_rate . '%</b></td>            <td align="center"><b>$ ' . $invoice->total_gst . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>Total Invoice Amount</b></td>            <td align="center"><b>$ ' . $invoice->total_inv_amount . ' SGD</b></td>        </tr>        </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Refund Details';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);       $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Refund On</b></th>            <th align="center"><b>Refund Reason</b></th>            <th align="center"><b>Mode</b></th>';    $tbl .='<th align="center"><b>Amt. Refund</b></th>        </tr>';    if (!empty($invoice->refund_details)) {        $t_refund = 0;        foreach ($invoice->refund_details as $row) {            $tbl .= '<tr>';            $tbl .= '<td align="center"><b>' . $row->refund_on . '</b></td>';            $tbl .= '<td align="center"><b>' . $row->refnd_reason . '</b></td>';            $tbl .= '<td align="center"><b>' . $row->mode_of_refund . '</b></td>';            $tbl .= '<td align="center"><b>$ ' . number_format($row->amount_refund, 2, '.', '') . ' SGD</b></td>';            $tbl .= '</tr>';            $t_refund +=$row->amount_refund;        }        $tbl .= '<tr>';        $tbl .= '<td align="center"><b>&nbsp;</b></td>';        $tbl .= '<td align="center"><b>&nbsp;</b></td>';        $tbl .= '<td align="center"><b>Total: </b></td>';        $tbl .= '<td align="center"><b>$ ' . number_format($t_refund, 2, '.', '') . ' SGD</b></td>';        $tbl .= '</tr>';    }    $tbl .= '</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<p style="color:red;"><i>This is a computer generated refund report. No signature is required - ' . $invoice->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('refund.pdf', 'D');}/** * function to create PDF for Certifications */function cert_report_PDF($query) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->helper('common');    $ci->load->model('meta_values', 'meta');    $meta_map = $ci->meta->get_param_map();    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = 'Certifications Report as on ' . date('M j Y, l');    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>			<th align="center" width="65px"><b>Course Name</b></th>			<th align="center" width="100px"><b>Class Name</b></th>			<th align="center"><b>NRIC/FIN No.</b></th>			<th align="center"><b>Trainee Name</b></th>			<th align="center" width="50px" ><b>Course Completion Date</b></th>			<th align="center" width="50px" ><b>Collection Date</b></th>			<th align="center" width="75px"><b>Current Status</b></th>        </tr>';    foreach ($query['query']->result() as $row) {        switch ($row->status) {            case 'PENDCOLL':                $stat = 'Life Long';                break;            case 'EXPIRD':                $stat = $meta_map[$row->status] . ' [' . date_format_singapore($row->validityDate) . ']';                break;            default:                $stat = 'Active [' . date_format_singapore($row->validityDate) . ']';                break;        }        $tbl .= '<tr>';        $tbl .= '<td>' . $row->crse_name . '</td>';        $tbl .= '<td>' . $row->class_name . '</td>';        $tbl .= '<td>' . mask_format($row->tax_code) . '</td>';        $tbl .= '<td>' . $row->name . '</td>';        $tbl .= '<td align="center">' . date_format_singapore($row->class_end_datetime) . '</td>';        $tbl .= '<td align="center">' . date_format_singapore($row->certificate_coll_on) . '</td>';        $tbl .= '<td align="center">' . $stat . '</td>';        $tbl .= '</tr>';    }    $tbl .= '</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('Certificates_report.pdf', 'D');}/** * This function prints the invoice in PDF format * @param type $query * @param type $tenant */function invoice_report_PDF($query, $tenant) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->helper('common');    $ci->load->model('meta_values', 'meta');    $meta_map = $ci->meta->get_param_map();    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                .$tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $start_date = $ci->input->get('start_date');    $end_date = $ci->input->get('end_date');    if (empty($start_date) && empty($end_date)) {        $period = ' for ' . date('F d Y, l');    } else {        $period = 'for the period';        if (!empty($start_date))            $period .= ' from ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $start_date)->getTimestamp());        if (!empty($end_date))            $period .= ' to ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $end_date)->getTimestamp());    }    $info = 'Invoice Report ' . $period;    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>			<th align="center"><b>Inv #</b></th>			<th align="center"><b>Course Dt.</b></th>			<th align="center"><b>Inv Dt.</b></th>			<th align="center"><b>NRIC/FIN No.</b></th>			<th align="center"><b>Name</b></th>			<th align="center"><b>Discount</b></th>			<th align="center"><b>Subsidy</b></th>			<th align="center"><b>GST</b></th>                        <th align="center"><b>Net Amt.</b></th>                        <th align="center"><b>Status</b></th>        </tr>';    foreach ($query->result() as $data) {                if ($data->invoiced_on == NULL || $data->invoiced_on == '0000-00-00 00:00:00') {            $invoiced_label = '<br><span style="color:red">** Invoice Sent</span>';        } else {            $invoiced_label = '<br><span style="color:blue">** Invoice Sent (' . date('d/m/Y', strtotime($data->invoiced_on)) . ')</span>';        }        if ($data->enrolment_mode === 'COMPSPON') {            $ci->load->model('reports_model');            $data->payment_status = $ci->reports_model->check_not_part_paid($data->pymnt_due_id);        }        $paid_arr = array('PAID' => 'Paid', 'PARTPAID' => 'Part Paid', 'NOTPAID' => 'Not Paid');        if ($data->enrolment_mode == 'SELF') {            $taxcode = mask_format($data->tax_code);            $name = $data->first_name . ' ' . $data->last_name;            $status = $paid_arr[$data->payment_status];        } else {            if($data->company_id[0] == 'T') {                $tenant_details = fetch_tenant_details($data->company_id);                                    $taxcode = $tenant_details->tenant_name;                $name = $tenant_details->tenant_name . ' (Company)';            } else {                $taxcode = $data->comp_regist_num;                $name = $data->company_name . ' (Company)';            }            $status = ($data->payment_status > 0) ? 'Part Paid/Not Paid' : 'Paid';        }        $tbl .= '<tr>';        $tbl .= '<td>' . $data->invoice_id . '</td>';        $tbl .= '<td>' . date('d/m/Y', strtotime($data->course_date)) . '</td>';        $tbl .= '<td>' . date('d/m/Y', strtotime($data->inv_date)) . '</td>';        $tbl .= '<td>' . $taxcode . $invoiced_label . '</td>';        $tbl .= '<td>' . $name . '</td>';        $tbl .= '<td align="center">$' . number_format($data->total_inv_discnt, 2, '.', '') . ' SGD</td>';        $tbl .= '<td align="center">$' . number_format($data->total_inv_subsdy, 2, '.', '') . ' SGD</td>';        $tbl .= '<td align="center">$' . number_format($data->total_gst, 2, '.', '') . ' SGD</td>';        $tbl .= '<td>$' . number_format($data->total_inv_amount, 2, '.', '') . ' SGD</td>';        $tbl .= '<td>' . $status . '</td>';        $tbl .= '</tr>';    }    $tbl .= '</table><br><p style="color:red;">Qty: Number of Trainees</p>'; // Added Static legend - Dec 01 2014    $tbl .= '<br><br><br><p style="color:red;"><i>This is a computer generated report and doesn\'t require a seal or signature - ' . $tenant->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('Invoice_report.pdf', 'D');}function tranee_feedback_pdf_wablab($feedbackDetails, $tenant_details, $user_details) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->model('Meta_Values', 'meta');    $meta_map = $ci->meta->get_param_map();    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, TRUE, 'UTF-8', FALSE);    $pdf->SetCreator(PDF_CREATOR);    $pdf->SetPrintHeader(FALSE);    $pdf->SetPrintFooter(FALSE);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 10);    $pdf->Image(FCPATH . 'logos/' . $tenant_details->Logo, 0, 10, null, null, 'PNG', '', '', TRUE, 150, 'R', FALSE, FALSE, 1, FALSE, FALSE, FALSE);    $pdf->writeHTML('<br>', TRUE, FALSE, FALSE, FALSE, '');    $tbl = '        <table style="font-size:8px;">            <tr>                <td>' . $tenant_details->tenant_address . '</td>            </tr>            <tr>                <td>' . $tenant_details->tenant_country . '</td>            </tr>            <tr>                <td>Tel: ' . $tenant_details->tenant_contact_num . '</td>            </tr>            <tr>                <td>' . $tenant_details->tenant_email_id . '</td>            </tr>        </table>    ';    $pdf->writeHTML($tbl, true, false, false, false, 'R');    $pdf->SetFont('helvetica', 'B', 12);    $pdf->Write(0, 'Trainee Feedback Form', '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 10);    $trainee_feedback = empty($feedbackDetails['Q01']['trainee_feedback_rating']) ? '--' : $feedbackDetails['Q01']['trainee_feedback_rating'];        $tbl = '        <table cellspacing="0" cellpadding="1" border="1">            <tr>                <td colspan="2" align="right">                    <span style="font-size:8px;color:#f00;text-align:right">                       (5. Strongly agree, 4. Agree, 3. Neutral, 2. Disagree,  1. Strongly disagree )                    </span>                </td>            </tr>            <tr>                <td  width="95%">                    <strong>                        Your satisfaction rating of the training program:                    </strong>                </td>                     <td align="center" width="5%"><strong>                    ' . $trainee_feedback . '</strong>                </td>                            </tr>            <tr>                <td colspan="2">                    <strong>                        ' . $feedbackDetails['FDBCK01']['category_name'] . '                    </strong>                </td>            </tr>            <tr>                <td width="95%">                    1. ' . $feedbackDetails['Q01']['category_name'] . ':                </td>                <td align="center" width="5%">                    ' . $feedbackDetails['Q01']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    2. ' . $feedbackDetails['Q02']['category_name'] . ':                </td>                <td align="center">                    ' . $feedbackDetails['Q02']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    3. ' . $feedbackDetails['Q03']['category_name'] . ':                </td>                <td align="center">                    ' . $feedbackDetails['Q03']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    4. ' . $feedbackDetails['Q04']['category_name'] . ':                </td>                <td align="center">                    ' . $feedbackDetails['Q04']['feedback_answer'] . '                </td>            </tr>                       <tr>                <td colspan="2">                    <strong>' . $feedbackDetails['FDBCK02']['category_name'] . '</strong></td>            </tr>             <tr>                <td>                    5. ' . $feedbackDetails['Q05']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q05']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    6. ' . $feedbackDetails['Q06']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q06']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    7. ' . $feedbackDetails['Q07']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q07']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    8. ' . $feedbackDetails['Q08']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q08']['feedback_answer'] . '                </td>            </tr>                      <tr>                <td colspan="2">                    <strong> ' . $feedbackDetails['FDBCK03']['category_name'] . '</strong></td>            </tr>            <tr>                <td>                    9. ' . $feedbackDetails['Q09']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q09']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    10. ' . $feedbackDetails['Q10']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q10']['feedback_answer'] . '                </td>            </tr>            <tr>                <td colspan="2">                    <strong>11. Other comments that you feel will help improve the course.</strong>                </td>            </tr>            <tr>                <td colspan="2">                                       ' . $feedbackDetails['remarks']['feedback_answer'] . '                </td>            </tr>        </table>    ';    $pdf->writeHTML($tbl, true, false, false, false, '');    $html = '<div>Name: ' . $user_details->first_name . ' ' . $user_details->last_name . '</div>        <div>NRIC or Work Pass No.: ' . $user_details->tax_code . '</div>        <div>Course Title: ' . $user_details->course_title . ' - ' . $user_details->class_title . '</div>        <div>Course Date: ' . date('d/m/Y', strtotime($user_details->class_end_datetime)) . '</div>';     $pdf->writeHTML($html, true, false, true, false, '');    $pdf->Output('trainee_feedback.pdf', 'D');}function tranee_feedback_pdf($feedbackDetails, $tenant_details, $user_details) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->model('meta_values', 'meta');    $meta_map = $ci->meta->get_param_map();    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, TRUE, 'UTF-8', FALSE);    $pdf->SetCreator(PDF_CREATOR);    $pdf->SetPrintHeader(FALSE);    $pdf->SetPrintFooter(FALSE);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 10);    $pdf->Image(FCPATH . 'logos/' . $tenant_details->Logo, 0, 10, null, null, 'PNG', '', '', TRUE, 150, 'R', FALSE, FALSE, 1, FALSE, FALSE, FALSE);    $pdf->writeHTML('<br>', TRUE, FALSE, FALSE, FALSE, '');    $tbl = '        <table style="font-size:8px;">            <tr>                <td>' . $tenant_details->tenant_address . '</td>            </tr>            <tr>                <td>' . $tenant_details->tenant_country . '</td>            </tr>            <tr>                <td>Tel: ' . $tenant_details->tenant_contact_num . '</td>            </tr>            <tr>                <td>' . $tenant_details->tenant_email_id . '</td>            </tr>        </table>    ';    $pdf->writeHTML($tbl, true, false, false, false, 'R');    $pdf->SetFont('helvetica', 'B', 12);    $pdf->Write(0, 'Trainee Feedback Form', '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 10);    $trainee_feedback = empty($feedbackDetails['Q01']['trainee_feedback_rating']) ? '--' : $feedbackDetails['Q01']['trainee_feedback_rating'];        $tbl = '        <table cellspacing="0" cellpadding="1" border="1">            <tr>                <td colspan="2" align="right">                    <span style="font-size:8px;color:#f00;text-align:right">                        (1. Strongly disagree, 2. Disagree, 3. Neutral, 4. Agree, 5. Strongly agree)                    </span>                </td>            </tr>            <tr>                <td  width="95%">                    <strong>                        Your satisfaction rating of the training program:                    </strong>                </td>                     <td align="center" width="5%"><strong>                    ' . $trainee_feedback . '</strong>                </td>                            </tr>            <tr>                <td colspan="2" class="td_heading">                    <strong>                        <u>A. ' . $feedbackDetails['FDBCK01']['category_name'] . '</u>                    </strong>                </td>            </tr>            <tr>                <td width="95%">                    1. ' . $feedbackDetails['Q01']['category_name'] . ':                </td>                <td align="center" width="5%">                    ' . $feedbackDetails['Q01']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    2. ' . $feedbackDetails['Q02']['category_name'] . ':                </td>                <td align="center">                    ' . $feedbackDetails['Q02']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    3. ' . $feedbackDetails['Q03']['category_name'] . ':                </td>                <td align="center">                    ' . $feedbackDetails['Q03']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    4. ' . $feedbackDetails['Q04']['category_name'] . ':                </td>                <td align="center">                    ' . $feedbackDetails['Q04']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    5. ' . $feedbackDetails['Q05']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q05']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    6. ' . $feedbackDetails['Q06']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q06']['feedback_answer'] . '                </td>            </tr>            <tr>                <td colspan="2" class="td_heading">                    <strong><u>B. ' . $feedbackDetails['FDBCK02']['category_name'] . '</u></strong></td>            </tr>            <tr>                <td>                    1. ' . $feedbackDetails['Q07']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q07']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    2. ' . $feedbackDetails['Q08']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q08']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    3. ' . $feedbackDetails['Q09']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q09']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    4. ' . $feedbackDetails['Q10']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q10']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    5. ' . $feedbackDetails['Q11']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q11']['feedback_answer'] . '                </td>            </tr>            <tr>                <td colspan="2" class="td_heading">                    <strong><u>C. ' . $feedbackDetails['FDBCK03']['category_name'] . '</u></strong></td>            </tr>            <tr>                <td>                    1. ' . $feedbackDetails['Q12']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q12']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    2. ' . $feedbackDetails['Q13']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q13']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    3. ' . $feedbackDetails['Q14']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q14']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    4. ' . $feedbackDetails['Q15']['category_name'] . '                </td>                <td align="center">                    ' . $feedbackDetails['Q15']['feedback_answer'] . '                </td>            </tr>            <tr>                <td colspan="2" class="td_heading">                    <strong><u>D. Any other remarks</u></strong>                </td>            </tr>            <tr>                <td colspan="2">                                       ' . $feedbackDetails['remarks']['feedback_answer'] . '                </td>            </tr>        </table>    ';    $pdf->writeHTML($tbl, true, false, false, false, '');    $html = '<div>Name: ' . $user_details->first_name . ' ' . $user_details->last_name . '</div>        <div>NRIC or Work Pass No.: ' . mask_format($user_details->tax_code) . '</div>        <div>Course Title: ' . $user_details->course_title . ' - ' . $user_details->class_title . '</div>        <div>Course Date: ' . date('d/m/Y', strtotime($user_details->class_end_datetime)) . '</div>';     $pdf->writeHTML($html, true, false, true, false, '');    $pdf->Output('trainee_feedback.pdf', 'D');}/** * function to generate company pdf */function generate_company_pdf_invoice($data) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = $data->invoice_name;    $comp_label ="";    $gst_label="";    if($data->invoice_name == "Tax Invoice") {                    $comp_label ='<tr><td>Reg. No.: ' . $data->comp_reg_no . '</td></tr>';        if($data->total_gst != 0) {                         $gst_label ='<tr><td>GST Reg. No.: ' . $data->gst_reg_no . '</td></tr>';        }    }    foreach ($data->previous_inv_id as $row)    {        $prev_invid=$row->previous_inv_id;    }         /*skm code start */        if($data->tenant_id == 'T02' || $data->tenant_id == 'T12' || $data->tenant_id == 'T01')        {            $subsidy_amount = 'SkillsFuture Funding Subsidy Amount';        }else{             $subsidy_amount = 'Subsidy Amount';        }        /*skm code end */        $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%" >                        <table>                            <tr>                                <td align="left"><b>' . $data->invoice_name . ' No: </b>' . $data->inv_year . ' ' . $data->invoice_id . $data->invoice_label . '</td>                            </tr>                            <tr>                                <td align="left"><b>' . $data->invoice_name . ' Date: </b>' . $data->inv_date . '</td>                            </tr>                            <tr>                                <td align="left"><b>Class Start Date & Time: </b>' . date('d/m/Y h:i A',strtotime($data->class_start_datetime)) . '</td>                            </tr>                            <tr>                                <td align="left"><b>Class End Date & Time: </b>' . date('d/m/Y h:i A',strtotime($data->class_end_datetime)) . '</td>                            </tr>                            <tr>                                <td align="left">&nbsp;&nbsp;&nbsp;</td>                            </tr>                            <tr>                                <td width="100%" align="right">                                    <table width="100%" align="left">                                    <tr><td colspan="2"><strong><u>Company Details1:</u></strong></td></tr>                                        <tr>                                            <td width="20%">                                                Address :                                             </td>                                            <td width="80%" align="left">                                            ' . $data->company_details->comp_address . '<br>                                            ' . $data->company_details->comp_city . ' ' . $data->company_details->comp_state . ' ' . $data->company_details->comp_cntry . ' ' . $data->company_details->comp_zip . '                                            </td>                                        </tr>                                        <tr>                                            <td>                                                Contact No :                                             </td>                                            <td align="left">                                            ' . $data->company_details->comp_phone . '                                            </td>                                        </tr>                                        <tr>                                            <td>                                                Attention :                                             </td>                                            <td align="left">                                            ' . $data->company_name . '                                            </td>                                        </tr>                                        <tr>                                            <td>                                                &nbsp;                                            </td>                                            <td>                                            (ACCOUNT DEPT)                                            </td>                                        </tr>                                        <tr>                                            <td>                                                Contact Person :                                             </td>                                            <td align="left">                                            ' . $data->company_person_name . '                                            </td>                                        </tr>                                    </table>                                </td>                            </tr>                        </table>                    </td>                    <td width="35%">                        <table align="right">                        <tr>                            <td>' .            $pdf->Image(FCPATH . 'logos/' . $data->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false)            . '</td>                        </tr>                            <tr>                                <td>' . $data->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $data->tenant_address . '<br>'                                     .$data->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $data->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $data->tenant_email_id . '</td>                            </tr>'.$comp_label.$gst_label.'                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    if($data->total_inv_amount1>0)    {    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                    <thead>                        <tr>                            <th align="center">Qty</th>                            <th align="center">Description</th>                            <th align="center">Unit Price</th>                            <th align="center">Total</th>                        </tr>                        </thead>                        <tbody>                        <tr>                                                    <td>'.sprintf("%02s", count($data->payment_due_details)).'</td>                            <td>' . $data->crse_name . ' (' . $data->course_id . '), ' . $data->class_name . ' (' . $data->class_id . ')</td>                            <td>$ ' . number_format(($data->total_unit_fees / count($data->payment_due_details)), 2, '.', '') . '</td>                            <td>$ ' . number_format($data->total_unit_fees, 2, '.', '') . '</td>                        </tr>                        <tr>                            <td>&nbsp;</td>                            <td>' . $data->discount_label . ' Discount @ ' . number_format($data->discount_rate, 2, '.', '') . '%</td>                            <td>$ ' . number_format(($data->total_inv_discnt/count($data->payment_due_details)), 2, '.', '') . '</td>                            <td>$ ' . number_format($data->total_inv_discnt, 2, '.', '') . '</td>                        </tr>                        <tr>                            <td colspan="3" align="right" class="td_heading">After Discounts</td>                            <td>$ ' . number_format(($data->total_unit_fees - $data->total_inv_discnt), 2, '.', '') . '</td>                        </tr>                        <tr>';    if ($data->total_gst != 0) {        $tbl .='<td colspan="3" align="right" class="td_heading">                    GST (' . number_format($data->gst_rate, 2, '.', '') . '%)                </td>                <td>                    $ ' . number_format($data->total_gst, 2, '.', '') . '                </td>                </tr>                <tr>                    <td colspan="3" align="right" class="td_heading">' . $data->gst_label . '</td>                    <td>$ ' . number_format((($data->total_unit_fees - $data->total_inv_discnt) + $data->total_gst), 2, '.', '') . '</td>                </tr>';    } else {        $tbl .='<td colspan="3" align="right" class="td_heading">                    GST OFF                 </td>                <td>$ 0.00</td>                </tr>                <tr>                    <td colspan="3" align="right" class="td_heading">GST Not Applicable</td>                    <td>$ ' . number_format(($data->total_unit_fees - $data->total_inv_discnt), 2, '.', '') . '</td>                </tr>';    }    $tbl .='                              <tr>                            <td>'.sprintf("%02s", count($data->payment_due_details)).'</td>                            <td>'.$subsidy_amount.'</td>                            <td>$ ' . number_format($data->total_inv_subsdy, 2, '.', '') . '</td>                            <td>$ ' . number_format($data->total_inv_subsdy, 2, '.', '') . '</td>                        </tr>                        <tr class="info">                            <td colspan="3" align="right" class="td_heading">INVOICE AMOUNT</td>                            <td>$ ' . number_format($data->total_inv_amount, 2, '.', '') . '</td>                        </tr>                        </tbody>                    </table>';        }    else    {        $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                    <thead>                        <tr>                            <th align="center">Qty</th>                            <th align="center">Description</th>                            <th align="center">Unit Price</th>                            <th align="center">Total</th>                        </tr>                        </thead>                        <tbody>                        <tr>                            <td>0</td>                            <td>' . $data->crse_name . ' (' . $data->course_id . '), ' . $data->class_name . ' (' . $data->class_id . ')</td>                            <td>$ ' . number_format(($data->class_fee), 2, '.', '') . '</td>                            <td>$ 0.00</td>                        </tr>                        <tr>                            <td>&nbsp;</td>                            <td>' . $data->discount_label . ' Discount @ ' . number_format($data->discount_rate, 2, '.', '') . '%</td>                            <td>$ 0.00</td>                            <td>$ 0.00</td>                        </tr>                        <tr>                            <td colspan="3" align="right" class="td_heading">After Discounts</td>                            <td>$ 0.00</td>                        </tr>                        <tr>';    if ($data->total_gst != 0) {        $tbl .='<td colspan="3" align="right" class="td_heading">                    GST (' . number_format($data->gst_rate, 2, '.', '') . '%)                </td>                <td>                    $ 0.00                </td>                </tr>                <tr>                    <td colspan="3" align="right" class="td_heading">' . $data->gst_label . '</td>                    <td>$ 0.00</td>                </tr>';    } else {        $tbl .='<td colspan="3" align="right" class="td_heading">                    GST OFF                 </td>                <td>$ 0.00</td>                </tr>                <tr>                    <td colspan="3" align="right" class="td_heading">GST Not Applicable</td>                    <td>$ 0.00</td>                </tr>';    }    $tbl .='                              <tr>                            <td>0.00</td>                            <td>'.$subsidy_amount.'</td>                            <td>$ 0.00</td>                            <td>$ 0.00</td>                        </tr>                        <tr class="info">                            <td colspan="3" align="right" class="td_heading">INVOICE AMOUNT</td>                            <td>$ 0.00</td>                        </tr>                        </tbody>                    </table>';    }    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Particulars of Participants';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                    <thead>                        <tr>                            <th align="center">Name</th>                            <th align="center">NRIC</th>                            <th align="center">TG#</th>                            <th align="center">'.$subsidy_amount.'</th>                            <th align="center">' . $data->discount_label . ' Discount @ ' . number_format($data->discount_rate, 2, '.', '') . '%</th>                            <th align="center">GST @ ' . number_format($data->gst_rate, 2, '.', '') . '% (' . $data->gst_label . ')</th>                            <th align="center">Inv. Amt.</th>                            <th align="center">Remarks</th>                        </tr>                    </thead>                    <tbody>';    if($data->total_inv_amount1>0)    {        foreach ($data->payment_due_details as $row)         {            $extra_name = ($data->class_name != $row->class_name) ? '<span style="color:green"> **</span><br/><span style="color:green">(' . $row->class_name . ')</span>' : '';            if($row->payment_label!='PAID'){                $out_standing_amt+= number_format($row->total_amount_due, 2, '.', '');        }            $tbl .='<tr>                        <td align="center">' . $row->first_name . ' ' . $row->last_name . $extra_name . '</td>                        <td align="center">' . mask_format($row->tax_code) . '</td>                        <td align="center">' . $row->tg_number . '</td>                        <td align="center">$ ' . number_format($row->subsidy_amount, 2, '.', '') . '</td>                        <td align="center">$ ' . number_format($data->indi_disc_total, 2, '.', '') . '</td>                        <td align="center">$ ' . number_format($row->gst_amount, 2, '.', '') . '</td>                        <td align="center">$ ' . number_format($row->total_amount_due, 2, '.', '') . '</td>                        <td align="center">' . $row->payment_label . '</td>                    </tr>';        }if($out_standing_amt==""){$out_standing_amt=0.00;}             $tbl.='<tr>                    <td colspan="4"></td>                    <td colspan="2" align="center">OUTSTANDING AMOUNT</td>                    <td align="center">$ '.number_format($data->payble_amount, 2, '.', '').'</td>                    <td align="center"></td>                    </tr>';    }    else    {        $tbl .='<tr>                        <td align="center" colspan="8">No trainee Present in this Class. </td>                                           </tr>';    }    $tbl .='</tbody>                </table>                        <div>';           //if($prev_invid)  commented to hide the wording "previous invoice" 14-07-2016          /* if($prev_invid)            {                                  $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                   $tbl .='<tr border="none">                        <td align="left" colspan="7"><b> This invoice is to replace the Previous Invoice Number - '.$prev_invid.' </b></td>                        <td align="left" colspan="1"><b> Approved By</b> </td>                        </tr>';                  $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';                            }  else {                      $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                       $tbl .='<tr><td align="left" colspan="7"></td>                            <td align="left" colspan="1"> <b> Approved By</b></td></tr>';                                       $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';                }*/            $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                       $tbl .='<tr><td align="left" colspan="7"></td>                            <td align="left" colspan="1"> <b> Approved By</b></td></tr>';                                       $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';           $tbl.=' ';    $tbl .='</tbody>                </table>                <div>                 <span style="color:red;"><i>** All $ values are in SGD.</i></span>                </div>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<span style="color:red;"><i>This is a computer generated invoice. No signature is required - ' . $data->tenant_name . ' Administrator.  </i></span>            <div style="color:red;">' . html_entity_decode($data->invoice_footer_text) . '</div>';       $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($data->inv_year.'_'.$data->invoice_id.''.$data->invoice_label.'.pdf', 'D');}/** * function to generate company pdf */function generate_company_pdf_invoice_all($data) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = $data->invoice_name;    $comp_label ="";    $gst_label="";        if(TENANT_ID=='T02'){//// added by shubhranshu on 31-mar-2021 as per client requirement        $class_or_course_runid= $data->tpg_course_run_id ? $data->tpg_course_run_id : 'NA';    }else{        $class_or_course_runid= $data->class_id;    }        if($data->invoice_name == "Tax Invoice") {                    $comp_label ='<tr><td>Reg. No.: ' . $data->comp_reg_no . '</td></tr>';        if($data->total_gst != 0) {                         $gst_label ='<tr><td>GST Reg. No.: ' . $data->gst_reg_no . '</td></tr>';        }    }       foreach ($data->previous_inv_id as $row)    {        $prev_invid=$row->previous_inv_id;    }         /*skm code start */        if($data->tenant_id == 'T02' || $data->tenant_id == 'T12' || $data->tenant_id == 'T01')        {            $subsidy_amount = 'SkillsFuture Funding Subsidy Amount';        }else{             $subsidy_amount = 'Subsidy Amount';        }        /*skm code end */        $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%" >                        <table>                            <tr>                                <td align="left"><b>' . $data->invoice_name . ' No: </b>' . $data->inv_year . ' ' . $data->invoice_id . $data->invoice_label . '</td>                            </tr>                            <tr>                                <td align="left"><b>' . $data->invoice_name . ' Date: </b>' . $data->inv_date . '</td>                            </tr>                            <tr>                                <td align="left"><b>Class Start Date & Time: </b>' . date('d/m/Y h:i A',strtotime($data->class_start_datetime)) . '</td>                            </tr>                             <tr>                                <td align="left"><b>Class End Date & Time: </b>' . date('d/m/Y h:i A',strtotime($data->class_end_datetime)) . '</td>                            </tr>                            <tr>                                <td align="left">&nbsp;&nbsp;&nbsp;</td>                            </tr>                            <tr>                                <td width="100%" align="right">                                    <table width="100%" align="left">                                    <tr><td colspan="2"><strong><u>Company Details:</u></strong></td></tr>                                        <tr>                                            <td width="20%">                                                Address :                                             </td>                                            <td width="80%" align="left">                                            ' . $data->company_details->comp_address . '<br>                                            ' . $data->company_details->comp_city . ' ' . $data->company_details->comp_state . ' ' . $data->company_details->comp_cntry . ' ' . $data->company_details->comp_zip . '                                            </td>                                        </tr>                                        <tr>                                            <td>                                                Contact No :                                             </td>                                            <td align="left">                                            ' . $data->company_details->comp_phone . '                                            </td>                                        </tr>                                        <tr>                                            <td>                                                Attention :                                             </td>                                            <td align="left">                                            ' . $data->company_name . '                                            </td>                                        </tr>                                        <tr>                                            <td>                                                &nbsp;                                            </td>                                            <td>                                            (ACCOUNT DEPT)                                            </td>                                        </tr>                                        <tr>                                            <td>                                                Contact Perosn :                                             </td>                                            <td align="left">                                            ' . $data->company_person_name . '                                            </td>                                        </tr>                                    </table>                                </td>                            </tr>                        </table>                    </td>                    <td width="35%">                        <table align="right">                        <tr>                            <td>' .            $pdf->Image(FCPATH . 'logos/' . $data->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false)            . '</td>                        </tr>                            <tr>                                <td>' . $data->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $data->tenant_address . '<br>'                                     .$data->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $data->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $data->tenant_email_id . '</td>                            </tr>'.$comp_label.$gst_label.'                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    // /////below code added by shubhranshu to fix the nan issue & class unit fee issue///////////////$feeees = $data->total_unit_fees ? (number_format(($data->total_unit_fees / count($data->payment_due_details)), 2, '.', '')) : '0.00' ;$discnt = $data->total_unit_fees ? (number_format(($data->total_inv_discnt/count($data->payment_due_details)), 2, '.', '')) : '0.00';/////////////////////shubhranshu code end////////////////////////////////$tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                    <thead>                        <tr>                            <th align="center">Qty</th>                            <th align="center">Description</th>                            <th align="center">Unit Price</th>                            <th align="center">Total</th>                        </tr>                        </thead>                        <tbody>                        <tr>                            <td>'.sprintf("%02s", count($data->payment_due_details)).'</td>                            <td>' . $data->crse_name . ' (' . $data->course_id . '), ' . $data->class_name . ' (' . $class_or_course_runid . ')</td>                            <td>$ ' .$feeees . '</td>                            <td>$ ' . number_format($data->total_unit_fees, 2, '.', '') . '</td>                        </tr>                        <tr>                            <td>&nbsp;</td>                            <td>' . $data->discount_label . ' Discount @ ' . number_format($data->discount_rate, 2, '.', '') . '%</td>                            <td>$ ' .$discnt . '</td>                            <td>$ ' . number_format($data->total_inv_discnt, 2, '.', '') . '</td>                        </tr>                        <tr>                            <td colspan="3" align="right" class="td_heading">After Discounts</td>                            <td>$ ' . number_format(($data->total_unit_fees - $data->total_inv_discnt), 2, '.', '') . '</td>                        </tr>                        <tr>';    if ($data->total_gst != 0) {        $tbl .='<td colspan="3" align="right" class="td_heading">                    GST (' . number_format($data->gst_rate, 2, '.', '') . '%)                </td>                <td>                    $ ' . number_format($data->total_gst, 2, '.', '') . '                </td>                </tr>                <tr>                    <td colspan="3" align="right" class="td_heading">' . $data->gst_label . '</td>                    <td>$ ' . number_format((($data->total_unit_fees - $data->total_inv_discnt) + $data->total_gst), 2, '.', '') . '</td>                </tr>';    } else {        $tbl .='<td colspan="3" align="right" class="td_heading">                    GST OFF                 </td>                <td>$ 0.00</td>                </tr>                <tr>                    <td colspan="3" align="right" class="td_heading">GST Not Applicable</td>                    <td>$ ' . number_format(($data->total_unit_fees - $data->total_inv_discnt), 2, '.', '') . '</td>                </tr>';    }    $tbl .='                              <tr>                            <td>'.sprintf("%02s", count($data->payment_due_details)).'</td>                            <td>'.$subsidy_amount.'</td>                            <td>$ ' . number_format($data->total_inv_subsdy, 2, '.', '') . '</td>                            <td>$ ' . number_format($data->total_inv_subsdy, 2, '.', '') . '</td>                        </tr>                        <tr class="info">                            <td colspan="3" align="right" class="td_heading">INVOICE AMOUNT</td>                            <td>$ ' . number_format($data->total_inv_amount, 2, '.', '') . '</td>                                                        </tr>                        </tbody>                    </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Particulars of Participants';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                    <thead>                        <tr>                            <th align="center">Name</th>                            <th align="center">NRIC</th>                            <th align="center">TG#</th>                            <th align="center">'.$subsidy_amount.'</th>                            <th align="center">' . $data->discount_label . ' Discount @ ' . number_format($data->discount_rate, 2, '.', '') . '%</th>                            <th align="center">GST @ ' . number_format($data->gst_rate, 2, '.', '') . '% (' . $data->gst_label . ')</th>                            <th align="center">Inv. Amt.</th>                            <th align="center">Remarks</th>                        </tr>                    </thead>                    <tbody>';     if($data->total_inv_amount>0)    {    foreach ($data->payment_due_details as $row) {        $extra_name = ($data->class_name != $row->class_name) ? '<span style="color:green"> **</span><br/><span style="color:green">(' . $row->class_name . ')</span>' : '';              if($row->payment_label!='PAID'){                $out_standing_amt+= number_format($row->total_amount_due, 2, '.', '');        }        $tbl .='<tr>                    <td align="center">' . $row->first_name . ' ' . $row->last_name . $extra_name . '</td>                    <td align="center">' . mask_format($row->tax_code) . '</td>                    <td align="center">' . $row->tg_number . '</td>                    <td align="center">$ ' . number_format($row->subsidy_amount, 2, '.', '') . '</td>                    <td align="center">$ ' . number_format($data->indi_disc_total, 2, '.', '') . '</td>                    <td align="center">$ ' . number_format($row->gst_amount, 2, '.', '') . '</td>                    <td align="center">$ ' . number_format($row->total_amount_due, 2, '.', '') . '</td>                    <td align="center">' . $row->payment_label . '</td>                </tr>';            }                        $outstanding_amount=number_format($data->payble_amount, 2, '.', '');            if($outstanding_amount <= 0)            {             $outstanding_amount = '00.00';            }                        if($out_standing_amt==""){$out_standing_amt=0.00;}             $tbl.='<tr>                    <td colspan="4"></td>                    <td colspan="2" align="center">OUTSTANDING AMOUNT</td>                    <td align="center">$ '.$outstanding_amount.'</td>                    <td align="center"></td>                    </tr>';    }     else    {        $tbl .='<tr>                        <td align="center" colspan="8">No trainee Present in this Class. </td>                                           </tr>';    }    $tbl .='</tbody>                </table>                        <div>';          /* if($prev_invid) commented to hide the wording previous invoice            {                                  $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                   $tbl .='<tr border="none">                        <td align="left" colspan="7"><b> This invoice is to replace the Previous Invoice Number - '.$prev_invid.' </b></td>                        <td align="left" colspan="1"><b> Approved By</b> </td>                        </tr>';                  $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';                            }  else {                      $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                       $tbl .='<tr><td align="left" colspan="7"></td>                            <td align="left" colspan="1"> <b> Approved By</b></td></tr>';                                       $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';                }*/                $tbl .='<tr><td align="center" colspan="8"> </td></tr>';               if($data->tenant_id != 'T02' && $data->tenant_id != 'T12') {                    $tbl .='<tr><td align="left" colspan="7"></td>                            <td align="left" colspan="1"> <b> Approved By</b></td></tr>';                                       $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';      }          $tbl.=' ';    $tbl .='</tbody>                </table>                <div>                 <span style="color:red;"><i>** All $ values are in SGD.</i></span>                </div>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<span style="color:red;"><i>This is a computer generated invoice. No signature is required - ' . $data->tenant_name . ' Administrator.</i></span><div style="color:red;">' . html_entity_decode($data->invoice_footer_text) . '</div>';       $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($data->inv_year.'_'.$data->invoice_id.''.$data->invoice_label.'.pdf', 'D');}///added by shubhranshu for everest pdf download for companyfunction generate_company_pdf_invoice_everest($data) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = $data->invoice_name;    $comp_label ="";    $gst_label="";    if($data->invoice_name == "Tax Invoice") {                    $comp_label ='<tr><td>UEN Reg. No.: ' . $data->comp_reg_no . '</td></tr>';        if($data->total_gst != 0) {                         $gst_label ='<tr><td>GST Reg. No.: ' . $data->gst_reg_no . '</td></tr>';        }    }       foreach ($data->previous_inv_id as $row)    {        $prev_invid=$row->previous_inv_id;    }         /*skm code start */        if($data->tenant_id == 'T02' || $data->tenant_id == 'T12' || $data->tenant_id == 'T01' || $data->tenant_id == 'T17')        {            $subsidy_amount = 'SkillsFuture Funding Subsidy Amount';        }else{             $subsidy_amount = 'Course Fee Subsidy';        }        /*skm code end */        $pdf->Write(0, strtoupper($info), '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%" >                        <table>                            <tr>                                <td align="left"><b style="font-size:10px">' . $data->invoice_name . ' No: </b>' . $data->invoice_id . $data->invoice_label . '</td>                            </tr>                            <tr>                                <td align="left"><b>' . $data->invoice_name . ' Date: </b>' . $data->inv_date . '</td>                            </tr>                            <tr>                                <td align="left"><b>Class Start Date & Time: </b>' . date('d/m/Y h:i A',strtotime($data->class_start_datetime)) . '</td>                            </tr>                             <tr>                                <td align="left"><b>Class End Date & Time: </b>' . date('d/m/Y h:i A',strtotime($data->class_end_datetime)) . '</td>                            </tr>                            <tr>                                <td align="left">&nbsp;&nbsp;&nbsp;</td>                            </tr>                             <tr>                                <td align="left"><b style="font-size:9px">Company Name : </b>' . $data->company_name . '</td>                            </tr>                             <tr>                                <td align="left"><b style="font-size:9px">Company Address: </b>' . $data->company_details->comp_address . '                                            ' . $data->company_details->comp_city . ' ' . $data->company_details->comp_state . ' ' . $data->company_details->comp_cntry . ' ' . $data->company_details->comp_zip . '</td>                            </tr>                             <tr>                                <td align="left"><b style="font-size:9px">Contact Person: </b>' . $data->company_person_name . '</td>                            </tr>                             <tr>                                <td align="left"><b style="font-size:9px">Contact Number: </b>' . $data->company_details->comp_phone . '</td>                            </tr>                                                                                                                                                        </table>                    </td>                    <td width="35%">                        <table align="right">                        <tr>                            <td>' .            $pdf->Image(FCPATH . 'logos/' . $data->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false)            . '</td>                        </tr>                            <tr>                                <td>' . $data->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $data->tenant_address . '<br>'                                     .$data->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $data->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $data->tenant_email_id . '</td>                            </tr>'.$comp_label.$gst_label.'                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    // /////below code added by shubhranshu to fix the nan issue & class unit fee issue///////////////$feeees = $data->total_unit_fees ? (number_format(($data->total_unit_fees / count($data->payment_due_details)), 2, '.', '')) : '0.00' ;$discnt = $data->total_unit_fees ? (number_format(($data->total_inv_discnt/count($data->payment_due_details)), 2, '.', '')) : '0.00';/////////////////////shubhranshu code end////////////////////////////////$tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                    <thead>                        <tr>                            <th align="center">Qty</th>                            <th align="center">Description</th>                            <th align="center">Unit Price</th>                            <th align="center">Total</th>                        </tr>                        </thead>                        <tbody>                        <tr>                            <td>'.sprintf("%02s", count($data->payment_due_details)).'</td>                            <td>' . $data->crse_name . ' (' . $data->course_id . '), ' . $data->class_name . ' (' . $data->class_id . ')</td>                            <td> $ ' .$feeees . '</td>                            <td> $ ' . number_format($data->total_unit_fees, 2, '.', '') . '</td>                        </tr>                                                                        <tr>';    if ($data->total_gst != 0) {        $tbl .='<td colspan="3" align="right" class="td_heading">GST (' . number_format($data->gst_rate, 2, '.', '') . '%)</td>                <td> $ '. number_format($data->total_gst, 2, '.', '') . '</td>                </tr>                <tr>                    <!--<td colspan="3" align="right" class="td_heading">' . $data->gst_label . '</td>-->                    <td colspan="3" align="right" class="td_heading">Course Fee Before Subsidy</td>                    <td> $ ' . number_format((($data->total_unit_fees - $data->total_inv_discnt) + $data->total_gst), 2, '.', '') . '</td>                </tr>';    } else {        $tbl .='<td colspan="3" align="right" class="td_heading">                    GST OFF                 </td>                <td> $ 0.00</td>                </tr>                <tr>                    <td colspan="3" align="right" class="td_heading">GST Not Applicable</td>                    <td>$ ' . number_format(($data->total_unit_fees - $data->total_inv_discnt), 2, '.', '') . '</td>                </tr>';    }            /////   start---below code added by shubhranshu to designand calculation for everest invoice///        $ci = & get_instance();        $ci->load->model('class_trainee_model');        $ci->load->model('class_trainee_model', 'ctm');        $paymnt_rcvd_detais = $ci->ctm->get_pymnt_rcvd_detailsforrpt_all($data->invoice_id);        $refund_rcvd_detais = $ci->ctm->get_refund_rcvd_detailsforrpt($data->invoice_id);        //print_r($data);exit;        //echo $paymnt_rcvd_detais->amount_recd.'----'.$refund_rcvd_detais->total;exit;;        $final_payment_recd = $paymnt_rcvd_detais->total - $refund_rcvd_detais->total;                $fetch_absent_trainees = $ci->ctm->fetch_absent_trainees($data->pymnt_due_id);        foreach ($fetch_absent_trainees as $dat){            $ress = $ci->ctm->get_ind_trainee_pymnt_rcvd_amt($data->invoice_id,$dat->user_id);            $absent_payment_paid_sum  = $sum + $ress->total;        }        $final_payment_recd = $final_payment_recd - $absent_payment_paid_sum;        //print_r($fetch_absent_trainees);exit;        $psymrntmode='';        $sfc_label='';        $sfc_label_value='';         $colspa= 4;         $final_payment_status='';           $sum_subsidy=0;        // print_r($data->payment_due_details);exit;        foreach ($data->payment_due_details as $row) {            $sum_subsidy += $row->subsidy_amount;        }                //if(($paymnt_rcvd_detais->mode_of_pymnt == 'CHQ' || $paymnt_rcvd_detais->mode_of_pymnt == 'CASH') && $final_payment_status == 'PAID'){            $py_label ='Payment By Cash/Cheque';            $psymrntmode =' <tr>                                        <td colspan="3" align="right" class="td_heading">'.$py_label.'</td>                                        <td> $ ' . number_format($final_payment_recd,2,'.','') . '</td>                </tr>';                                    $colspa= 5;        //}             /////   end---below code added by shubhranshu to designand calculation for everest invoice///        $payment_made_header = ' <th align="center">Payment Made</th>';                   $tbl .='<tr>                                                <td colspan="3" align="right" class="td_heading">'.$subsidy_amount.'</td>                            <td> $ ' . number_format($sum_subsidy,2,'.','') . '</td>                        </tr>                                                      <tr class="info">                            <td colspan="3" align="right" class="td_heading">Net Fee Payable After Subsidy</td>                            <td> $ ' . number_format($data->total_inv_amount, 2, '.', '') . '</td>                                                        </tr>                        <tr><td colspan="5"></td></tr>                        '.$psymrntmode.'                        </tbody>                    </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Particulars of Participants';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                    <thead>                        <tr>                            <th align="center">Name</th>                            <th align="center">NRIC</th>                            <th align="center">TG#</th>                            <th align="center">Full Course Fee With GST</th>                            <th align="center">'.$subsidy_amount.'</th>                            <th align="center">Inv. Amt.</th>                            <!--<th align="center">GST @ ' . number_format($data->gst_rate, 2, '.', '') . '% (' . $data->gst_label . ')</th>-->                            '.$payment_made_header.'                            <th align="center">Remarks</th>                        </tr>                    </thead>                    <tbody>';     if($data->total_inv_amount>0)    {    foreach ($data->payment_due_details as $row) {        $extra_name = ($data->class_name != $row->class_name) ? '<span style="color:green"> **</span><br/><span style="color:green">(' . $row->class_name . ')</span>' : '';              if($row->payment_label!='PAID'){            $out_standing_amt+= number_format($row->total_amount_due, 2, '.', '');            $payment_made_value ='<td align="center">$ 0.00</td>';        }else{            $trainee_paid_amt = $ci->ctm->get_ind_trainee_pymnt_rcvd_amt($data->invoice_id,$row->user_id);            $payment_made_value ='<td align="center">$ ' . number_format($trainee_paid_amt->total,2,'.','') .'</td>';         }                 $tbl .='<tr>                    <td align="center">' . $row->first_name . ' ' . $row->last_name . $extra_name . '</td>                    <td align="center">' . mask_format($row->tax_code) . '</td>                    <td align="center">' . $row->tg_number . '</td>                    <td align="center">$ ' . number_format(($feeees + $row->gst_amount), 2, '.', '') . '</td>                    <td align="center">$ ' . number_format($row->subsidy_amount, 2, '.', '') . '</td>                    <td align="center">$ ' . number_format($row->total_amount_due, 2, '.', '') . '</td>                    <!--<td align="center">$ ' . number_format($row->gst_amount, 2, '.', '') . '</td>-->                    '.$payment_made_value. '                    <td align="center">' . $row->payment_label . '</td>                </tr>';            }                        $outstanding_amount=number_format($data->payble_amount, 2, '.', '');            if($outstanding_amount <= 0)            {             $outstanding_amount = '00.00';            }                        if($out_standing_amt==""){$out_standing_amt=0.00;}             $tbl.='<tr>                    <td colspan="5"></td>                    <td colspan="2" align="center">OUTSTANDING AMOUNT</td>                    <td align="center">$ '.$outstanding_amount.'</td>                    <td align="center"></td>                    </tr>';    }     else    {        $tbl .='<tr>                        <td align="center" colspan="8">No trainee Present in this Class. </td>                                           </tr>';    }    $tbl .='</tbody>                </table>                        <div>';          /* if($prev_invid) commented to hide the wording previous invoice            {                                  $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                   $tbl .='<tr border="none">                        <td align="left" colspan="7"><b> This invoice is to replace the Previous Invoice Number - '.$prev_invid.' </b></td>                        <td align="left" colspan="1"><b> Approved By</b> </td>                        </tr>';                  $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';                            }  else {                      $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                       $tbl .='<tr><td align="left" colspan="7"></td>                            <td align="left" colspan="1"> <b> Approved By</b></td></tr>';                                       $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';                }*/                $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                       $tbl .='<tr><td align="left" colspan="7"></td>                            <td align="left" colspan="1"> <b> </b></td></tr>';                                       $tbl .='<!--<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>-->';            $tbl.=' ';    $tbl .='<div style="color:red;"><b>Remarks: </b></div><div style="color:red;">'                       . '<i>(i). If you are using your skillsfuture credit to pay the net fees, please submit your claim at www.skillsfuture.sg/credit before course start date.</i></div>                        <div style="color:red;"><i>(ii). Kindly pay by cheque to "EVEREST INNOVATION PTE LTD" or via electronic fund transfer to bank details as follows :</i></div>                </div>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<div style="color:red;">' . html_entity_decode($data->invoice_footer_text) . '</div>';       $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($data->invoice_id.''.$data->invoice_label.'.pdf', 'D');}/** * function to generate individual pdf *////added by shubhranshu for everest pdf download for individualfunction generate_pdf_invoice_everest($result) {    $data = $result['data'];        //print_r($data);exit;    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = $result['data']->invoice_name;    $comp_label ="";    $gst_label="";    $acct_dep_label = ($data->inv_type == 'INVINDV') ? '' : '(ACCOUNT DEPT)';    if($data->invoice_name == "Tax Invoice") {                    $comp_label ='<tr><td>UEN Reg. No.: ' . $data->comp_reg_no . '</td></tr>';        if($data->total_gst != 0) {                         $gst_label ='<tr><td>GST Reg. No.: ' . $data->gst_reg_no . '</td></tr>';        }    }     foreach ($data->previous_inv_id as $row)    {        $prev_invid=$row->previous_inv_id;    }    $pdf->Write(0, strtoupper($info), '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $gender = ($data->gender == 'MALE') ? 'Mr. ' : 'Ms. ';    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        <table>                            <tr>                                <td align="left"><b style="font-size:10px">' . $result['data']->invoice_name . ' No: </b>' . $data->invoice_id . '</td>                            </tr>                            <tr>                                <td align="left"><b>' . $result['data']->invoice_name . ' Date: </b>' . $data->inv_date . '</td>                            </tr>                            <tr>                                <td align="left"><b>Class Start Date & Time: </b>' . date('d/m/Y h:i A', strtotime($data->class_start_datetime)) . '</td>                            </tr>                             <tr>                                <td align="left"><b>Class End Date & Time: </b>' . date('d/m/Y h:i A', strtotime($data->class_end_datetime)) . '</td>                            </tr>                            <tr>                                <td align="left">&nbsp;&nbsp;&nbsp;</td>                            </tr>                                                         <tr>                                <td align="left"><b style="font-size:9px">Attention : </b>' . $gender . $data->first_name . ' ' . $data->last_name .  '</td>                            </tr>                            <tr>                                <td align="left"><b>Contact No : </b>' . $data->contact_number . '</td>                            </tr>                            <tr>                                <td align="left"><b>Address : </b>'  . $data->personal_address_bldg .' ' .$data->personal_address_city . ' ' . $data->personal_address_state . ' ' . $data->personal_address_country . '</td>                            </tr>                                                                                </table>                    </td>                    <td width="35%" align="left">                        <table align="right" width="100%">                        <tr>                            <td>' .            $pdf->Image(FCPATH . 'logos/' . $result['data']->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false)            . '</td>                        </tr>                            <tr>                                <td>' . $data->tenant_name . '</td>                            </tr>                            <tr>                                    <td>' . $data->tenant_address . '<br>'                                             .$data->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $data->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $data->tenant_email_id . '</td>                            </tr>'.$comp_label.$gst_label.'                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                    <thead>                        <tr>                            <th align="center">Qty</th>                            <th align="center">Description</th>                            <th align="center">Unit Price</th>                            <th align="center">Total</th>                        </tr>                        </thead>                        <tbody>                        <tr>                            <td>01</td>                            <td>' . $data->crse_name . ' (' . $data->course_id . '), ' . $data->class_name . ' (' . $data->class_id . ')</td>                            <td> $ ' . $data->total_unit_fees . '</td>                            <td> $ ' . $data->total_unit_fees . '</td>                        </tr>                                                                       <tr>';    if ($data->total_gst != 0) {        $tbl .='<td colspan="3" align="right" class="td_heading">                    GST (' . number_format($data->gst_rate, 2, '.', '') . '%)                </td>                <td> $ ' . number_format($data->total_gst, 2, '.', '') . '                </td>                </tr>                <tr>                <!--<td colspan="3" align="right" class="td_heading">' . $data->gst_label . '</td>-->                    <td colspan="3" align="right" class="td_heading">Course Fee Before Subsidy</td>                    <td> $ '. number_format((($data->total_unit_fees - $data->total_inv_discnt) + $data->total_gst), 2, '.', '') . '</td>                </tr>';    } else {        $tbl .='<td colspan="3" align="right" class="td_heading">                    GST OFF                 </td>                <td> $ 0.00</td>                </tr>                <tr>                    <td colspan="3" align="right" class="td_heading">GST Not Applicable</td>                    <td> $ ' . number_format(($data->total_unit_fees - $data->total_inv_discnt), 2, '.', '') . '</td>                </tr>';    }        $total_inv_amount=$data->total_inv_amount;        /*skm code start */        if($data->tenant_id == 'T02' || $data->tenant_id == 'T12' || $data->tenant_id == 'T01' || $data->tenant_id == 'T17')        {            $subsidy_amount = 'SkillsFuture Funding Subsidy Amount';        }else{             $subsidy_amount = 'Course Fee Subsidy';        }        /*skm code end */        //added by shubhranshu for sfc claim id//        if($data->sfc_claim_id!=''){//            $sfctd = '<tr>//                    <td>SFC Claim Id</td>//                    <td>' . $data->sfc_claim_id . '</td>//                    <td class="td_heading">Skills Future Credit Claim</td>//                    <td>$ ' . $data->sfc_claimed . '</td>//                   </tr>';//        }else{//            $sfctd = '<tr>//                    <td colspan="3" align="right" class="td_heading">Skills Future Credit Claim</td>//                    <td>$ ' . $data->sfc_claimed . '</td>//                   </tr>';//        }//        $sfctd = '<tr>//                    <td colspan="3" align="right" class="td_heading">Skills Future Credit Claim</td>//                    <td>$ ' . $data->sfc_claimed . '</td>//                   </tr>';        ///////end of the code                /////   start---below code added by shubhranshu to designand calculation for everest invoice///        $ci = & get_instance();        $ci->load->model('class_trainee_model');        $ci->load->model('class_trainee_model', 'ctm');        $paymnt_rcvd_detais = $ci->ctm->get_pymnt_rcvd_detailsforrpt($data->invoice_id);        //$refund_rcvd_detais = $ci->ctm->get_refund_rcvd_detailsforrpt($data->invoice_id);        //print_r($paymnt_rcvd_detais);exit;        //$final_payment_recd = $paymnt_rcvd_detais->total - $refund_rcvd_detais->total;        $psymrntmode='';        $sfc_label='';        $sfc_label_value='';         $colspa= 4;        if(($paymnt_rcvd_detais->mode_of_pymnt == 'CHQ' || $paymnt_rcvd_detais->mode_of_pymnt == 'CASH') && $data->payment_status == 'PAID'){            $py_label ='Payment By Cash/Cheque';            $psymrntmode =' <tr>                                        <td colspan="3" align="right" class="td_heading">'.$py_label.'</td>                                        <td> $ ' . number_format($paymnt_rcvd_detais->amount_recd,2,'.','') . '</td>                </tr>';                                    $colspa= 4;        }elseif(($paymnt_rcvd_detais->othr_mode_of_pymnt == 'CHQ1' || $paymnt_rcvd_detais->othr_mode_of_pymnt == 'CASH1' || $paymnt_rcvd_detais->othr_mode_of_pymnt == 'GIRO1') && ($paymnt_rcvd_detais->mode_of_pymnt == 'SFC_SELF' || $paymnt_rcvd_detais->mode_of_pymnt == 'SFC_ATO') && $data->payment_status == 'PAID'){            $py_label ='Payment By Cash/Cheque';            $psymrntmode =' <tr>                                        <td colspan="3" align="right" class="td_heading">'.$py_label.'</td>                                        <td> $ ' . number_format($paymnt_rcvd_detais->amount_recd,2,'.','') . '</td>                </tr>';                        $sfc_label='<th align="center">SFC('.$data->mode_of_pymnt.') Claimed</th>';            $sfc_label_value='<td align="center"> $ '.$data->sfc_claimed.'</td>';            $colspa= 5;        }elseif(($paymnt_rcvd_detais->mode_of_pymnt == 'SFC_SELF' || $paymnt_rcvd_detais->mode_of_pymnt == 'SFC_ATO') && $data->payment_status == 'PAID'){            $py_label ='Payment By Cash/Cheque';            $sfcc_label = 'Payment By SFC';            $psymrntmode =' <tr>                                        <td colspan="3" align="right" class="td_heading">'.$py_label.'</td>                                        <td> $ ' . number_format($paymnt_rcvd_detais->other_amount_recd,2,'.','') . '</td>                </tr><tr>                                        <td colspan="3" align="right" class="td_heading">'.$sfcc_label.'</td>                                        <td> $ ' . number_format($paymnt_rcvd_detais->sfc_claimed,2,'.','') . '</td>                </tr>';                        $sfc_label='<th align="center">SFC('.$data->mode_of_pymnt.') Claimed</th>';            $sfc_label_value='<td align="center"> $ '.$data->sfc_claimed.'</td>';            $colspa= 5;        }elseif($paymnt_rcvd_detais->mode_of_pymnt == 'PSEA' && $data->payment_status == 'PAID'){            $py_label ='Payment By PSEA';            $psymrntmode =' <tr>                                        <td colspan="3" align="right" class="td_heading">'.$py_label.'</td>                                        <td> $ ' . number_format($paymnt_rcvd_detais->amount_recd,2,'.','') . '</td>                </tr>';                                    $colspa= 5;        }else{            $py_label ='Payment By Cash/Cheque';            $psymrntmode =' <tr>                                        <td colspan="3" align="right" class="td_heading">'.$py_label.'</td>                                        <td> $ 0.00 </td>                </tr>';                                    $colspa= 5;        }                       //if($paymnt_rcvd_detais->amount_recd > 0 && $data->payment_label !='REFUNDED'){        $payment_made_header = ' <th align="center">Payment Made</th>';        if($data->payment_label =='REFUNDED'){                $payment_made_value ='<td align="center">$ 0.00</td>';        }else{            $payment_made_value ='<td align="center">$ ' . number_format($paymnt_rcvd_detais->amount_recd,2,'.','') .'</td>';         }                       /////   end---below code added by shubhranshu to designand calculation for everest invoice///               $tbl .='<tr>                                        <td colspan="3" align="right" class="td_heading">'.$subsidy_amount.'</td>                                        <td> $ ' . $data->total_inv_subsdy . '</td>                </tr>                                <tr class="info">                    <td colspan="3" align="right" class="td_heading">Net Fee Payable After Subsidy</td>                    <td> $ ' . number_format($total_inv_amount,2,'.',''). '</td>                                    </tr>                <tr><td colspan="5"></td></tr>                '.$psymrntmode.'            </tbody>        </table>';           $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Particulars of Participants';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                    <thead>                        <tr>                            <th align="center">Name</th>                            <th align="center">NRIC</th>                            <th align="center">TG#</th>                            <th align="center">Full Course Fee With GST</th>                            <th align="center">'.$subsidy_amount.'</th>                            <th align="center">Inv. Amt.</th>                            '.$payment_made_header.'                            <th align="center">Remarks</th>                        </tr>                    </thead>                    <tbody>';                                            $tbl.= '<tr>                                    <td align="center">' . $data->first_name . ' ' . $data->last_name . '</td>                                    <td align="center">' . mask_format($data->tax_code) . '</td>                                    <td align="center">' . $data->tg_number . '</td>                                    <td align="center">$ ' . number_format(($data->total_unit_fees + $data->gst_amount),2,'.','') . '</td>';                                                                        if($data->total_inv_amount==0)                                    {                                        $data->total_amount_due=0;                                    }                                    if($total_inv_amount==0.00){                                        $data->payment_label='PAID';                                    }                                    ///$total_amount_due= number_format($data->total_amount_due, 2, '.', '') - $data->sfc_claimed;                                    $tbl .='                                    <td align="center">$ ' . $data->total_inv_subsdy . '</td>                                    <td align="center">$ ' . number_format($total_inv_amount,2,'.','') . '</td>'.$payment_made_value;                                    $data->payble1=$data->payble;                                    if($data->att_status=='0'){ $noti="(ABS)";$data->payble1=0;}                                     $outstanding_amt=number_format($data->payble1, 2, '.', '');                                    $tbl.='<td align="center">'.$data->payment_label.''."".$noti.'</td>                                </tr>';                        $tbl.= '<tr>                                    <td colspan="'.$colspa.'"></td>                                    <td colspan="2" align="center">OUTSTANDING AMOUNT</td>                                    <td align="center">$ '.$outstanding_amt.'</td>                                    <td align="center"></td>                                </tr>';                        if($data->att_status=='0' && $data->payment_label=='PAID'){                        $tbl.= '<tr>                                    <td colspan="'.$colspa.'"></td>                                    <td colspan="2" align="center">REFUNDABLE AMOUNT</td>                                    <td align="center">$ '.number_format($data->paid_rcd_till_date, 2, '.', '').'</td>                                    <td align="center"></td>                        </tr>';}//                    }//                   else{//                        $tbl .='<tr>//                        <td align="center" colspan="8">No trainee Present in this Class. </td>//                       //                    </tr>';//                   }                   $tbl.=' </tbody>                    </table>';          /*  if($prev_invid) //comented to hide wording previous invoice number 14-07-2016            {                                  $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                   $tbl .='<tr border="none">                        <td align="left" colspan="7"><b> This invoice is to replace the Previous Invoice Number - '.$prev_invid.' </b></td>                        <td align="left" colspan="1"><b> Approved By</b> </td>                        </tr>';                  $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';                            }  else {                      $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                       $tbl .='<tr><td align="left" colspan="7"></td>                            <td align="left" colspan="1"> <b> Approved By</b></td></tr>';                                       $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';                }*/                         $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                                                                              if($data->att_status=='0'){ $noti="*";}               $data->att_status;                             $tbl.='<div style="color:red;"><b>Remarks: </b></div><div style="color:red;">'                       . '<i>(i). If you are using your skillsfuture credit to pay the net fees, please submit your claim at www.skillsfuture.sg/credit before course start date.</i></div>                        <div style="color:red;"><i>(ii). Kindly pay by cheque to "EVEREST INNOVATION PTE LTD" or via electronic fund transfer to bank details as follows :</i></div>                                          </div>';        $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '            <div style="color:red;">' . html_entity_decode($data->invoice_footer_text) . '</div>';       $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($data->invoice_id.''.$data->invoice_label.'.pdf', 'D');}function generate_pdf_invoice($result) {    $data = $result['data'];        $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = $result['data']->invoice_name;    $comp_label ="";    $gst_label="";        if(TENANT_ID=='T02'){//// added by shubhranshu on 31-mar-2021 as per client requirement        $class_or_course_runid= $data->tpg_course_run_id ? $data->tpg_course_run_id : 'NA';    }else{        $class_or_course_runid= $data->class_id;    }        if($data->invoice_name == "Tax Invoice") {                    $comp_label ='<tr><td>Reg. No.: ' . $data->comp_reg_no . '</td></tr>';        if($data->total_gst != 0) {                         $gst_label ='<tr><td>GST Reg. No.: ' . $data->gst_reg_no . '</td></tr>';        }    }     foreach ($data->previous_inv_id as $row)    {        $prev_invid=$row->previous_inv_id;    }    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $gender = ($data->gender == 'MALE') ? 'Mr. ' : 'Ms. ';    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        <table>                            <tr>                                <td align="left"><b>' . $result['data']->invoice_name . ' No: </b>' . $data->inv_year . ' ' . $data->invoice_id . '</td>                            </tr>                            <tr>                                <td align="left"><b>' . $result['data']->invoice_name . ' Date: </b>' . $data->inv_date . '</td>                            </tr>                            <tr>                                <td align="left"><b>Class Start Date & Time: </b>' . date('d/m/Y h:i A', strtotime($data->class_start_datetime)) . '</td>                            </tr>                             <tr>                                <td align="left"><b>Class End Date & Time: </b>' . date('d/m/Y h:i A', strtotime($data->class_end_datetime)) . '</td>                            </tr>                            <tr>                                <td align="left">&nbsp;&nbsp;&nbsp;</td>                            </tr>                            <tr>                                <td width="100%" align="right">                                    <table width="100%" align="left">                                        <tr><td colspan="2"><strong><u>Individual Details:</u></strong></td></tr>                                        <tr>                                            <td width="20%">                                                Address :                                             </td>                                            <td width="80%">                                            ' . $data->personal_address_bldg . '<br> &nbsp;' .            $data->personal_address_city . ' ' . $data->personal_address_state . ' ' . $data->personal_address_country . '                                            </td>                                        </tr>                                        <tr>                                            <td>                                                Contact No :                                             </td>                                            <td>                                            ' . $data->contact_number . '                                            </td>                                        </tr>                                        <tr>                                            <td>                                                Attention :                                             </td>                                            <td>                                            ' . $gender . $data->first_name . ' ' . $data->last_name . '                                            </td>                                        </tr>                                        <tr>                                            <td>                                                &nbsp;                                            </td>                                            <td>                                            (ACCOUNT DEPT)                                            </td>                                        </tr>                                    </table>                                </td>                            </tr>                        </table>                    </td>                    <td width="35%" align="left">                        <table align="right" width="100%">                        <tr>                            <td>' .            $pdf->Image(FCPATH . 'logos/' . $result['data']->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false)            . '</td>                        </tr>                            <tr>                                <td>' . $data->tenant_name . '</td>                            </tr>                            <tr>                                    <td>' . $data->tenant_address . '<br>'                                             .$data->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $data->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $data->tenant_email_id . '</td>                            </tr>'.$comp_label.$gst_label.'                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                    <thead>                        <tr>                            <th align="center">Qty</th>                            <th align="center">Description</th>                            <th align="center">Unit Price</th>                            <th align="center">Total</th>                        </tr>                        </thead>                        <tbody>                        <tr>                            <td>01</td>                            <td>' . $data->crse_name . ' (' . $data->course_id . '), ' . $data->class_name . ' (' . $class_or_course_runid . ')</td>                            <td>$ ' . $data->total_unit_fees . '</td>                            <td>$ ' . $data->total_unit_fees . '</td>                        </tr>                        <tr>                            <td>&nbsp;</td>                            <td>' . $data->discount_label . ' Discount @ ' . $data->discount_rate . '%</td>                            <td>$ ' . $data->total_inv_discnt . '</td>                            <td>$ ' . $data->total_inv_discnt . '</td>                        </tr>                        <tr>                            <td colspan="3" align="right" class="td_heading">After Discounts</td>                            <td>$ ' . number_format(($data->total_unit_fees - $data->total_inv_discnt), 2, '.', '') . '</td>                        </tr>                        <tr>';    if ($data->total_gst != 0) {        $tbl .='<td colspan="3" align="right" class="td_heading">                    GST (' . number_format($data->gst_rate, 2, '.', '') . '%)                </td>                <td>                    $ ' . number_format($data->total_gst, 2, '.', '') . '                </td>                </tr>                <tr>                    <td colspan="3" align="right" class="td_heading">' . $data->gst_label . '</td>                    <td>$ ' . number_format((($data->total_unit_fees - $data->total_inv_discnt) + $data->total_gst), 2, '.', '') . '</td>                </tr>';    } else {        $tbl .='<td colspan="3" align="right" class="td_heading">                    GST OFF                 </td>                <td>$ 0.00</td>                </tr>                <tr>                    <td colspan="3" align="right" class="td_heading">GST Not Applicable</td>                    <td>$ ' . number_format(($data->total_unit_fees - $data->total_inv_discnt), 2, '.', '') . '</td>                </tr>';    }        $total_inv_amount=$data->total_inv_amount- $data->sfc_claimed;        /*skm code start */        if($data->tenant_id == 'T02' || $data->tenant_id == 'T12' || $data->tenant_id == 'T01')        {            $subsidy_amount = 'SkillsFuture Funding Subsidy Amount';        }else{             $subsidy_amount = 'Subsidy Amount';        }        /*skm code end */        //added by shubhranshu for sfc claim id//        if($data->sfc_claim_id!=''){//            $sfctd = '<tr>//                    <td>SFC Claim Id</td>//                    <td>' . $data->sfc_claim_id . '</td>//                    <td class="td_heading">Skills Future Credit Claim</td>//                    <td>$ ' . $data->sfc_claimed . '</td>//                   </tr>';//        }else{//            $sfctd = '<tr>//                    <td colspan="3" align="right" class="td_heading">Skills Future Credit Claim</td>//                    <td>$ ' . $data->sfc_claimed . '</td>//                   </tr>';//        }        ///////end of the code                $tbl .='<tr>                    <td>01</td>                    <td>'.$subsidy_amount.'</td>                    <td>$ ' . $data->total_inv_subsdy . '</td>                    <td>$ ' . $data->total_inv_subsdy . '</td>                </tr>                <tr>                    <td colspan="3" align="right" class="td_heading">Skills Future Credit Claim</td>                    <td>$ ' . $data->sfc_claimed . '</td>                </tr>                <tr class="info">                    <td colspan="3" align="right" class="td_heading">INVOICE AMOUNT</td>                    <td>$ ' . number_format($total_inv_amount,2,'.',''). '</td>                    <td>$ ' . $total_inv_amount. '</td>                </tr>            </tbody>        </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Particulars of Participants';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                    <thead>                        <tr>                            <th align="center">Name</th>                            <th align="center">NRIC</th>                            <th align="center">TG#</th>                            <th align="center">'.$subsidy_amount.'</th>                            <th align="center">' . $data->discount_label . ' Discount @ ' . $data->discount_rate . '%</th>                            <th align="center">GST @ ' . $data->gst_rate . '% (' . $data->gst_label . ')</th>                            <th align="center">SFC('.$data->mode_of_pymnt.') Claimed</th>                            <th align="center">Inv. Amt.</th>                                                      <th align="center">Remarks</th>                        </tr>                    </thead>                    <tbody>';                    //                    if(number_format($total_inv_amount,2,'.','')>0.00)//                    {                        $tbl.= '<tr>                                    <td align="center">' . $data->first_name . ' ' . $data->last_name . '</td>                                    <td align="center">' . mask_format($data->tax_code) . '</td>                                    <td align="center">' . $data->tg_number . '</td>                                    <td align="center">$ ' . $data->total_inv_subsdy . '</td>                                    <td align="center">$ ' . $data->total_inv_discnt . '</td>                                    <td align="center">$ ' . number_format($data->gst_amount, 2, '.', '') . '</td>                                    <td align="center">$ '.$data->sfc_claimed.'</td>';                                    if($data->total_inv_amount==0)                                    {                                        $data->total_amount_due=0;                                    }                                    if($total_inv_amount==0.00){                                        $data->payment_label='PAID';                                    }                                    $total_amount_due= number_format($data->total_amount_due, 2, '.', '') - $data->sfc_claimed;                                    $tbl .='<td align="center">$ ' . number_format($total_amount_due,2,'.','') . '</td>';                                    $data->payble1=$data->payble;                                    if($data->att_status=='0'){ $noti="(ABS)";$data->payble1=0;}                                     $outstanding_amt=number_format($data->payble1, 2, '.', '');                                    $tbl.='<td align="center">'.$data->payment_label.''."".$noti.'</td>                                </tr>';                        $tbl.= '<tr>                                    <td colspan="5"></td>                                    <td colspan="2" align="center">OUTSTANDING AMOUNT</td>                                    <td align="center">$ '.$outstanding_amt.'</td>                                    <td align="center"></td>                                </tr>';                        if($data->att_status=='0' && $data->payment_label=='PAID'){                        $tbl.= '<tr>                                    <td colspan="5"></td>                                    <td colspan="2" align="center">REFUNDABLE AMOUNT</td>                                    <td align="center">$ '.number_format($data->paid_rcd_till_date, 2, '.', '').'</td>                                    <td align="center"></td>                        </tr>';}//                    }//                   else{//                        $tbl .='<tr>//                        <td align="center" colspan="8">No trainee Present in this Class. </td>//                       //                    </tr>';//                   }                   $tbl.=' </tbody>                    </table>';          /*  if($prev_invid) //comented to hide wording previous invoice number 14-07-2016            {                                  $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                   $tbl .='<tr border="none">                        <td align="left" colspan="7"><b> This invoice is to replace the Previous Invoice Number - '.$prev_invid.' </b></td>                        <td align="left" colspan="1"><b> Approved By</b> </td>                        </tr>';                  $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';                            }  else {                      $tbl .='<tr><td align="center" colspan="8"> </td></tr>';                       $tbl .='<tr><td align="left" colspan="7"></td>                            <td align="left" colspan="1"> <b> Approved By</b></td></tr>';                                       $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';                }*/                         $tbl .='<tr><td align="center" colspan="8"> </td></tr>';              if($data->tenant_id != 'T02' && $data->tenant_id != 'T12') {                    $tbl .='<tr><td align="left" colspan="7"></td>                            <td align="left" colspan="1"> <b> Approved By</b></td></tr>';                                       $tbl .='<tr>                           <td align="left" colspan="7"></td>                           <td align="left" colspan="1"><u style="color:black;"><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></td>                           </tr>';              }                           if($data->att_status=='0'){ $noti="*";}               $data->att_status;                             $tbl.='       <span style="color:red;"><i>**'.$noti.' All $ values are in SGD.</i></span>                   </div>';        $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<span style="color:red;"><i>This is a computer generated invoice. No signature is required - ' . $data->tenant_name . ' Administrator. </i></span>            <div style="color:red;">' . html_entity_decode($data->invoice_footer_text) . '</div>';        if($data->tenant_id == 'T24'){                $tbl .='<div style="text-align:right;">                            <span style="color:red;"><i>**To make the payment you may scan the below QR Code or enter PayNow UEN: 199300813RR31.</i></span>                            <img src="'. FCPATH .'logos/RLIS_PAYNOW_IMG.jpg" alt="PAYNOW">                        </div>';            }       $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($data->inv_year.'_'.$data->invoice_id.''.$data->invoice_label.'.pdf', 'D');}/** * function to generate payment Receipt */function generate_payment_receipt($result) {    $data = $result['data'];    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = 'Payment Receipt';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $result['data']->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $data->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $data->tenant_address . '<br>'                                    .$data->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $data->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $data->tenant_email_id . '</td>                            </tr>                            <tr><td>&nbsp;</td></tr>                            <tr>                                <td><strong>Receipt No.:</strong> ' . $data->inv_year . ' ' . $data->invoice_id . '</td>                            </tr>                            <tr>                                <td><strong>Receipt Date:</strong> ' . $result['invoice']->recd_on . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $p = '<p><font style="font-size:12px; font-weight:bold;">Received</font> with thanks SGD ' . number_format($result['invoice']->amount_recd, 2, '.', '') . ' from ' . $result['trainee'] . ' for <strong><i>\'Course: ' . $result['data']->crse_name . ', Class: ' . $result['data']->class_name . ', Certificate Code: ' . $result['data']->courseLevel . '\'</i></strong>.</p>';    $pdf->writeHTML($p, true, false, false, false, '');    $contact_details = '';    if (!empty($result['tenant']->contact_name)) {        $contact_details .=$result['tenant']->contact_name . ' ';    }    if (!empty($result['data']->tenant_contact_num)) {        $contact_details .='(Phone: ' . $result['data']->tenant_contact_num . ', ';    }    if (!empty($result['data']->tenant_email_id)) {        $contact_details .='Email Id: ' . $result['data']->tenant_email_id . ')';    }    $contact_details = rtrim($contact_details, ', ');    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tbody>            <tr>                <td width="25%" align="center">Class Start Date:</td>                <td align="center" width="75%" >' . $result['data']->class_start . '</td>            </tr>            <tr>                <td width="25%" align="center">Location:</td>                <td align="center" width="75%">' . $result['data']->ClassLoc . '</td>            </tr>            <tr>                <td width="25%" align="center">Contact Details:</td>                <td align="center" width="75%">' . $contact_details . '</td>            </tr>        </tbody>    </table>';       $pdf->writeHTML($tbl, true, false, false, false, '');    $sfcid ='';    if($result['data']->sfc_of_pymnt == "SELF" || $result['data']->sfc_of_pymnt == "ATO")    {        $sfcid ='        <tr>            <td align="center"><b>SFC Claim Id '.'</b></td>            <td align="center"><b> ' . $result['data']->sfc_claim_id . ' </b></td>        </tr>';        $mop= "(".$result['data']->sfc_of_pymnt.")";        if(!empty($result['data']->othr_mode_of_payment))        {            $amt_rcd=$result['data']->other_amount_recd;            if($result['data']->othr_mode_of_payment=='CASH1' || $result['data']->othr_mode_of_payment=='NETS1')            {//                $omp= "CASH";                   $omp = ($result['data']->othr_mode_of_payment=='CASH1')?'CASH' : 'NETS';                $other_paymnt_mode =' <tr><td align="center"><b>'.$omp.'</b></td><td align="center"><b>$ ' . $amt_rcd . ' SGD</b></td></tr>';            }            else if($result['data']->othr_mode_of_payment=='CHQ1')            {                 $omp= "CHEQUE";                 $other_paymnt_mode =' <tr><td align="center"><b>'.$omp.'</b></td><td align="center"><b>$ ' . $amt_rcd . ' SGD</b></td></tr>';            }            else if($result['data']->othr_mode_of_payment=='GIRO1')//////addded by shubhranshu to display the row            {                 $omp= "GIRO";                 $other_paymnt_mode =' <tr><td align="center"><b>'.$omp.'</b></td><td align="center"><b>$ ' . $amt_rcd . ' SGD</b></td></tr>';            }                    }             }    else    {        $omp=$result['data']->mode_of_pymnt;        $amt_rcd=$result['data']->amount_recd;        $other_paymnt_mode =' <tr><td align="center"><b>'.$omp.'</b></td><td align="center"><b>$ ' . $amt_rcd . ' SGD</b></td></tr>';    }/*skm code start */    if($data->tenant_id == 'T02' || $data->tenant_id == 'T12' || $data->tenant_id == 'T01')    {        $subsidy_amount = 'SkillsFuture Funding Subsidy Amount';    }else{         $subsidy_amount = 'Toatl Subsidy Amount';    }    /*skm code end */    $addon='';    if($data->tenant_id != 'T17'){        $addon = '<tr>            <td align="center"><b>Total Discount @ ' . $result['data']->discount_rate . '%</b></td>            <td align="center"><b>$ ' . $result['data']->total_inv_discnt . ' SGD</b></td>        </tr>';    }        $pdf->SetFont('helvetica','',8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <td align="center"><b>Invoice Id</b></td>            <td align="center"><b>' . $result['data']->invoice_id . '</b></td>        </tr>        <tr>            <td align="center"><b>Invoice Date</b></td>            <td align="center"><b>' . $result['data']->inv_date . '</b></td>        </tr>        <tr>            <td align="center"><b>Total Class Fees</b></td>            <td align="center"><b>$ ' . $result['data']->total_unit_fees . ' SGD</b></td>        </tr>        '.$addon.'         <tr>            <td align="center"><b>Total GST @ ' . $result['data']->gst_rate . '%</b></td>            <td align="center"><b>$ ' . $result['data']->total_gst . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>'.$subsidy_amount.'</b></td>            <td align="center"><b>$ ' . $result['data']->total_inv_subsdy . ' SGD</b></td>        </tr>        <tr>            <td align="center"><b>Skills Future Credit '.$mop.'</b></td>            <td align="center"><b>$ ' . $result['data']->sfc_claimed . ' SGD</b></td>        </tr>';                $tbl.= $other_paymnt_mode.'<tr>            <td align="center"><b>Payment Made On</b></td>            <td align="center"><b>' . $result['data']->recd_on . ' </b></td>        </tr>        <tr>            <td align="center"><b>Total Invoice Amount</b></td>            <td align="center"><b>$ ' . $result['data']->total_inv_amount . ' SGD</b></td>        </tr>        </table>        <p style="color:red;"><i>This is a computer generated receipt and doesn\'t require a seal or signature - ' . $data->tenant_name . ' Administrator.</i></p>';          $pdf->writeHTML($tbl, true, false, false, false, '');        $pdf->Output('payment_receipt.pdf', 'D');}/** * function to create PDF for Sales Assignment and Commission */function sales_report_PDF($query) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->helper('common');    $ci->load->model('meta_values', 'meta');    $meta_map = $ci->meta->get_param_map();    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = 'Sales Commision report as on ' . date('M j Y, l');    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center" width="26%"><b>Course Name-Class Name</b></th>            <th align="center" width="15%"><b>Sales Executive Name</b></th>            <th align="center" width="15%"><b>Commission Paid<br>(SGD)</b></th>            <th align="center" width="15%"><b>Commission Due<br>(SGD)</b></th>            <th align="center" width="15%"><b>Due Period</b></th>            <th align="center" width="14%"><b>Last Paid On</b></th>        </tr>';    foreach ($query['query']->result() as $row) {        $tbl .= '<tr>';        $tbl .= '<td>' . $row->name . '</td>';        $tbl .= '<td>' . $row->executive_name . '</td>';        $tbl .= '<td>' . $row->commision_paid . '</td>';        $tbl .= '<td>' . $row->commision_due . '</td>';        $tbl .= '<td align="center">' . $row->due_period . '</td>';        $tbl .= '<td align="center">' . date_format_singapore($row->last_payed) . '</td>';        $tbl .= '</tr>';    }    $tbl .= '</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('Sales_Commision_report.pdf', 'D');}function generate_booking_acknowledge_pdf($data, $tenant_details, $booking_no, $booking_date) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->SetFont('helvetica', '', 8);    $pdf->writeHTML('<br><br>', true, false, false, false, '');        $tbl = '<table width="100%" style="font-size:13px">                <tr>                    <td width="70%">                        &nbsp;                    </td>                    <td width="30%">                        <table align="right">                            <tr>                                <td>' . $pdf->Image(FCPATH . 'logos/' . $tenant_details->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false) . '</td>                            </tr>                            <tr>                                <td>' . $tenant_details->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant_details->tenant_address . '<br>'                                         .$tenant_details->tenant_country . '</td>                            </tr>                            <tr>                                <td><b>Booking No.: </b>&nbsp;&nbsp;' . $booking_no . '</td>                            </tr>                            <tr>                                <td><b>Booking Date: </b>' . $booking_date . '</td>                            </tr>                                                    </table>                    </td>                </tr>            </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    //$info = 'Booking Acknowledgment';    $info = '<div style="font-size:17px;text-align:center;">Booking Acknowledgment</div>';    //$pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->writeHTML($info, true, false, false, false, '');    $pdf->SetFont('helvetica', '', 8);    $tbl = $data;    $pdf->writeHTML($tbl, true, false, false, false, '');    $tbl = '<br><br><span style = "color:red;"><i>This is a computer generated acknowledgement and requires no signature - ' . $tenant_details->tenant_name . ' Administrator.</i></span>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('booking_acknowledge.pdf', 'D');}/** * function to create PDF for Payments Due */function export_payments_due_report_PDF($query) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->helper('common');    $ci->load->model('meta_values', 'meta');    $meta_map = $ci->meta->get_param_map();    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $info = 'Payments Due report as on ' . date('M j Y, l');    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th width="11%" align="center"><b>Course Name</b></th>            <th width="8%" align="center"><b>Class <br>Name</b></th>            <th width="13%" align="center"><b>Sales Executive Name</b></th>            <th width="9%" align="center"><b>NRIC/FIN No.</b></th>            <th width="11%" align="center"><b>Name</b></th>            <th width="9%" align="center"><b>Enrollment <br>Date</b></th>            <th width="8%" align="center"><b>Discount</b></th>            <th width="6%" align="center"><b>Subsidy</b></th>            <th width="6%" align="center"><b>GST</b></th>            <th width="8%" align="center"><b>Price</b></th>            <th width="11%" align="center"><b>Net Amt.</b></th>        </tr>';    $total = array(        'DISC' => 0,        'SABSIDY' => 0,        'GST' => 0,        'PRICE' => 0,        'NET_AMT' => 0    );    foreach ($query['query']->result() as $row) {        $tbl .= '<tr>';        $tbl .= '<td>' . $row->crse_name . '</td>';        $tbl .= '<td>' . $row->class_name . '</td>';        $tbl .= '<td>' . $row->exec_name . '</td>';        $tbl .= '<td>' . mask_format($row->tax_code) . '</td>';        $tbl .= '<td>' . $row->user_name . '</td>';        $tbl .= '<td align="center">' . date_format_singapore($row->enrolled_on) . '</td>';        $tbl .= '<td>' . $row->total_inv_discnt . '</td>';        $tbl .= '<td>' . $row->total_inv_subsdy . '</td>';        $tbl .= '<td>' . $row->total_gst . '</td>';        $tbl .= '<td>' . $row->total_unit_fees . '</td>';        $tbl .= '<td>' . $row->total_inv_amount . '</td>';        $tbl .= '</tr>';        $total['DISC'] += $row->total_inv_discnt;        $total['SABSIDY'] += $row->total_inv_subsdy;        $total['GST'] += $row->total_gst;        $total['PRICE'] += $row->total_unit_fees;        $total['NET_AMT'] += $row->total_inv_amount;    }    $tbl .=            "<tr>        <td></td>        <td></td>        <td></td>        <td></td>        <td></td>        <td>Total</td>        <td>\${$total['DISC']}</td>        <td>\${$total['SABSIDY']}</td>        <td>\${$total['GST']}</td>        <td>\${$total['PRICE']}</td>        <td>\${$total['NET_AMT']}</td>    </tr>";    $tbl .= '</table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('Payments_Due_report.pdf', 'D');}/** * function for LOC pdf */function generate_loc_pdf($data) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $data->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $data->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $data->tenant_address . '<br>'                                    . $data->tenant_country .'</td>                            </tr>                            <tr>                                <td>Tel :' . $data->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $data->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = ' WDA Training Partner for the \'' . $data->crse_name . ' - ' . $data->class_name . '\'';    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $gender = ($data->gender == "MALE") ? 'Mr. ' : 'Ms. ';    $name = $gender . $data->first_name . ' ' . $data->last_name;    if (!empty($data->exam_date)) {        $test_date = date('d/m/Y', strtotime($data->exam_date));    } else {        $test_date = date('d/m/Y', strtotime($data->class_end_datetime));    }    $tbl = '<p>&nbsp;</p><p><b>File Ref: </b></p>            <p><b>Trainee Ref:</b> ' . mask_format($data->tax_code) . '</p>            <p><b>Date: </b>' . date('d-m-Y') . '</p>            <p>To Whom it May Concern: </p>            <p><b>LETTER OF CERTIFICATION FOR ATTAINMENT OF SOA FOR THE \'' . $data->crse_name . ' - ' . $data->class_name . '\'</b></p>                <p>This letter serves to certify that <b><u>' . $name . '                (' . mask_format($data->tax_code) . ')</u></b>, has successfully completed the course             of study and certified competent in the ' .            $data->crse_name . ' - ' . $data->class_name . ' on             <b><u>' . $test_date . '</u></b> [TEST DATE].</p>            <p style="color:red;"><i>This is a computer generated report and doesn\'t require a seal or signature - ' . $data->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('LOC.pdf', 'D');}/*skm start : function for LOC new layout pdf */function generate_wsq_loc_pdf($data) {       $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $img_file = site_url('logos/company_stamp.png');    $img_file = '<img style="width: 130px;"  src="' .$img_file. '" />';        $left_logo = site_url('logos/SkillsFutureSG.png');    $left_logo = '<img style="width: 150px;" height="70px;"  src="' .$left_logo. '" />';    $right_logo = site_url('logos/wsg-header.png');    $right_logo = '<img style="width: 150px;" height="70px;" float="right;"  src="' .$right_logo. '" />';    //    $company_seal = site_url('logos/company_seal.png');//    $company_seal = '<img style="width: 130px;"  float="center;"  src="' .$company_seal. '" />';        $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);$tbl= '<table align="center" border="0" cellpadding="1" cellspacing="1" >            <tbody>                <tr>                                                                                                                  <td align="left">'.$left_logo.'</td>                   <td align="right">'.$right_logo.'</td>                </tr>                <tr>                    <td width="80%">                                       </td>													                    <td  width="20%" align="left">                         <div style="border:1px solid black;padding: 10px 5px; margin-left:20px;"><span>&nbsp;&nbsp;&nbsp;Version</span>&nbsp;<span>2</span>&nbsp;&nbsp;<span>(23 Aug 2018)</span></div>                    </td>                </tr>            </tbody>    </table>';								    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', '', 10);    $gender = ($data->gender == "MALE") ? 'Mr. ' : 'Ms. ';    $name = $gender . $data->first_name . ' ' . $data->last_name;    if (!empty($data->exam_date)) {        $test_date = date('d/m/Y', strtotime($data->exam_date));    } else {        $test_date = date('d/m/Y', strtotime($data->class_end_datetime));    }        $start_date = date('d-m-Y', strtotime($data->class_start_datetime));    $end_date = date('d-m-Y', strtotime($data->class_end_datetime));    /////added by shubhranshu for wab and everest separate view    if(TENANT_ID == 'T20' || TENANT_ID == 'T17'){        $tbl = '<table cellpadding="0" cellspacing="0">                        <tbody>                                                       <tr>                                <td style="font-family:Helvetica,arial,sans-serif;font-size:14px;text-align:justify;line-height:24px">                                    <table align="center" border="0" cellpadding="1" cellspacing="1">                                        <tbody>                                            <tr>                                                <td><p style="font-size:16px;font-weight: bold;text-transform: uppercase;">TRAINING CERTIFICATION SLIP</p></td>                                            </tr>                                        </tbody>                                    </table>                                </td>                            </tr>                            <tr>                                <td style="font-family:Helvetica,arial,sans-serif;font-size:18px;color:rgb(51,51,51);text-align:justify;line-height:20px">&nbsp; </td>                                                            </tr>                            <tr>                            	<td>                                    <table align="center" border="0" cellpadding="1" cellspacing="1" width="700">                                        <tbody>                                            <tr>                                                <td>                                                    <ol>                                                        <li>This form is to be filled in by Training Providers to certify the training outcomes of self-sponsored trainees who qualify for Training Allowance funding.</li>                                                        <li>It should be completed and handed to trainees upon the completion of training and assessments(s).</li>                                                        <li>Please note that all fields are compulsory. Any amendments made are to be counter-signed by the Training Provider.</li>                                                        <li>This form may take about 10 minutes to complete.</li>                                                        <br/>                                                    </ol>                                                </td>                                            </tr>				            <tr>				                <td>				                    <table style="border-collapse: collapse;" border="1" bordercolor="black" width="700" cellpadding="4">	                                                        <tbody align="left" valign="top">                                                            <tr>                                                                <th align="left" colspan="5" bgcolor="lightgrey" align="left"><b>Trainee Particulars</b></th>                                                            </tr>                                                            <tr align="left">                                                                <td colspan="3">Name: ' . $data->first_name . '</td>                                                                <td colspan="2">NRIC: ' . mask_format($data->tax_code) . '</td>                                                            </tr>                                                            <tr>                                                                <th colspan="5" bgcolor="lightgrey" align="left"><b>Course Information</b></th>                                                            </tr>                                                            <tr align="left">                                                                 <td width="150">Course Title (as approved in SkillsConnect)</td>                                                                <td width="550">' . $data->crse_name . '</td>                                                            </tr>                                                            <tr align="left">                                                                <td width="150">SkillsConnect Course Code</td>                                                                <td width="550">' . $data->reference_num . '</td>                                                            </tr>                                                            <tr align="left">                                                                <td width="150" style=" float:leftt;">Course Start Date </td>                                                                <td width="200">' . $start_date . '</td>                                                                <td width="150" style=" float:leftt;">Course End Date </td>                                                                <td width="200">' . $end_date . '</td>                                                            </tr>                                                            <tr align="left">                                                                <td>Conducted Training Hours</td>                                                                <td>' . $data->crse_duration . '</td>                                                                <td>Training Hours Attended</td>                                                                <td>' . $data->crse_duration . '</td>                                                            </tr>                                                            <tr align="left">                                                                <td colspan="4">Trainee attained atleast 75% attendence?&nbsp; &nbsp;                                                                 &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;                                                                                                                                        <span><input type="checkbox" name="yes" value="1">Yes</span>                                                                        &nbsp;                                                                        <span><input type="checkbox" name="no" value="0">No</span>                                                                </td>                                                            </tr>                                                            <tr align="left">                                                                <td colspan="4">Trainee passed assessment(s) or attained qualification?&nbsp; &nbsp;                                                                                                                                        <span><input type="checkbox" name="yes" value="2">Yes</span>                                                                        &nbsp;                                                                        <span><input type="checkbox" name="no" value="3">No</span> &nbsp;                                                                        <span><input type="checkbox" name="na" value="4">Not Applicable (For WPLN Only)</span><br>                                                                </td>                                                            </tr>                                                            <tr align="left">                                                                <th colspan="4" bgcolor="lightgrey"><b>Training Provider Certification</b></th>                                                               </tr>                                                            <tr align="left">                                                                <td>Name of Training Provider</td>                                                                <td colspan="3"> ' . $data->tenant_name . '</td>                                                            </tr>                                                            <tr align="left">                                                                <td>Certified By (Name of Officer)</td>                                                                <td></td>                                                                <td>Contact/Email</td>                                                                <td>64389693 /enquiries@xprienz.com</td>                                                            </tr>                                                             <tr align="left">                                                                <td>Designation<br/> </td>                                                                                                                            <td colspan="3">                                                                                                                                   </td>                                                            </tr>                                                            <tr align="left" rowspan="1">                                                                <td>Signature<br/></td>                                                                <td colspan="3"></td>                                                            </tr>                                                            <tr align="left">                                                                <td>Date<br/></td>                                                                <td colspan="3">' . $end_date . '</td>			                                                            </tr>                                                                                                                        </tbody>                                                </table>                                            </td>                                        </tr>                                    </tbody>                                </table>                            </td>                        </tr>                    </tbody>                </table>';    }else{        $tbl = '<table cellpadding="0" cellspacing="0">                        <tbody>                                                       <tr>                                <td style="font-family:Helvetica,arial,sans-serif;font-size:14px;text-align:justify;line-height:24px">                                    <table align="center" border="0" cellpadding="1" cellspacing="1">                                        <tbody>                                            <tr>                                                <td><p style="font-size:16px;font-weight: bold;text-transform: uppercase;">TRAINING CERTIFICATION SLIP</p></td>                                            </tr>                                        </tbody>                                    </table>                                </td>                            </tr>                            <tr>                                <td style="font-family:Helvetica,arial,sans-serif;font-size:18px;color:rgb(51,51,51);text-align:justify;line-height:20px">&nbsp; </td>                                                            </tr>                            <tr>                            	<td>                                    <table align="center" border="0" cellpadding="1" cellspacing="1" width="700">                                        <tbody>                                            <tr>                                                <td>                                                    <ol>                                                        <li>This form is to be filled in by Training Providers to certify the training outcomes of self-sponsored trainees who qualify for Training Allowance funding.</li>                                                        <li>It should be completed and handed to trainees upon the completion of training and assessments(s).</li>                                                        <li>Please note that all fields are compulsory. Any amendments made are to be counter-signed by the Training Provider.</li>                                                        <li>This form may take about 10 minutes to complete.</li>                                                        <br/>                                                    </ol>                                                </td>                                            </tr>				            <tr>				                <td>				                    <table style="border-collapse: collapse;" border="1" bordercolor="black" width="700" cellpadding="4">	                                                        <tbody align="left" valign="top">                                                            <tr>                                                                <th align="left" colspan="5" bgcolor="lightgrey" align="left"><b>Trainee Particulars</b></th>                                                            </tr>                                                            <tr align="left">                                                                <td colspan="3">Name: ' . $data->first_name . '</td>                                                                <td colspan="2">NRIC: ' . mask_format($data->tax_code) . '</td>                                                            </tr>                                                            <tr>                                                                <th colspan="5" bgcolor="lightgrey" align="left"><b>Course Information</b></th>                                                            </tr>                                                            <tr align="left">                                                                 <td width="150">Course Title (as approved in SkillsConnect)</td>                                                                <td width="550">' . $data->crse_name . '</td>                                                            </tr>                                                            <tr align="left">                                                                <td width="150">SkillsConnect Course Code</td>                                                                <td width="550">' . $data->reference_num . '</td>                                                            </tr>                                                            <tr align="left">                                                                <td width="150" style=" float:leftt;">Course Start Date </td>                                                                <td width="200">' . $start_date . '</td>                                                                <td width="150" style=" float:leftt;">Course End Date </td>                                                                <td width="200">' . $end_date . '</td>                                                            </tr>                                                            <tr align="left">                                                                <td>Conducted Training Hours</td>                                                                <td>' . $data->crse_duration . '</td>                                                                <td>Training Hours Attended</td>                                                                <td>' . $data->crse_duration . '</td>                                                            </tr>                                                            <tr align="left">                                                                <td colspan="4">Trainee attained atleast 75% attendence?&nbsp; &nbsp;                                                                 &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;                                                                                                                                        <span><input type="checkbox" name="yes" value="1">Yes</span>                                                                        &nbsp;                                                                        <span><input type="checkbox" name="no" value="0">No</span>                                                                </td>                                                            </tr>                                                            <tr align="left">                                                                <td colspan="4">Trainee passed assessment(s) or attained qualification?&nbsp; &nbsp;                                                                                                                                        <span><input type="checkbox" name="yes" value="2">Yes</span>                                                                        &nbsp;                                                                        <span><input type="checkbox" name="no" value="3">No</span> &nbsp;                                                                        <span><input type="checkbox" name="na" value="4">Not Applicable (For WPLN Only)</span><br>                                                                </td>                                                            </tr>                                                            <tr align="left">                                                                <th colspan="4" bgcolor="lightgrey"><b>Training Provider Certification</b></th>                                                               </tr>                                                            <tr align="left">                                                                <td>Name of Training Provider</td>                                                                <td colspan="3"> ' . $data->tenant_name . '</td>                                                            </tr>                                                            <tr align="left">                                                                <td>Certified By (Name of Officer)</td>                                                                <td>' . $data->trainer_name . '</td>                                                                <td>Contact/Email</td>                                                                <td>64389693 /enquiries@xprienz.com</td>                                                            </tr>                                                             <tr align="left">                                                                <td>Designation<br/> </td>                                                                                                                            <td colspan="3">                                                                   Trainer                                                                </td>                                                            </tr>                                                            <tr align="left" rowspan="1">                                                                <td>Signature<br/></td>                                                                <td colspan="3"></td>                                                            </tr>                                                            <tr align="left">                                                                <td>Date<br/></td>                                                                <td colspan="3">' . $end_date . '</td>			                                                            </tr>                                                                                                                        </tbody>                                                </table>                                            </td>                                        </tr>                                    </tbody>                                </table>                            </td>                        </tr>                    </tbody>                </table>';    }    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('TCS.pdf', 'D');}/*skm end *//** * function to get pdf report */function refunds_report_pdf($tabledata, $tableuser, $tenant, $companies) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $start_date = $ci->input->get('start_date');    $end_date = $ci->input->get('end_date');    $company = $ci->input->get('company');    $invoice_id = $ci->input->get('invoice_id');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                        .$tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Refunds Report ';    if (empty($start_date) && empty($end_date)) {        $info .= ' for ' . date('F d Y, l');    } else {        $info .= 'for the period';        if (!empty($start_date))            $info .= ' from ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $start_date)->getTimestamp());        if (!empty($end_date))            $info .= ' to ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $end_date)->getTimestamp());    }    if (!empty($company)) {        $info .= ' \'' . $companies[$company] . '\'';    }    if (!empty($invoice_id)) {        $info .= ' -  \' Invoice No.: ' . $invoice_id . '\'';    }    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center" width="5%"><b>Inv #</b></th>            <th align="center" width="10%"><b>NRIC/FIN No.</b></th>            <th align="center" width="20%"><b>Name</b></th>            <th align="center" width="10%"><b>Refund Dt.</b></th>            <th align="center" width="10%"><b>Refund Amt.</b></th>            <th align="center" width="25%"><b>Reason</b></th>            <th align="center" width="20%"><b>Refunded By</b></th>        </tr>';    foreach ($tabledata as $data) {        $k = $data->invoice_id;        if ($data->refund_type == 'INDV') {            $taxcode = $tableuser[$k]['taxcode'];            $name = $tableuser[$k]['name'];        } else {            if($data->company_id[0] == 'T') {                $tenant_details = fetch_tenant_details($data->company_id);                                    $taxcode = $tenant_details->tenant_name;                $name = $tenant_details->tenant_name . ' (Company)';            } else {                $taxcode = $data->comp_regist_num;                $name = $data->company_name . ' (Company)';            }        }        $tbl .= "<tr>                    <td><b>" . $data->invoice_id . "</b></td>                    <td><b>" . mask_format($taxcode) . "</b></td>                    <td><b>" . $name . "</b></td>                    <td><b>" . date('d/m/Y', strtotime($data->refund_on)) . "</b></td>                    <td><b>$ " . number_format($data->amount_refund, 2, '.', '') . " SGD</b></td>                    <td><b>" . $data->refnd_reason . "</b></td>                    <td><b>" . $data->first_name . " " . $data->last_name . "</b></td>                </tr>";    }    $tbl .='</table><br><p style="color:red;"><i>This is a computer generated report and doesn\'t require a seal or signature - ' . $tenant->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($info . '.pdf', 'D');}/** * function to get pdf sales */function sales_reports_pdf($tabledata, $periods, $tenant, $executive) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                    .$tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = ' Sales Assignment & Commission Report for ' . date('F d Y, l');    $sales_id = $ci->input->get('sales_exec');    if (!empty($sales_id)) {        $info .=' \'' . $executive[$sales_id] . '\'';    }    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Sales Executive</b></th>            <th align="center"><b>Total Comm.</b></th>            <th align="center"><b>Total Recd.</b></th>            <th align="center"><b>Total Due</b></th>            <th align="center"><b>Due Period</b></th>        </tr>';    foreach ($tabledata as $k => $row) {        $total = number_format($row->comm_due_amount, 2, '.', '');        $paid = number_format($row->comm_paid_amount, 2, '.', '');        $due = number_format($total - $paid, 2, '.', '');        $tbl .= "<tr>                    <td><b>" . $row->first_name." ".$row->last_name . "</b></td>                    <td><b>$ " . $total . " SGD</b></td>                    <td><b>$ " . $paid . " SGD</b></td>                    <td><b>$ " . $due . " SGD</b></td>                    <td><b>" . rtrim($periods[$row->sales_exec_id],", ") . "</b></td>                </tr>";    }    $tbl .='</table><br><p style="color:red;"><i>This is a computer generated report and doesn\'t require a seal or signature - ' . $data->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($info . '.pdf', 'D');}/** * payments due report PDF */function payments_due_report_pdf($tabledatarefund, $tabledatarecd, $tabledata, $tenant, $executive) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $start_date = $ci->input->get('start_date');    $end_date = $ci->input->get('end_date');    $salesexec = $ci->input->get('salesexec');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                    . $tenant->tenant_country .'</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Payments Due Report ';    if (empty($start_date) && empty($end_date)) {        $info .= ' for ' . date('F d Y, l');    } else {        $info .= 'for the period';        if (!empty($start_date))            $info .= ' from ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $start_date)->getTimestamp());        if (!empty($end_date))            $info .= ' to ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $end_date)->getTimestamp());    }    if (!empty($salesexec)) {        $info .= ' \'' . $executive[$salesexec] . '\'';    }    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Inv #</b></th>            <th align="center"><b>Inv Dt.</b></th>            <th align="center"><b>Inv Amt.</b></th>            <th align="center"><b>Amt. Recd.</b></th>            <th align="center"><b>Amt. Due</b></th>            <th align="center"><b>Amt. Refd</b></th>            <th align="center"><b>Course - Class</b></th>            <th align="center"><b>Name</b></th>            <th align="center"><b>NRIC/FIN No.</b></th>        </tr>';    foreach ($tabledata as $data) {        if ($data->inv_type == 'INVINDV') {            $taxcode = $data->tax_code;            $name = $data->first_name . ' ' . $data->last_name;        } else {            if($data->company_id[0] == 'T') {                $tenant_details = fetch_tenant_details($data->company_id);                $taxcode = $tenant_details->tenant_name;                $name = $tenant_details->tenant_name. ' (Company)';            } else {                $taxcode = $data->comp_regist_num;                $name = $data->company_name . ' (Company)';            }        }        $tbl .= '<tr>                        <td><b>' . $data->invoice_id . '</b></td>                        <td><b>' . date('d/m/Y', strtotime($data->inv_date)) . '</b></td>                        <td><b>$ ' . $total_inv = number_format($data->total_inv_amount, 2, '.', '') . ' SGD</b></td>                        <td><b>$ ' . $total_recd = number_format($tabledatarecd[$data->invoice_id], 2, '.', '') . 'SGD</b></td>                        <td><b>$ ' . number_format($total_inv - $total_recd, 2, '.', '') . ' SGD</b></td>                        <td><b>$ ' . number_format($tabledatarefund[$data->invoice_id], 2, '.', '') . ' SGD</b></td>                        <td><b>' . $data->crse_name . ' - ' . $data->class_name . '</b></td>                        <td><b>' . $name . '</b></td>                        <td><b>' . mask_format($taxcode) . '</b></td>                    </tr>';    }    $tbl .='</table><br><p style="color:red;"><i>This is a computer generated report and doesn\'t require a seal or signature - ' . $tenant->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($info . '.pdf', 'D');}/** * payments recd report PDF */function payments_recd_report_pdf($tabledataextra, $tabledata, $tenant, $companies) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $start_date = $ci->input->get('start_date');    $end_date = $ci->input->get('end_date');    $company = $ci->input->get('company');    $invoice_id = $ci->input->get('invoice_id');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                 .$tenant->tenant_country .'</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Payments Received Report ';    if (empty($start_date) && empty($end_date)) {        $info .= ' for ' . date('F d Y, l');    } else {        $info .= 'for the period';        if (!empty($start_date))            $info .= ' from ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $start_date)->getTimestamp());        if (!empty($end_date))            $info .= ' to ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $end_date)->getTimestamp());    }    if (!empty($company)) {        $info .= ' \'' . $companies[$company] . '\'';    }    if (!empty($invoice_id)) {        $info .= ' -  \' Invoice No.: ' . $invoice_id . '\'';    }    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>Inv #.</b></th>            <th align="center"><b>Inv Dt.</b></th>            <th align="center"><b>Inv Amt.</b></th>            <th align="center"><b>Recd. On</b></th>            <th align="center"><b>Amt. Recd.</b></th>            <th align="center"><b>Course - Class</b></th>            <th align="center"><b>Name</b></th>            <th align="center"><b>NRIC/FIN No.</b></th>        </tr>';    foreach ($tabledata as $data) {        $k = $data->pymnt_due_id;        if ($data->inv_type == 'INVINDV') {            $taxcode = mask_format($tabledataextra[$k]->tax_code);            $name = $tabledataextra[$k]->first_name . ' ' . $tabledataextra[$k]->last_name;        } else {            if($data->company_id[0] == 'T') {                $tenant_details = fetch_tenant_details($data->company_id);                $name = $tenant_details->tenant_name. ' (Company)';                $taxcode = $tenant_details->tenant_name;            } else {                $taxcode = $tabledataextra[$k]->comp_regist_num;                $name = $tabledataextra[$k]->company_name . ' (Company)';            }        }        $tbl .='<tr>                        <td><b>' . $data->invoice_id . '</b></td>                        <td><b>' . date('d/m/Y', strtotime($data->inv_date)) . '</b></td>                        <td><b>$ ' . number_format($data->total_inv_amount, 2, '.', '') . ' SGD</b></td>                        <td><b>' . date('d/m/Y', strtotime($data->recd_on)) . '</b></td>                        <td><b>$ ' . number_format($data->amount_recd, 2, '.', '') . ' SGD</b></td>                        <td><b>' . $tabledataextra[$k]->crse_name . ' - ' . $tabledataextra[$k]->class_name . '</b></td>                        <td><b>' . $name . '</b></td>                        <td><b>' . mask_format($taxcode) . '</b></td>                    </tr>';    }    $tbl .='</table><br><p style="color:red;"><i>This is a computer generated report and doesn\'t require a seal or signature - ' . $tenant->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($info . '.pdf', 'D');}/** * wda report PDF */function wda_reports_pdf($tabledata, $meta_map, $tenant, $courses, $classes, $trainee_name) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $course_id = $ci->input->get_post("courseId");    $class_id = $ci->input->get_post("classId");    $trainee = $ci->input->get_post("trainee_id");    $taxcode = $ci->input->get_post("taxcode_id");    $start_date = $ci->input->get_post("start_date");    $end_date = $ci->input->get_post("end_date");    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                    .$tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'WDA Report ';    if (empty($start_date) && empty($end_date)) {        $info .= ' for ' . date('F d Y, l');    } else {        $info .= 'for the period';        if (!empty($start_date))            $info .= ' from ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $start_date)->getTimestamp());        if (!empty($end_date))            $info .= ' to ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $end_date)->getTimestamp());    }    if (!empty($course_id)) {        $info .= ' \'' . $courses[$course_id] . '\'';    }    if (!empty($class_id)) {        $info .= ' \'' . $classes[$class_id] . '\'';    }    if (!empty($trainee_name)) {        $info .= ' \'' . $trainee_name->first . ' ' . $trainee_name->last . ' ' . $trainee_name->tax_code . '\'';    }    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th width="10%" align="center"><b>NRIC/FIN No.</b></th>            <th width="12%" align="center"><b>Trainee Name</b></th>            <th width="12%" align="center"><b>Company Name</b></th>            <th width="7%" align="center"><b>Account Type</b></th>            <th width="11%" align="center"><b>Home Address</b></th>            <th width="10%" align="center"><b>Contact Details</b></th>            <th width="7%" align="center"><b>Course Name</b></th>            <th width="10%" align="center"><b>Class Start Date</b></th>            <th width="10%" align="center"><b>Assessment Date</b></th>            <th width="10%" align="center"><b>Amount Paid</b></th>        </tr>';    foreach ($tabledata as $data) {        $paid = ($data->payment_status == 'PAID') ? $data->total_amount_due : 0;        $assmnt_date = empty($data->exam_date) ? $data->class_end_datetime : $data->exam_date;        $tbl .= '<tr>                    <td>' . mask_format($data->tax_code) . '</td>                    <td>' . $data->first_name . ' ' . $data->last_name . '</td>                    <td>' . $data->company_name .'</td>                    <td>' . $meta_map[$data->account_type] . '</td>                    <td>' . $data->personal_address_bldg . ' ' . $data->personal_address_city . ' ' . $meta_map[$data->personal_address_state] . ' ' . $meta_map[$data->personal_address_country] . '</td>                    <td>' . $data->registered_email_id . ' ' . $data->contact_number . '</td>                    <td>' . $data->crse_name . '</td>                    <td>' . date('d/m/Y', strtotime($data->class_start_datetime)) . '</td>                    <td>' . date('d/m/Y', strtotime($assmnt_date)) . '</td>                    <td>$ ' . number_format($paid, 2, '.', '') . ' SGD</td>                </tr>';    }    $tbl .='</table><br><p style="color:red;"><i>This is a computer generated report and doesn\'t require a seal or signature - ' . $tenant->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($info . '.pdf', 'D');}/** * Certificates report PDF */function certificates_reports_pdf($tabledata, $meta_map, $tenant, $courses, $classes, $trainee_name){    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $course_id = $ci->input->get_post("courseId");    $class_id = $ci->input->get_post("classId");    $trainee = $ci->input->get_post("trainee_id");    $status = $ci->input->get_post("status");    $start_date = $ci->input->get_post("start_date");    $end_date = $ci->input->get_post("end_date");    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                    .$tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Certificates Report ';    if (empty($start_date) && empty($end_date)) {        $info .= ' for ' . date('F d Y, l');    } else {        $info .= 'for the period';        if (!empty($start_date))            $info .= ' from ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $start_date)->getTimestamp());        if (!empty($end_date))            $info .= ' to ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $end_date)->getTimestamp());    }    if (!empty($course_id)) {        $info .= ' \'' . $courses[$course_id] . '\'';    }    if (!empty($class_id)) {        $info .= ' \'' . $classes[$class_id] . '\'';    }    if (!empty($trainee_name)) {        $info .= ' \'' . $trainee_name->first . ' ' . $trainee_name->last . ' ' . $trainee_name->tax_code . '\'';    }    if (!empty($status)) {        if ($status == 'PENDCOLL') {            $info .= ' \' Pending Collection \'';        } elseif ($status == 'EXPIRD') {            $info .= ' \' Expired / Due for Renewal \'';        }    }    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                <tr>                    <th align="center"><b>Course Name</b></th>                    <th align="center"><b>Class Name</b></th>                    <th align="center"><b>NRIC/FIN No.</b></th>                    <th align="center"><b>Trainee Name</b></th>                    <th align="center"><b>Course Comp. Dt.</b></th>                    <th align="center"><b>Coll. Dt.</b></th>                    <th align="center"><b>Collected On</b></th>                    <th align="center"><b>Status (Expiry)</b></th>                    <th align="center"><b>Pymnt. Status</b></th>                </tr>';    foreach ($tabledata as $data) {        $certi_coll_date = (empty($data->certi_coll_date)) ? '' : date('d/m/Y', strtotime($data->certi_coll_date));        $certified_date = (empty($data->certificate_coll_on)) ? '' : date('d/m/Y', strtotime($data->certificate_coll_on));        $validity_date = '';        $status = '';        if ($data->crse_cert_validity > 0) {            $date = strtotime("+" . $data->crse_cert_validity . " days", strtotime($data->class_end_datetime));            $validity_datecheck = date('d-m-Y', $date);            $validity_date = ' (' . date('d/m/Y', $date) . ')';            $cur_date = date('d-m-Y');            if (strtotime($cur_date) > strtotime($validity_datecheck)) {                $status = 'Expired/ Due for Renewal';            }else if (strtotime($cur_date) <= strtotime($validity_datecheck)) {                $status = 'ACTIVE';            }        } else {            $status = 'Life Long';        }        $tbl .= '<tr>                            <td>' . $data->crse_name . '</td>                            <td>' . $data->class_name . '</td>                            <td>' . mask_format($data->tax_code) . '</td>                            <td>' . $data->first_name . ' ' . $data->last_name . '</td>                            <td>' . date('d/m/Y', strtotime($data->class_end_datetime)) .'</td>                            <td>' . $certi_coll_date .'</td>                            <td>' . $certified_date.'</td>                            <td>' . $status . $validity_date.'</td>                            <td>' . $data->payment_status.'</td>                        </tr>';    }    $tbl .='</table><br><p style="color:red;"><i>This is a computer generated report and doesn\'t require a seal or signature - ' . $tenant->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($info . '.pdf', 'D');}// added by function certificates_distribution_reports_pdf($tabledata, $meta_map, $tenant, $courses, $classes, $trainee_name){    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $course_id = $ci->input->get_post("courseId");    $class_id = $ci->input->get_post("classId");    $trainee = $ci->input->get_post("trainee_id");    $status = $ci->input->get_post("status");    $start_date = $ci->input->get_post("start_date");    $end_date = $ci->input->get_post("end_date");    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                    .$tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $info = 'Certificates Distribution Report ';    if (empty($start_date) && empty($end_date)) {        $info .= ' for ' . date('F d Y, l');    } else {        $info .= 'for the period';        if (!empty($start_date))            $info .= ' from ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $start_date)->getTimestamp());        if (!empty($end_date))            $info .= ' to ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $end_date)->getTimestamp());    }    if (!empty($course_id)) {        $info .= ' \'' . $courses[$course_id] . '\'';    }    if (!empty($class_id)) {        $info .= ' \'' . $classes[$class_id] . '\'';    }    if (!empty($trainee_name)) {        $info .= ' \'' . $trainee_name->first . ' ' . $trainee_name->last . ' ' . $trainee_name->tax_code . '\'';    }    if (!empty($status)) {        if ($status == 'PENDCOLL') {            $info .= ' \' Pending Collection \'';        } elseif ($status == 'EXPIRD') {            $info .= ' \' Expired / Due for Renewal \'';        }    }    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                <tr>                    <th align="center"><b>Course Name</b></th>                    <th align="center"><b>Class Name</b></th>                    <th align="center"><b>NRIC/FIN No.</b></th>                    <th align="center"><b>Trainee Name</b></th>                    <th align="center"><b>Company name</b></th>                    <th align="center"><b>Company Email</b></th>                    <th align="center"><b>Certificate Sent To</b></th>                    <th align="center"><b>Certificate Sent On </b></th>                                   </tr>';    foreach ($tabledata as $data) {        $certi_coll_date = (empty($data->certi_coll_date)) ? '' : date('d/m/Y', strtotime($data->certi_coll_date));        $certified_date = (empty($data['certificate_coll_on'])) ? '' : date('d-m-Y', strtotime($data['certificate_coll_on']));        $validity_date = '';        $status = '';        if ($data->crse_cert_validity > 0) {            $date = strtotime("+" . $data->crse_cert_validity . " days", strtotime($data->class_end_datetime));            $validity_datecheck = date('d-m-Y', $date);            $validity_date = ' (' . date('d/m/Y', $date) . ')';            $cur_date = date('d-m-Y');            if (strtotime($cur_date) > strtotime($validity_datecheck)) {                $status = 'Expired/ Due for Renewal';            }else if (strtotime($cur_date) <= strtotime($validity_datecheck)) {                $status = 'ACTIVE';            }        } else {            $status = 'Life Long';        }        $tbl .= '<tr>                            <td>' . $data['crse_name'] . '</td>                            <td>' . $data['class_name'] . '</td>                            <td>' . mask_format($data['tax_code']) . '</td>                            <td>' . $data['first_name'] . ' ' . $data['last_name'] . '</td>';                            if($data['com_name_ind'])                            {                               $tbl .=  '<td>' .  $data['com_name_ind'].'</td>';                            }                            else                            {                              $tbl .=  '<td>' .  $data['com_name'].'</td>';                            }                            $tbl .=  '<td>' . $data['comp_email'] . '</td>';                                                         if(!$data['com_name'])                            {                                $tbl .=  '<td>' . $data['company_name'] .'</td>';                            }                            else if($data['com_name_others']){                                 $tbl .=  '<td>' . $data['com_name_others'] .'</td>';                            }                            else                            {                                $tbl .=  '<td></td>';                            }                                                    $tbl .=  '<td>' . $certified_date.'</td>                        </tr>';    }    $tbl .='</table><br><p style="color:red;"><i>This is a computer generated report and doesn\'t require a seal or signature - ' . $tenant->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output($info . '.pdf', 'D');}/** * Used to generate Trainer Feedback PDF (REPORT) * @param type $feedbackDetails * @param type $tenant_details * @param type $user_details */function traner_feedback_pdf($feedbackDetails, $tenant_details,$user_details) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->model('meta_values','meta');    $meta_map = $ci->meta->get_param_map();    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, TRUE, 'UTF-8', FALSE);    $pdf->SetCreator(PDF_CREATOR);    $pdf->SetPrintHeader(FALSE);    $pdf->SetPrintFooter(FALSE);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetFooterMargin(PDF_MARGIN_FOOTER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 10);    $pdf->Image(FCPATH . 'logos/' . $tenant_details->Logo, 0, 10, null, null, 'PNG', '', '', TRUE, 150, 'R', FALSE, FALSE, 1, FALSE, FALSE, FALSE);    $pdf->writeHTML('<br>', TRUE, FALSE, FALSE, FALSE, '');    $tbl = '        <table style="font-size:8px;">            <tr>                <td>' . $tenant_details->tenant_address . '</td>            </tr>            <tr>                <td>' . $tenant_details->tenant_country . '</td>            </tr>            <tr>                <td>Tel: ' . $tenant_details->tenant_contact_num . '</td>            </tr>            <tr>                <td>' . $tenant_details->tenant_email_id . '</td>            </tr>        </table>    ';    $pdf->writeHTML($tbl, true, false, false, false, 'R');    $pdf->SetFont('helvetica', 'B', 12);    $pdf->Write(0, 'Trainer Feedback', '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 10);    $tbl = '        <table cellspacing="0" cellpadding="1" border="1">            <tr>                <td width="70%">                    1. ' . $feedbackDetails['CERTCOLDT']['category_name'] . ':                 </td>                <td align="right" width="30%">                    ' . $feedbackDetails['CERTCOLDT']['feedback_answer'] . '                </td>            </tr>            <tr>                <td width="70%">                    2. ' . $feedbackDetails['SATSRATE']['category_name'] . ':                </td>                <td align="right" width="30%">                    ' . $feedbackDetails['SATSRATE']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    3. ' . $feedbackDetails['CERTCOM1']['category_name'] . ':                </td>                <td align="right">                    ' . $feedbackDetails['CERTCOM1']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    4. ' . $feedbackDetails['APPKNLSKL']['category_name'] . ':                </td>                <td align="right">                    ' . $feedbackDetails['APPKNLSKL']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    5. ' . $feedbackDetails['EXPJOBSCP']['category_name'] . ':                 </td>                <td align="right">                    ' . $feedbackDetails['EXPJOBSCP']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    6. ' . $feedbackDetails['RT3MNTHS']['category_name'] . ':                 </td>                <td align="right">                    ' . $feedbackDetails['RT3MNTHS']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    7. ' . $feedbackDetails['DTCOMMEMP']['category_name'] . ':                 </td>                <td align="right">                    ' . $feedbackDetails['DTCOMMEMP']['feedback_answer'] . '                </td>            </tr>            <tr>                <td>                    8. ' . $feedbackDetails['COMYTCOM']['category_name'] . ':                 </td>                <td align="right">                    ' . $feedbackDetails['COMYTCOM']['feedback_answer'] . '                </td>            </tr>            <tr>                <td colspan="2">                    9. ' . $feedbackDetails['COMMNTS']['category_name'] . ' :                     ' . $feedbackDetails['COMMNTS']['feedback_answer'] . '                </td>            </tr>            <tr>                <td colspan="2" align="right">                    <span style="font-size:8px;color:#f00;text-align:right">                        (1. Strongly disagree, 2. Disagree, 3. Neutral, 4. Agree, 5. Strongly agree)                    </span>                </td>            </tr>        </table>    ';    $pdf->writeHTML($tbl, true, false, false, false, '');        $html = '<div>Name: ' . $user_details->first_name . ' ' . $user_details->last_name . '</div>        <div>NRIC or Work Pass No.: ' . mask_format($user_details->tax_code) . '</div>        <div>Course Title: ' . $user_details->course_title . ' - ' . $user_details->class_title . '</div>        <div>Course Date: ' . date('d/m/Y', strtotime($user_details->class_end_datetime)) . '</div>';     $pdf->writeHTML($html, true, false, true, false, '');    $pdf->Output('trainer_feedback.pdf', 'D');}/** * Monthly Enrollment Count report PDF */function generate_monthly_enrollment_count_pdf($title, $tabledata, $tenant, $attendance) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                    .$tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $pdf->Write(0, $title, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                <tr>                    <th><b>Month</b></th>                    <th><b>Total Enrollments</b></th>                    <th><b>Present`s Attendance Count</b></th>                </tr>';    foreach ($tabledata as $data) {        $attendance_count = empty($attendance[$data['month']])?0:$attendance[$data['month']];        $tbl .= '<tr>                    <td>' . $data['month'] . '</td>                    <td>' . $data['count'] . '</td>                    <td>' . $attendance_count . '</td>                </tr>';    }    $tbl .='</table><br><p style="color:red;"><i>This is a computer generated report and doesn\'t reuqire a seal or signature - ' . $tenant->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('Monthly Enrollment Count.pdf', 'D');}/** * This function returns nric print formate. * @param type $nric * @return string */function get_nric_print_format($nric) {      //$new_nric = substr_replace($nric,'xxxx',1,4);            $new_nric = substr_replace($nric,'xxxx',5);            return $new_nric;}/** * This function prints the invoice audit trail report in PDF format * @param type $query * @param type $tenant * CR 02 - Apr 08 2015 */function invoice_audit_trail_report_PDF($query_result, $tenant) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $ci->load->helper('common');    $ci->load->model('meta_values', 'meta');    $meta_map = $ci->meta->get_param_map();// create new PDF document    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);// ----------------------    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'            . $tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $start_date = $ci->input->get('start_date');    $end_date = $ci->input->get('end_date');    if (empty($start_date) && empty($end_date)) {        $period = ' for ' . date('F d Y, l');    } else {        $period = 'for the period';        if (!empty($start_date))            $period .= ' from ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $start_date)->getTimestamp());        if (!empty($end_date))            $period .= ' to ' . date('F d Y', DateTime::createFromFormat('d-m-Y', $end_date)->getTimestamp());    }    $info = 'Invoice Audit Trail ' . $period;    $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>			<th align="center"><b>Inv #</b></th>			<th align="center"><b>Inv Dt.</b></th>                        <th align="center"><b>Inv Type</b></th>                        <th align="center"><b>NRIC/FIN No.</b></th>			<th align="center"><b>Discount</b></th>			<th align="center"><b>Subsidy</b></th>			<th align="center"><b>GST</b></th>                        <th align="center"><b>Net Amt.</b></th>                        <th align="center"><b>Prev Inv No.</b></th>                        <th align="center"><b>Curr Inv No.</b></th>        </tr>';    foreach ($query_result as $data) {        if ($data->invoiced_on == NULL || $data->invoiced_on == '0000-00-00 00:00:00') {            $invoiced_label = '<br><span style="color:red">** Not Invoiced</span>';        } else {            $invoiced_label = '<br><span style="color:blue">** Invoiced (' . date('d/m/Y', strtotime($data->invoiced_on)) . ')</span>';        }        if ($data->enrolment_mode === 'COMPSPON') {            $ci->load->model('reports_model');            $data->payment_status ='';/* $ci->reports_model->check_not_part_paid($data->pymnt_due_id);*/        }        $paid_arr = array('PAID' => 'Paid', 'PARTPAID' => 'Part Paid', 'NOTPAID' => 'Not Paid');        if ($data->enrolment_mode == 'SELF') {            $taxcode = mask_format($data->tax_code);            $name = $data->first_name . ' ' . $data->last_name;            $status = $paid_arr[$data->payment_status];        } else {            // Modified by dummy for internal staff enroll on 01 Dec 2014.            if ($data->company_id[0] == 'T') {                $tenant_details = fetch_tenant_details($data->company_id);                $taxcode = $tenant_details->tenant_name;                $name = $tenant_details->tenant_name;            } else {                $taxcode = $data->comp_regist_num;                $name = $data->company_name;            }            $status = ($data->payment_status > 0) ? 'Part Paid/Not Paid' : 'Paid';        }        $inv_type1 = $data->inv_type1 . ' (' . $name . ')';        $tbl .= '<tr>';        $tbl .= '<td>' . $data->invoice_id . '</td>';        $tbl .= '<td>' . date('d/m/Y', strtotime($data->inv_date)) . '</td>';        $tbl .= '<td>' . $inv_type1 . '</td>';        $tbl .= '<td>' . mask_format($taxcode) . '</td>';        $tbl .= '<td align="center">$' . number_format($data->total_inv_discnt, 2, '.', '') . ' SGD</td>';        $tbl .= '<td align="center">$' . number_format($data->total_inv_subsdy, 2, '.', '') . ' SGD</td>';        $tbl .= '<td align="center">$' . number_format($data->total_gst, 2, '.', '') . ' SGD</td>';        $tbl .= '<td>$' . number_format($data->total_inv_amount, 2, '.', '') . ' SGD</td>';        $tbl .= '<td>' . $data->invoice_id . '</td>';        $tbl .= '<td>' . $data->regen_inv_id . '</td>';        $tbl .= '</tr>';    }    $tbl .= '</table>';    $tbl .= '<br><br><br><p style="color:red;"><i>This is a computer generated report and doesn\'t require a seal or signature - ' . $tenant->tenant_name . ' Administrator.</i></p>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('Invoice_audit_trail_report.pdf', 'D');}/* skm start */function generate_monthly_tenant_enrollment_count_pdf($title, $tabledata, $tenant) {//    print_r($tenant_tabledata);    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);    $tbl = '<br><br><table cellspacing="0" cellpadding="1">                <tr>                    <td width="65%">                        &nbsp;                    </td>                    <td width="35%">                        <table align="right">                            <tr>                                <td>' . $tenant->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant->tenant_address . '<br>'                                    .$tenant->tenant_country . '</td>                            </tr>                            <tr>                                <td>Tel :' . $tenant->tenant_contact_num . '</td>                            </tr>                            <tr>                                <td>Email :' . $tenant->tenant_email_id . '</td>                            </tr>                        </table>                    </td>                </tr>                </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $pdf->Write(0, $title, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);      $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                <tr>                    <th><b>Month</b></th>                    <th><b>Year</b></th>                    <th><b>Total Enrollments</b></th>                </tr>';        usort($tabledata, function($a, $b) {                    return strtotime($a['date']) - strtotime($b['date']);                });        foreach ($tabledata as $data) {               $tbl .= '<tr>                    <td>' . $data['month'] . '</td>                    <td>' . $data['year'] . '</td>                    <td>' .  $data['count'] . '</td>                </tr>';        }        $tbl .='</table><br><p style="color:red;"><i>This is a computer generated report and doesn\'t reuqire a seal or signature - ' . $tenant->tenant_name . ' Administrator.</i></p>';                $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('Monthly Enrollment Count.pdf', 'D');}function generate_total_tenant_enrollment_count_pdf($title, $tenant_tabledata) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->AddPage();    $pdf->SetFont('helvetica', '', 8);//    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);//    $pdf->Image(FCPATH . 'logos/' . $tenant->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false);//       $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 11);    $pdf->Write(0, $title, '', 0, 'C', true, 0, false, false, 0);    $pdf->SetFont('helvetica', '', 8);           $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">                <tr>                    <th><b>Tenant Name</b></th>                    <th><b>Total Enrollments</b></th>                </tr>';        foreach ($tenant_tabledata as $data) {               $tbl .= '<tr>                    <td>' . $data['tenant_name'] . '</td>                    <td>' . $data['total'] . '</td>                </tr>';        }        $tbl .='</table><br><p style="color:red;"><i>This is a computer generated report and doesn\'t reuqire a seal or signature - ' . $tenant->tenant_name . ' Administrator.</i></p>';                 $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('Tenant Enrollment Count.pdf', 'D');}/* skm end *//*shubhranshu  start: replace nric first 5 character with mas*/function mask_format($nric) {      if(is_numeric($nric) == 1){        return $nric;    }else{        $new_nric = substr_replace($nric,'XXXXX',0,5);           //$new_nric = substr_replace($nric,'XXXX',5);                return $new_nric;    }   }/* shubhranshu end */function archive_trainee_pdf($data,$course_name,$class_name,$tenant_details) {    $ci = & get_instance();    $ci->load->library('TMS_TCPDF');    $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);    $pdf->SetPrintHeader(false);    $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));    $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));    $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);    $pdf->SetMargins(3, PDF_MARGIN_TOP, 3);    $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);    $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);    $pdf->SetFont('helvetica', 'B', 11);    $pdf->AddPage();    $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);    $pdf->SetFont('helvetica', '', 8);    $pdf->writeHTML('<br><br>', true, false, false, false, '');        $tbl = '<table width="100%">                <tr>                    <td width="75%">                        &nbsp;                    </td>                    <td width="25%">                        <table align="right">                            <tr>                                <td>' . $pdf->Image(FCPATH . 'logos/' . $tenant_details->Logo, 0, 10, null, null, 'PNG', '', '', true, 150, 'R', false, false, 1, false, false, false) . '</td>                            </tr>                            <tr>                                <td>' . $tenant_details->tenant_name . '</td>                            </tr>                            <tr>                                <td>' . $tenant_details->tenant_address . '<br>'                                         .$tenant_details->tenant_country . '</td>                            </tr>                                                    </table>                    </td>                </tr>            </table>';    $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->SetFont('helvetica', 'B', 9);    $info = 'Trainee Archive Report of ' .' '.$course_name.'-'.$class_name;     $pdf->Write(0, $info, '', 0, 'C', true, 0, false, false, 0);         $pdf->SetFont('helvetica', '', 8);    $tbl = '<br><br><table cellspacing="0" cellpadding="1" border="1">        <tr>            <th align="center"><b>S.no.</b></th>            <th align="center"><b>NRIC/FIN No.</b></th>            <th align="center"><b>Trainee Name</b></th>                    </tr>';$i=1;    foreach ($data as $row) {        $tbl .= '<tr>';        $tbl .= '<td>' . $i . '</td>';        $tbl .= '<td>' . mask_format($row['taxcode']) . '</td>';        $tbl .= '<td>' . $row['first_name'] . '</td>';               $tbl .= '</tr>';    $i++;}    $tbl .= '</table>';       $pdf->writeHTML($tbl, true, false, false, false, '');    $pdf->Output('trainee_archive.pdf', 'D');}